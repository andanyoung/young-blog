<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka生产调优手册 | Young&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="Young丶java后端技术博客,专注后端学习与总结。擅长spring boot,JAVA基础总结,等方面的知识,关注spring,架构,elasticsearch,mysql领域.">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.53c04193.css" as="style"><link rel="preload" href="/assets/js/app.e4caa6db.js" as="script"><link rel="preload" href="/assets/js/2.d1be14c5.js" as="script"><link rel="preload" href="/assets/js/80.29d746c7.js" as="script"><link rel="prefetch" href="/assets/js/10.20449a2b.js"><link rel="prefetch" href="/assets/js/100.f25e73b5.js"><link rel="prefetch" href="/assets/js/101.3180ba9d.js"><link rel="prefetch" href="/assets/js/102.fcd415ea.js"><link rel="prefetch" href="/assets/js/103.522869bb.js"><link rel="prefetch" href="/assets/js/104.5da1e4e4.js"><link rel="prefetch" href="/assets/js/105.e5a40fe8.js"><link rel="prefetch" href="/assets/js/106.627d6279.js"><link rel="prefetch" href="/assets/js/107.606beca1.js"><link rel="prefetch" href="/assets/js/108.100e1cb2.js"><link rel="prefetch" href="/assets/js/109.9765392e.js"><link rel="prefetch" href="/assets/js/11.da3512b5.js"><link rel="prefetch" href="/assets/js/110.b73cf0d9.js"><link rel="prefetch" href="/assets/js/111.3f77dd60.js"><link rel="prefetch" href="/assets/js/112.0c7d547d.js"><link rel="prefetch" href="/assets/js/113.1827c266.js"><link rel="prefetch" href="/assets/js/114.daf1d8a5.js"><link rel="prefetch" href="/assets/js/115.e7dca24d.js"><link rel="prefetch" href="/assets/js/116.11b303de.js"><link rel="prefetch" href="/assets/js/117.203cefba.js"><link rel="prefetch" href="/assets/js/118.61d8527b.js"><link rel="prefetch" href="/assets/js/119.1f959a37.js"><link rel="prefetch" href="/assets/js/12.11f18e06.js"><link rel="prefetch" href="/assets/js/120.c268b7aa.js"><link rel="prefetch" href="/assets/js/121.64318c96.js"><link rel="prefetch" href="/assets/js/122.cbddb70d.js"><link rel="prefetch" href="/assets/js/123.b49b84fb.js"><link rel="prefetch" href="/assets/js/124.392f030b.js"><link rel="prefetch" href="/assets/js/125.45f631c4.js"><link rel="prefetch" href="/assets/js/126.700cc575.js"><link rel="prefetch" href="/assets/js/127.d649cb2a.js"><link rel="prefetch" href="/assets/js/128.bc018411.js"><link rel="prefetch" href="/assets/js/129.d0a74611.js"><link rel="prefetch" href="/assets/js/13.1cb33dc8.js"><link rel="prefetch" href="/assets/js/130.45b1f75c.js"><link rel="prefetch" href="/assets/js/131.45ba93df.js"><link rel="prefetch" href="/assets/js/132.c58bbbd7.js"><link rel="prefetch" href="/assets/js/133.7f53922e.js"><link rel="prefetch" href="/assets/js/134.ddf0d780.js"><link rel="prefetch" href="/assets/js/135.ada3af13.js"><link rel="prefetch" href="/assets/js/136.4097c2be.js"><link rel="prefetch" href="/assets/js/137.fc910ac9.js"><link rel="prefetch" href="/assets/js/138.9628f460.js"><link rel="prefetch" href="/assets/js/139.3125ef74.js"><link rel="prefetch" href="/assets/js/14.1004ce43.js"><link rel="prefetch" href="/assets/js/140.bb53ac81.js"><link rel="prefetch" href="/assets/js/141.a002ac19.js"><link rel="prefetch" href="/assets/js/142.540d19e4.js"><link rel="prefetch" href="/assets/js/143.4cbccfca.js"><link rel="prefetch" href="/assets/js/144.8a217b6a.js"><link rel="prefetch" href="/assets/js/145.9c7bc0de.js"><link rel="prefetch" href="/assets/js/146.3dfd0773.js"><link rel="prefetch" href="/assets/js/147.bc0f0d42.js"><link rel="prefetch" href="/assets/js/148.e0cdc4d5.js"><link rel="prefetch" href="/assets/js/149.8486db6e.js"><link rel="prefetch" href="/assets/js/15.703e8784.js"><link rel="prefetch" href="/assets/js/150.5f3b7fb5.js"><link rel="prefetch" href="/assets/js/151.98a3f202.js"><link rel="prefetch" href="/assets/js/152.2940f2ba.js"><link rel="prefetch" href="/assets/js/153.75f3a085.js"><link rel="prefetch" href="/assets/js/154.fa2da83b.js"><link rel="prefetch" href="/assets/js/155.113be5c8.js"><link rel="prefetch" href="/assets/js/156.0667e7f5.js"><link rel="prefetch" href="/assets/js/157.0b3e5dfa.js"><link rel="prefetch" href="/assets/js/158.a338bdd7.js"><link rel="prefetch" href="/assets/js/159.33c9771c.js"><link rel="prefetch" href="/assets/js/16.71e3d898.js"><link rel="prefetch" href="/assets/js/160.e868c8b3.js"><link rel="prefetch" href="/assets/js/161.cf61955e.js"><link rel="prefetch" href="/assets/js/162.baee00ca.js"><link rel="prefetch" href="/assets/js/163.183cde82.js"><link rel="prefetch" href="/assets/js/164.c1eadef5.js"><link rel="prefetch" href="/assets/js/165.70ee8a24.js"><link rel="prefetch" href="/assets/js/166.8e185ff2.js"><link rel="prefetch" href="/assets/js/167.0881cf57.js"><link rel="prefetch" href="/assets/js/168.88caf424.js"><link rel="prefetch" href="/assets/js/169.e7e984ff.js"><link rel="prefetch" href="/assets/js/17.b0356f05.js"><link rel="prefetch" href="/assets/js/170.c7052d81.js"><link rel="prefetch" href="/assets/js/171.2ab773fd.js"><link rel="prefetch" href="/assets/js/172.0e39f858.js"><link rel="prefetch" href="/assets/js/173.76661218.js"><link rel="prefetch" href="/assets/js/174.0ac9f795.js"><link rel="prefetch" href="/assets/js/175.da30bba2.js"><link rel="prefetch" href="/assets/js/176.0f230688.js"><link rel="prefetch" href="/assets/js/177.040e0937.js"><link rel="prefetch" href="/assets/js/178.68852030.js"><link rel="prefetch" href="/assets/js/179.c998f0ca.js"><link rel="prefetch" href="/assets/js/18.2e77c8d1.js"><link rel="prefetch" href="/assets/js/180.4f6b395f.js"><link rel="prefetch" href="/assets/js/181.577a5325.js"><link rel="prefetch" href="/assets/js/182.6b43cbf2.js"><link rel="prefetch" href="/assets/js/183.cf9e9cca.js"><link rel="prefetch" href="/assets/js/184.f0e76def.js"><link rel="prefetch" href="/assets/js/185.2d3d8eea.js"><link rel="prefetch" href="/assets/js/186.4db71601.js"><link rel="prefetch" href="/assets/js/187.8b6a6829.js"><link rel="prefetch" href="/assets/js/188.4a0b8f41.js"><link rel="prefetch" href="/assets/js/189.0a28241b.js"><link rel="prefetch" href="/assets/js/19.51c97d4c.js"><link rel="prefetch" href="/assets/js/190.5001309c.js"><link rel="prefetch" href="/assets/js/191.42778cf1.js"><link rel="prefetch" href="/assets/js/192.fabd1cb0.js"><link rel="prefetch" href="/assets/js/193.cbc113b8.js"><link rel="prefetch" href="/assets/js/194.4cf24763.js"><link rel="prefetch" href="/assets/js/195.ea5d1afb.js"><link rel="prefetch" href="/assets/js/196.16115ce4.js"><link rel="prefetch" href="/assets/js/197.b90179d1.js"><link rel="prefetch" href="/assets/js/198.456ceb51.js"><link rel="prefetch" href="/assets/js/199.a28de97a.js"><link rel="prefetch" href="/assets/js/20.79989fc4.js"><link rel="prefetch" href="/assets/js/200.72102ac7.js"><link rel="prefetch" href="/assets/js/201.e2b3a297.js"><link rel="prefetch" href="/assets/js/202.d4283e12.js"><link rel="prefetch" href="/assets/js/203.6e5e6596.js"><link rel="prefetch" href="/assets/js/204.363863cf.js"><link rel="prefetch" href="/assets/js/205.d16c5a36.js"><link rel="prefetch" href="/assets/js/206.dc867263.js"><link rel="prefetch" href="/assets/js/207.acfeaaaa.js"><link rel="prefetch" href="/assets/js/208.22c49054.js"><link rel="prefetch" href="/assets/js/209.0f7c526b.js"><link rel="prefetch" href="/assets/js/21.1b619a3f.js"><link rel="prefetch" href="/assets/js/210.b247a678.js"><link rel="prefetch" href="/assets/js/211.fe8629a4.js"><link rel="prefetch" href="/assets/js/212.48b672e5.js"><link rel="prefetch" href="/assets/js/213.08f571a8.js"><link rel="prefetch" href="/assets/js/214.04da1824.js"><link rel="prefetch" href="/assets/js/215.f60b57f4.js"><link rel="prefetch" href="/assets/js/216.4383ceb6.js"><link rel="prefetch" href="/assets/js/217.3b1ce286.js"><link rel="prefetch" href="/assets/js/218.1534ef52.js"><link rel="prefetch" href="/assets/js/219.6901e38c.js"><link rel="prefetch" href="/assets/js/22.349d3a16.js"><link rel="prefetch" href="/assets/js/220.22e0c5ea.js"><link rel="prefetch" href="/assets/js/221.2e7a5a4f.js"><link rel="prefetch" href="/assets/js/222.76b63073.js"><link rel="prefetch" href="/assets/js/223.500a058f.js"><link rel="prefetch" href="/assets/js/224.7f7c1250.js"><link rel="prefetch" href="/assets/js/225.2f183cbe.js"><link rel="prefetch" href="/assets/js/23.712dd5ac.js"><link rel="prefetch" href="/assets/js/24.77ae5052.js"><link rel="prefetch" href="/assets/js/25.e95f81fb.js"><link rel="prefetch" href="/assets/js/26.82cdd880.js"><link rel="prefetch" href="/assets/js/27.427a5aec.js"><link rel="prefetch" href="/assets/js/28.e245952d.js"><link rel="prefetch" href="/assets/js/29.50596e31.js"><link rel="prefetch" href="/assets/js/3.4f4335cf.js"><link rel="prefetch" href="/assets/js/30.016e73a0.js"><link rel="prefetch" href="/assets/js/31.fb0b0b40.js"><link rel="prefetch" href="/assets/js/32.8e7d8efe.js"><link rel="prefetch" href="/assets/js/33.f05f242b.js"><link rel="prefetch" href="/assets/js/34.893b8c3e.js"><link rel="prefetch" href="/assets/js/35.f98d31b7.js"><link rel="prefetch" href="/assets/js/36.6a5744a0.js"><link rel="prefetch" href="/assets/js/37.67e8976d.js"><link rel="prefetch" href="/assets/js/38.2d8447e0.js"><link rel="prefetch" href="/assets/js/39.3b3fde85.js"><link rel="prefetch" href="/assets/js/4.93e1dc89.js"><link rel="prefetch" href="/assets/js/40.8cde36eb.js"><link rel="prefetch" href="/assets/js/41.9df0f821.js"><link rel="prefetch" href="/assets/js/42.c9f1a26b.js"><link rel="prefetch" href="/assets/js/43.fa088c07.js"><link rel="prefetch" href="/assets/js/44.121055e3.js"><link rel="prefetch" href="/assets/js/45.7995c3a0.js"><link rel="prefetch" href="/assets/js/46.17d53a2e.js"><link rel="prefetch" href="/assets/js/47.4a374966.js"><link rel="prefetch" href="/assets/js/48.733e5b6c.js"><link rel="prefetch" href="/assets/js/49.0fb92742.js"><link rel="prefetch" href="/assets/js/5.f52855e6.js"><link rel="prefetch" href="/assets/js/50.50fc5031.js"><link rel="prefetch" href="/assets/js/51.69d8d52a.js"><link rel="prefetch" href="/assets/js/52.d84cedc3.js"><link rel="prefetch" href="/assets/js/53.a64ddaf4.js"><link rel="prefetch" href="/assets/js/54.15e09103.js"><link rel="prefetch" href="/assets/js/55.0f7e8fd5.js"><link rel="prefetch" href="/assets/js/56.6cb5bf13.js"><link rel="prefetch" href="/assets/js/57.d90d9da6.js"><link rel="prefetch" href="/assets/js/58.2c03a905.js"><link rel="prefetch" href="/assets/js/59.02cf613a.js"><link rel="prefetch" href="/assets/js/6.0ff35647.js"><link rel="prefetch" href="/assets/js/60.bb6d2b2f.js"><link rel="prefetch" href="/assets/js/61.ef2abfd3.js"><link rel="prefetch" href="/assets/js/62.b09e5f81.js"><link rel="prefetch" href="/assets/js/63.6ca85ec7.js"><link rel="prefetch" href="/assets/js/64.77eab656.js"><link rel="prefetch" href="/assets/js/65.65b00883.js"><link rel="prefetch" href="/assets/js/66.040b5d23.js"><link rel="prefetch" href="/assets/js/67.23318ab1.js"><link rel="prefetch" href="/assets/js/68.5c29433f.js"><link rel="prefetch" href="/assets/js/69.90978695.js"><link rel="prefetch" href="/assets/js/7.463451e9.js"><link rel="prefetch" href="/assets/js/70.0c585fbd.js"><link rel="prefetch" href="/assets/js/71.120e4ae5.js"><link rel="prefetch" href="/assets/js/72.53bf1e3a.js"><link rel="prefetch" href="/assets/js/73.282f5b35.js"><link rel="prefetch" href="/assets/js/74.4f1cb67d.js"><link rel="prefetch" href="/assets/js/75.f5d3ea1e.js"><link rel="prefetch" href="/assets/js/76.fb173587.js"><link rel="prefetch" href="/assets/js/77.8064b022.js"><link rel="prefetch" href="/assets/js/78.d26f8075.js"><link rel="prefetch" href="/assets/js/79.6cff2fa5.js"><link rel="prefetch" href="/assets/js/8.d5f74857.js"><link rel="prefetch" href="/assets/js/81.c0a214a2.js"><link rel="prefetch" href="/assets/js/82.f0c93ca2.js"><link rel="prefetch" href="/assets/js/83.db6f55e1.js"><link rel="prefetch" href="/assets/js/84.b0a7a28c.js"><link rel="prefetch" href="/assets/js/85.db7376d4.js"><link rel="prefetch" href="/assets/js/86.96ec3402.js"><link rel="prefetch" href="/assets/js/87.ae41a109.js"><link rel="prefetch" href="/assets/js/88.d83c21c8.js"><link rel="prefetch" href="/assets/js/89.33868490.js"><link rel="prefetch" href="/assets/js/9.2680f96d.js"><link rel="prefetch" href="/assets/js/90.ed48459a.js"><link rel="prefetch" href="/assets/js/91.e1ee23ba.js"><link rel="prefetch" href="/assets/js/92.8b354527.js"><link rel="prefetch" href="/assets/js/93.0682d2e4.js"><link rel="prefetch" href="/assets/js/94.105580aa.js"><link rel="prefetch" href="/assets/js/95.d378d658.js"><link rel="prefetch" href="/assets/js/96.a6460598.js"><link rel="prefetch" href="/assets/js/97.a4cc955f.js"><link rel="prefetch" href="/assets/js/98.9a600d4f.js"><link rel="prefetch" href="/assets/js/99.45007523.js">
    <link rel="stylesheet" href="/assets/css/0.styles.53c04193.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Young's blog" class="logo"> <span class="site-name can-hide">Young's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Spring/" class="nav-link">Spring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章1</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/andanyang/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>Young</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Spring/" class="nav-link">Spring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章1</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/andanyang/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hadoop</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>kafka</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kafaka/introduction/" class="sidebar-link">kafka3.0入门</a></li><li><a href="/kafaka/producer/" class="sidebar-link">kafka3.0 生产者</a></li><li><a href="/kafka/broker/" class="sidebar-link">kafka3.0 broker</a></li><li><a href="/kafka/consumer/" class="sidebar-link">Kafka 消费者</a></li><li><a href="/kafka/Kafka_Kraft/" class="sidebar-link">Kafka-Kraft 模式</a></li><li><a href="/kafka/Kafka_Workflow/" class="sidebar-link">Kafka 整体流程</a></li><li><a href="/kafka/Kafka_Idempotent_transactional/" class="sidebar-link">Kafka 幂等性和事务</a></li><li><a href="/kafka/Kafka_integration/" class="sidebar-link">Kafka 外部系统集成 Springboot</a></li><li><a href="/kafka/Kafka_Production_tuning/" aria-current="page" class="active sidebar-link">Kafka生产调优手册</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_1-1-场景说明" class="sidebar-link">1.1 场景说明</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_1-2-服务器台数选择" class="sidebar-link">1.2 服务器台数选择</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_1-3-磁盘选择" class="sidebar-link">1.3 磁盘选择</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_1-4-内存选择" class="sidebar-link">1.4 内存选择</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_1-5-cpu-选择" class="sidebar-link">1.5 CPU 选择</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_1-6-网络选择" class="sidebar-link">1.6 网络选择</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_2-1-kafka-生产者核心参数配置" class="sidebar-link">2.1 Kafka 生产者核心参数配置</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_2-2-生产者如何提高吞吐量" class="sidebar-link">2.2 生产者如何提高吞吐量</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_2-3-数据可靠性" class="sidebar-link">2.3 数据可靠性</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_2-4-数据去重" class="sidebar-link">2.4 数据去重</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_2-5-数据有序" class="sidebar-link">2.5 数据有序</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_2-6-数据乱序" class="sidebar-link">2.6 数据乱序</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_3-1-broker-核心参数配置" class="sidebar-link">3.1 Broker 核心参数配置</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_3-2-服役新节点-退役旧节点" class="sidebar-link">3.2 服役新节点/退役旧节点</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_3-3-增加分区" class="sidebar-link">3.3 增加分区</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_3-4-增加副本因子" class="sidebar-link">3.4 增加副本因子</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_3-5-手动调整分区副本存储" class="sidebar-link">3.5 手动调整分区副本存储</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_3-6-leader-partition-负载平衡" class="sidebar-link">3.6 Leader Partition 负载平衡</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_3-7-自动创建主题" class="sidebar-link">3.7 自动创建主题</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_4-6-消费者如何提高吞吐量" class="sidebar-link">4.6 消费者如何提高吞吐量</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_5-1-如何提升吞吐量" class="sidebar-link">5.1 如何提升吞吐量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_1-提升生产吞吐量" class="sidebar-link">1）提升生产吞吐量</a></li><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_2-增加分区" class="sidebar-link">2）增加分区</a></li><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_3-消费者提高吞吐量" class="sidebar-link">3）消费者提高吞吐量</a></li><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_4-增加下游消费者处理能力" class="sidebar-link">4）增加下游消费者处理能力</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_5-2-数据精准一次" class="sidebar-link">5.2 数据精准一次</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_1-生产者角度" class="sidebar-link">1）生产者角度</a></li><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_2-broker-服务端角度" class="sidebar-link">2）broker 服务端角度</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_3-消费者" class="sidebar-link">3）消费者</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/kafka/Kafka_Production_tuning/#_5-3-合理设置分区数" class="sidebar-link">5.3 合理设置分区数</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_5-4-单条日志大于-1m" class="sidebar-link">5.4 单条日志大于 1m</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_5-5-服务器挂了" class="sidebar-link">5.5 服务器挂了</a></li><li class="sidebar-sub-header level2"><a href="/kafka/Kafka_Production_tuning/#_5-6-集群压力测试" class="sidebar-link">5.6 集群压力测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_1-kafka-压测" class="sidebar-link">1）Kafka 压测</a></li><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_2-kafka-producer-压力测试" class="sidebar-link">2）Kafka Producer 压力测试</a></li><li class="sidebar-sub-header level4"><a href="/kafka/Kafka_Production_tuning/#_3-kafka-consumer-压力测试" class="sidebar-link">3）Kafka Consumer 压力测试</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flume</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>hive</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>scala</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>spark</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E5%A4%A7%E6%95%B0%E6%8D%AE" title="分类" data-v-06225672>大数据</a></li><li data-v-06225672><a href="/categories/?category=kafka" title="分类" data-v-06225672>kafka</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/andanyoung" target="_blank" title="作者" class="beLink" data-v-06225672>andanyang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-09-24</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Kafka生产调优手册<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="第-1-章-kafka-硬件配置选择"><a href="#第-1-章-kafka-硬件配置选择" class="header-anchor">#</a> 第 1 章 Kafka 硬件配置选择</h1> <h2 id="_1-1-场景说明"><a href="#_1-1-场景说明" class="header-anchor">#</a> 1.1 场景说明</h2> <p>100 万日活，每人每天 100 条日志，每天总共的日志条数是 100 万 * 100 条 = 1 亿条。</p> <p>1 亿/24 小时/60 分/60 秒 = 1150 条/每秒钟。</p> <p>每条日志大小：0.5k - 2k（取 1k）。</p> <p>1150 条/每秒钟 * 1k ≈ 1m/s 。</p> <p>高峰期每秒钟：1150 条 * 20 倍 = 23000 条。</p> <p>每秒多少数据量：20MB/s。</p> <h2 id="_1-2-服务器台数选择"><a href="#_1-2-服务器台数选择" class="header-anchor">#</a> 1.2 服务器台数选择</h2> <p>服务器台数 = 2 _ （生产者峰值生产速率 _ 副本 / 100） + 1</p> <p>​ = 2 _ （20m/s _ 2 / 100） + 1</p> <p>​ = 3 台</p> <p>建议 3 台服务器。</p> <h2 id="_1-3-磁盘选择"><a href="#_1-3-磁盘选择" class="header-anchor">#</a> 1.3 磁盘选择</h2> <p>kafka 底层主要是<strong>顺序写</strong>，固态硬盘和机械硬盘的顺序写速度差不多。</p> <p>建议选择普通的机械硬盘。</p> <p>每天总数据量：1 亿条 * 1k ≈ 100g</p> <p>100g _ 副本 2 _ 保存时间 3 天 / 0.7 ≈ 1T</p> <p>建议三台服务器硬盘总大小，大于等于 1T。</p> <h2 id="_1-4-内存选择"><a href="#_1-4-内存选择" class="header-anchor">#</a> 1.4 内存选择</h2> <p>Kafka 内存组成：堆内存 + 页缓存</p> <p>1）Kafka 堆内存建议每个节点：10g ~ 15</p> <p>在 kafka-server-start.sh 中修改</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if [ &quot;x$KAFKA_HEAP_OPTS&quot; = &quot;x&quot; ]; then
 export KAFKA_HEAP_OPTS=&quot;-Xmx10G -Xms10G&quot;
fi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（1）查看 Kafka 进程号</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop102 kafka]$ jps
2321 Kafka
5255 Jps
1931 QuorumPeerMain
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>（2）根据 Kafka 进程号，查看 Kafka 的 GC 情</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop102 kafka]$ jstat -gc 2321 1s 10
S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT GCT
0.0 7168.0 0.0 7168.0 103424.0 60416.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 60416.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 60416.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 60416.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 60416.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 61440.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 61440.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 61440.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 61440.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531
0.0 7168.0 0.0 7168.0 103424.0 61440.0 1986560.0 148433.5 52092.0 46656.1 6780.0 6202.2 13 0.531 0 0.000 0.531

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>参数说明：</p> <p>S0C：第一个幸存区的大小；</p> <p>S1C：第二个幸存区的大小</p> <p>S0U：第一个幸存区的使用大小；</p> <p>S1U：第二个幸存区的使用大小</p> <p>EC：伊甸园区的大小；</p> <p>EU：伊甸园区的使用大小</p> <p>OC：老年代大小；</p> <p>OU：老年代使用大小</p> <p>MC：方法区大小；</p> <p>MU：方法区使用大小</p> <p>CCSC:压缩类空间大小；</p> <p>CCSU:压缩类空间使用大小</p> <p>YGC：年轻代垃圾回收次数；</p> <p>YGCT：年轻代垃圾回收消耗时间</p> <p>FGC：老年代垃圾回收次数；</p> <p>FGCT：老年代垃圾回收消耗时间</p> <p>GCT：垃圾回收消耗总时间；</p> <p>（3）根据 Kafka 进程号，查看 Kafka 的堆内存</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop102 kafka]$ jmap -heap 2321
Attaching to process ID 2321, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 25.212-b10

using thread-local object allocation.
Garbage-First (G1) GC with 8 thread(s)

Heap Configuration:
 MinHeapFreeRatio = 40
 MaxHeapFreeRatio = 70
 MaxHeapSize = 2147483648 (2048.0MB)
 NewSize = 1363144 (1.2999954223632812MB)
 MaxNewSize = 1287651328 (1228.0MB)
 OldSize = 5452592 (5.1999969482421875MB)
 NewRatio = 2
 SurvivorRatio = 8
 MetaspaceSize = 21807104 (20.796875MB)
 CompressedClassSpaceSize = 1073741824 (1024.0MB)
 MaxMetaspaceSize = 17592186044415 MB
 G1HeapRegionSize = 1048576 (1.0MB)

Heap Usage:
G1 Heap:
 regions = 2048
 capacity = 2147483648 (2048.0MB)
 used = 246367744 (234.95458984375MB)
 free = 1901115904 (1813.04541015625MB)
 11.472392082214355% used
G1 Young Generation:
Eden Space:
 regions = 83
 capacity = 105906176 (101.0MB)
 used = 87031808 (83.0MB)
 free = 18874368 (18.0MB)
 82.17821782178218% used
Survivor Space:
 regions = 7
 capacity = 7340032 (7.0MB)
 used = 7340032 (7.0MB)
 free = 0 (0.0MB)
 100.0% used
G1 Old Generation:
 regions = 147
 capacity = 2034237440 (1940.0MB)
 used = 151995904 (144.95458984375MB)
 free = 1882241536 (1795.04541015625MB)
 7.471886074420103% used

13364 interned Strings occupying 1449608 bytes.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>2）页缓存：页缓存是 Linux 系统服务器的内存**。我们只需要保证 1 个 segment（1g）中 25%**的数据在内存中就好。</p> <p>每个节点页缓存大小 =（分区数 _ 1g _ 25%）/ 节点数。例如 10 个分区，页缓存大小 =（10 _ 1g _ 25%）/ 3 ≈ 1g</p> <p>建议服务器内存大于等于 11G。</p> <h2 id="_1-5-cpu-选择"><a href="#_1-5-cpu-选择" class="header-anchor">#</a> 1.5 CPU 选择</h2> <ul><li><p><code>num.io.threads = 8</code> 负责写磁盘的线程数，整个参数值要占总核数的 50%。</p></li> <li><p><code>num.replica.fetchers = 1</code> 副本拉取线程数，这个参数占总核数的 50%的 1/3。</p></li> <li><p><code>num.network.threads = 3</code> 数据传输线程数，这个参数占总核数的 50%的 2/3。</p></li></ul> <p>建议 32 个 cpu core。</p> <h2 id="_1-6-网络选择"><a href="#_1-6-网络选择" class="header-anchor">#</a> 1.6 网络选择</h2> <p>网络带宽 = 峰值吞吐量 ≈ 20MB/s 选择千兆网卡即可。</p> <p>100Mbps 单位是 bit；10M/s 单位是 byte ; 1byte = 8bit，100Mbps/8 = 12.5M/s。</p> <p>一般百兆的网卡（100Mbps ）、千兆的网卡（1000Mbps）、万兆的网卡（10000Mbps）。</p> <h1 id="第-2-章-kafka-生产者"><a href="#第-2-章-kafka-生产者" class="header-anchor">#</a> 第 2 章 Kafka 生产者</h1> <blockquote><p>3.1.1 Updating Broker Configs</p> <p>From Kafka version 1.1 onwards, some of the broker configs can be updated without restarting the broker. See the Dynamic Update Mode column in Broker Configs for the update mode of each broker config.</p> <p><strong>read-only</strong>: Requires a broker restart for update</p> <p><strong>per-broker</strong>: May be updated dynamically for each broker</p> <p><strong>cluster-wide</strong>: May be updated dynamically as a cluster-wide default. May also be updated as a per-broker value for testing.</p> <p>May also be updated as a per-broker value for testing.</p></blockquote> <h2 id="_2-1-kafka-生产者核心参数配置"><a href="#_2-1-kafka-生产者核心参数配置" class="header-anchor">#</a> 2.1 Kafka 生产者核心参数配置</h2> <p><img src="/assets/img/image-20230920224352147.6f8542b5.png" alt="发送流程"></p> <table><thead><tr><th>参数名称</th> <th>描述</th></tr></thead> <tbody><tr><td>bootstrap.servers</td> <td>生产者连接集群所需的 broker 地 址清单 。 例 如 hadoop102:9092,hadoop103:9092,hadoop104:9092，可以设置 1 个或者多个，中间用逗号隔开。注意这里并<strong>非需要所有的 broker 地址</strong>，因为生产者从给定的 broker 里查找到其他 broker 信息。</td></tr> <tr><td>key.serializer 和 value.serializer</td> <td>指定发送消息的 key 和 value 的序列化类型。一定要写 全类名。</td></tr> <tr><td>buffer.memory</td> <td>RecordAccumulator 缓冲区总大小，<strong>默认 32m。</strong></td></tr> <tr><td>batch.size</td> <td>缓冲区一批数据最大值，默认 16k。适当增加该值，可 以提高吞吐量，但是如果该值设置太大，会导致数据 传输延迟增加。</td></tr> <tr><td>linger.ms</td> <td>如果数据迟迟未达到 batch.size，sender 等待 linger.time 之后就会发送数据。单位 ms，<strong>默认值是 0ms</strong>，表示没有延迟。生产环境建议该值大小为 5-100ms 之间。</td></tr> <tr><td>acks</td> <td>0：生产者发送过来的数据，不需要等数据落盘应答。 1：生产者发送过来的数据，Leader 收到数据后应答。 -1（all）：生产者发送过来的数据，Leader+和 isr 队列里面的所有节点收齐数据后应答。<strong>默认值是-1，-1 和 all 是等价的。</strong></td></tr> <tr><td>max.in.flight.requests.per.connection</td> <td>允许最多没有返回 ack 的次数，<strong>默认为 5</strong>，开启幂等性要保证该值是 1-5 的数字。</td></tr> <tr><td>retries</td> <td>当消息发送出现错误的时候，系统会重发消息。retries 表示重试次数。<strong>默认是 int 最大值，2147483647</strong>。 如果设置了重试，还想保证消息的有序性，需要设置 MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION=1 否则在重试此失败消息的时候，其他的消息可能发送成功了。</td></tr> <tr><td>retry.backoff.ms</td> <td>两次重试之间的时间间隔，默认是 100ms。</td></tr> <tr><td>enable.idempotence</td> <td>是否开启幂等性，<strong>默认 true</strong>，开启幂等性。</td></tr> <tr><td>compression.type</td> <td>生产者发送的所有数据的压缩方式。<strong>默认是 none</strong>，也就是不压缩。 支持压缩类型：<strong>none、gzip、snappy、lz4 和 zstd。</strong></td></tr></tbody></table> <h2 id="_2-2-生产者如何提高吞吐量"><a href="#_2-2-生产者如何提高吞吐量" class="header-anchor">#</a> 2.2 生产者如何提高吞吐量</h2> <table><thead><tr><th>参数名称</th> <th>描述</th></tr></thead> <tbody><tr><td>buffer.memory</td> <td>RecordAccumulator 缓冲区总大小，默认 <strong>32m。</strong></td></tr> <tr><td>batch.size</td> <td>缓冲区一批数据最大值，默认 16k。适当增加该值，可 以提高吞吐量，但是如果该值设置太大，会导致数据传 输延迟增加。</td></tr> <tr><td>linger.ms</td> <td>如果数据迟迟未达到 batch.size，sender 等待 linger.time 之后就会发送数据。单位 ms，<strong>默认值是 0ms</strong>，表示没有 延迟。生产环境建议该值大小为 5-100ms 之间。</td></tr> <tr><td>compression.type</td> <td>生产者发送的所有数据的压缩方式。<strong>默认是 none</strong>，也就 是不压缩。 支持压缩类型：<strong>none、gzip、snappy、lz4 和 zstd。</strong></td></tr></tbody></table> <h2 id="_2-3-数据可靠性"><a href="#_2-3-数据可靠性" class="header-anchor">#</a> 2.3 数据可靠性</h2> <table><thead><tr><th>参数名称</th> <th>描述</th></tr></thead> <tbody><tr><td>acks</td> <td>0：生产者发送过来的数据，不需要等数据落盘应答。<br>1：生产者发送过来的数据，Leader 收到数据后应答。<br>-1（all）：生产者发送过来的数据，Leader+和 isr 队列 里面的所有节点收齐数据后应答。<strong>默认值是-1，-1 和 all 是等价的。</strong></td></tr></tbody></table> <ul><li>至少一次（At Least Once）= ACK 级别设置为-1 + 分区副本大于等于 2 + ISR 里应答的最小副本数量大于等于 2</li></ul> <h2 id="_2-4-数据去重"><a href="#_2-4-数据去重" class="header-anchor">#</a> 2.4 数据去重</h2> <p>1）配置参数</p> <p><code>enable.idempotence</code> : 是否开启幂等性，<strong>默认 true</strong>，表示开启幂等性。</p> <p>2）Kafka 的事务一共有如下 5 个 API</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 1 初始化事务
void initTransactions();
// 2 开启事务
void beginTransaction() throws ProducerFencedException;
// 3 在事务内提交已经消费的偏移量（主要用于消费者）
void sendOffsetsToTransaction(Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets,
 String consumerGroupId) throws
ProducerFencedException;
// 4 提交事务
void commitTransaction() throws ProducerFencedException;
// 5 放弃事务（类似于回滚事务的操作）
void abortTransaction() throws ProducerFencedException;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_2-5-数据有序"><a href="#_2-5-数据有序" class="header-anchor">#</a> 2.5 数据有序</h2> <p>单分区内，有序（有条件的，不能乱序）；多分区，分区与分区间无序；</p> <h2 id="_2-6-数据乱序"><a href="#_2-6-数据乱序" class="header-anchor">#</a> 2.6 数据乱序</h2> <table><thead><tr><th>参数名称</th> <th>描述</th></tr></thead> <tbody><tr><td>enable.idempotence</td> <td>是否开启幂等性，<strong>默认 true</strong>，表示开启幂等性。</td></tr> <tr><td>max.in.flight.requests.per.connection</td> <td>允许最多没有返回 ack 的次数，<strong>默认为 5</strong>，开启幂等性要保证该值是 1-5 的数字。</td></tr></tbody></table> <h1 id="第-3-章-kafka-broker"><a href="#第-3-章-kafka-broker" class="header-anchor">#</a> 第 3 章 Kafka Broker</h1> <h2 id="_3-1-broker-核心参数配置"><a href="#_3-1-broker-核心参数配置" class="header-anchor">#</a> 3.1 Broker 核心参数配置</h2> <p><img src="/assets/img/image-20230921001137942.752c52b3.png" alt="Kafka Broker总体工作流程"></p> <table><thead><tr><th>参数名称</th> <th>描述</th></tr></thead> <tbody><tr><td>replica.lag.time.max.ms</td> <td>ISR 中，如果 Follower 长时间未向 Leader 发送通信请求或同步数据，则该 Follower 将被踢出 ISR。 该时间阈值，<strong>默认 30s。</strong></td></tr> <tr><td>auto.leader.rebalance.enable</td> <td><strong>默认是 true</strong>。 自动 Leader Partition 平衡。</td></tr> <tr><td>leader.imbalance.per.broker.percentage</td> <td><strong>默认是 10%。</strong> 每个 broker 允许的不平衡的 leader 的比率。如果每个 broker 超过了这个值，控制器 会触发 leader 的平衡。</td></tr> <tr><td>leader.imbalance.check.interval.seconds</td> <td><strong>默认值 300 秒</strong>。检查 leader 负载是否平衡的间隔时间。</td></tr> <tr><td>log.segment.bytes</td> <td>Kafka 中 log 日志是分成一块块存储的，此配置是指 log 日志划分成块的大小，<strong>默认值 1G。</strong></td></tr> <tr><td>log.index.interval.bytes</td> <td><strong>默认 4kb</strong>，kafka 里面每当写入了 4kb 大小的日志 （.log），然后就往 index 文件里面记录一个索引。</td></tr> <tr><td>log.retention.hours</td> <td>Kafka 中数据保存的时间，<strong>默认 7 天。</strong></td></tr> <tr><td>log.retention.minutes</td> <td>Kafka 中数据保存的时间，<strong>分钟级别</strong>，默认关闭。</td></tr> <tr><td>log.retention.ms</td> <td>Kafka 中数据保存的时间，<strong>毫秒级别</strong>，默认关闭。</td></tr> <tr><td>log.retention.check.interval.ms</td> <td>检查数据是否保存超时的间隔，<strong>默认是 5 分钟</strong>。</td></tr> <tr><td>log.retention.bytes</td> <td><strong>默认等于-1，表示无穷大</strong>。超过设置的所有日志总 大小，删除最早的 segment。</td></tr> <tr><td>log.cleanup.policy</td> <td><strong>默认是 delete</strong>，表示所有数据启用删除策略； 如果设置值为 compact，表示所有数据启用压缩策略。</td></tr> <tr><td>num.io.threads</td> <td><strong>默认是 8</strong>。负责写磁盘的线程数。整个参数值要占总核数的 50%。</td></tr> <tr><td>num.replica.fetchers</td> <td>副本拉取线程数，这个参数占总核数的 50%的 1/3</td></tr> <tr><td>num.network.threads</td> <td><strong>默认是 3</strong>。数据传输线程数，这个参数占总核数的 50%的 2/3 。</td></tr> <tr><td>log.flush.interval.messages</td> <td>强制页缓存刷写到磁盘的条数，默认是 long 的最大值，9223372036854775807。一般不建议修改， 交给系统自己管理。</td></tr> <tr><td>log.flush.interval.ms</td> <td>每隔多久，刷数据到磁盘，默认是 null。一般不建 议修改，交给系统自己管理。</td></tr></tbody></table> <h2 id="_3-2-服役新节点-退役旧节点"><a href="#_3-2-服役新节点-退役旧节点" class="header-anchor">#</a> 3.2 服役新节点/退役旧节点</h2> <h2 id="_3-3-增加分区"><a href="#_3-3-增加分区" class="header-anchor">#</a> 3.3 增加分区</h2> <h2 id="_3-4-增加副本因子"><a href="#_3-4-增加副本因子" class="header-anchor">#</a> 3.4 增加副本因子</h2> <h2 id="_3-5-手动调整分区副本存储"><a href="#_3-5-手动调整分区副本存储" class="header-anchor">#</a> 3.5 手动调整分区副本存储</h2> <h2 id="_3-6-leader-partition-负载平衡"><a href="#_3-6-leader-partition-负载平衡" class="header-anchor">#</a> 3.6 Leader Partition 负载平衡</h2> <h2 id="_3-7-自动创建主题"><a href="#_3-7-自动创建主题" class="header-anchor">#</a> 3.7 自动创建主题</h2> <p>如果 broker 端配置参数 <strong>auto.create.topics.enable</strong> 设置为 true（默认值是 true），那么当生产者向一个未创建的主题发送消息时，会自动创建一个分区数为 <code>num.partitions</code>（默认值为 1）、副本因子为 default.replication.factor（默认值为 1）的主题。除此之外，当一个消费者开始从未知主题中读取消息时，或者当任意一个客户端向未知主题发送元数据请求时，都会自动创建一个相应主题。这种创建主题的方式是非预期的，增加了主题管理和维护的难度。 生产环境建议将该参数设置为 false。</p> <p>1）向一个没有提前创建 five 主题发送数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop102 kafka]$ bin/kafka-console-producer.sh --bootstrap-server hadoop102:9092 --topic five
&gt;hello world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2）查看 five 主题的详情</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop102 kafka]$ bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --describe --topic five
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="第-4-章-kafka-消费者"><a href="#第-4-章-kafka-消费者" class="header-anchor">#</a> 第 4 章 Kafka 消费者</h1> <p><img src="/assets/img/image-20230925231845686.287b5636.png" alt="消费者组初始化流程"></p> <h2 id="_4-6-消费者如何提高吞吐量"><a href="#_4-6-消费者如何提高吞吐量" class="header-anchor">#</a> 4.6 消费者如何提高吞吐量</h2> <p>增加分区数；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop102 kafka]$ bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --alter --topic first --partitions 3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><table><thead><tr><th>参数名称</th> <th>描述</th></tr></thead> <tbody><tr><td>fetch.max.bytes</td> <td>默认 <strong>Default: 52428800（50 m</strong>）。消费者获取服务器端一批 消息最大的字节数。如果服务器端一批次的数据大于该值 （50m）仍然可以拉取回来这批数据，因此，这不是一个绝对 最大值。一批次的大小受 message.max.bytes （broker config） or max.message.bytes （topic config）影响。</td></tr> <tr><td>ax.poll.records</td> <td>一次 poll 拉取数据返回消息的最大条数，<strong>默认是 500 条</strong></td></tr></tbody></table> <h1 id="第-5-章-kafka-总体"><a href="#第-5-章-kafka-总体" class="header-anchor">#</a> 第 5 章 Kafka 总体</h1> <h2 id="_5-1-如何提升吞吐量"><a href="#_5-1-如何提升吞吐量" class="header-anchor">#</a> 5.1 如何提升吞吐量</h2> <h4 id="_1-提升生产吞吐量"><a href="#_1-提升生产吞吐量" class="header-anchor">#</a> 1）提升生产吞吐量</h4> <ul><li>（1）buffer.memory：发送消息的缓冲区大小，默认值是 32m，可以增加到 64m。</li> <li>（2）batch.size：默认是 16k。如果 batch 设置太小，会导致频繁网络请求，吞吐量下降； 如果 batch 太大，会导致一条消息需要等待很久才能被发送出去，增加网络延时。</li> <li>（3）linger.ms，这个值默认是 0，意思就是消息必须立即被发送。一般设置一个 5-100 毫秒。如果 linger.ms 设置的太小，会导致频繁网络请求，吞吐量下降；如果 linger.ms 太长， 会导致一条消息需要等待很久才能被发送出去，增加网络延时。</li> <li>（4）compression.type：默认是 none，不压缩，但是也可以使用 lz4 压缩，效率还是不错的，压缩之后可以减小数据量，提升吞吐量，但是会加大 producer 端的 CPU 开销。</li></ul> <h4 id="_2-增加分区"><a href="#_2-增加分区" class="header-anchor">#</a> 2）增加分区</h4> <h4 id="_3-消费者提高吞吐量"><a href="#_3-消费者提高吞吐量" class="header-anchor">#</a> 3）消费者提高吞吐量</h4> <p>（1）调整 fetch.max.bytes 大小，默认是 50m。</p> <p>（2）调整 max.poll.records 大小，默认是 500 条。</p> <h4 id="_4-增加下游消费者处理能力"><a href="#_4-增加下游消费者处理能力" class="header-anchor">#</a> 4）增加下游消费者处理能力</h4> <h2 id="_5-2-数据精准一次"><a href="#_5-2-数据精准一次" class="header-anchor">#</a> 5.2 数据精准一次</h2> <h4 id="_1-生产者角度"><a href="#_1-生产者角度" class="header-anchor">#</a> 1）生产者角度</h4> <ul><li>acks 设置为-1 （acks=-1）</li> <li>幂等性（enable.idempotence = true） + 事务 。</li></ul> <h4 id="_2-broker-服务端角度"><a href="#_2-broker-服务端角度" class="header-anchor">#</a> 2）broker 服务端角度</h4> <ul><li>分区副本大于等于 2 （--replication-factor 2）。</li> <li>ISR 里应答的最小副本数量大于等于 2 （min.insync.replicas = 2）。</li></ul> <h2 id="_3-消费者"><a href="#_3-消费者" class="header-anchor">#</a> 3）消费者</h2> <ul><li><strong>事务 + 手动提交 offset</strong> （enable.auto.commit = false）。</li> <li>消费者输出的目的地必须支持事务（MySQL、Kafka）。</li></ul> <h3 id="_5-3-合理设置分区数"><a href="#_5-3-合理设置分区数" class="header-anchor">#</a> 5.3 合理设置分区数</h3> <ul><li>（1）创建一个只有 1 个分区的 topic。</li> <li>（2）测试这个 topic 的 producer 吞吐量和 consumer 吞吐量。</li> <li>（3）假设他们的值分别是 Tp 和 Tc，单位可以是 MB/s</li> <li>（4）然后假设总的目标吞吐量是 Tt，那么分区数 = Tt / min（Tp，Tc）。</li></ul> <p>例如：producer 吞吐量 = 20m/s；consumer 吞吐量 = 50m/s，期望吞吐量 100m/s；</p> <p>分区数 = 100 / 20 = 5 分区</p> <p>分区数一般设置为：3-10 个</p> <p>分区数不是越多越好，也不是越少越好，需要搭建完集群，进行压测，再灵活调整分区个数。</p> <h2 id="_5-4-单条日志大于-1m"><a href="#_5-4-单条日志大于-1m" class="header-anchor">#</a> 5.4 单条日志大于 1m</h2> <table><thead><tr><th>参数名称</th> <th>描述</th></tr></thead> <tbody><tr><td>message.max.bytes</td> <td>默认 1m，broker 端接收每个批次消息最大值。</td></tr> <tr><td>max.request.size</td> <td>默认 1m，生产者发往 broker 每个请求消息最大值。针对 topic 级别设置消息体的大小。</td></tr> <tr><td>replica.fetch.max.bytes</td> <td>默认 1m，副本同步数据，每个批次消息最大值。</td></tr> <tr><td>fetch.max.bytes</td> <td>默认 Default: <strong>52428800（50 m）</strong>。消费者获取服务器端一批 消息最大的字节数。如果服务器端一批次的数据大于该值 （50m）仍然可以拉取回来这批数据，因此，这不是一个绝对 最大值。一批次的大小受 message.max.bytes （broker config） or max.message.bytes （topic config）影响。</td></tr></tbody></table> <h2 id="_5-5-服务器挂了"><a href="#_5-5-服务器挂了" class="header-anchor">#</a> 5.5 服务器挂了</h2> <p>在生产环境中，如果某个 Kafka 节点挂掉。</p> <p>正常处理办法：</p> <p>（1）先尝试重新启动一下，如果能启动正常，那直接解决。</p> <p>（2）如果重启不行，考虑增加内存、增加 CPU、网络带宽。</p> <p>（3）如果将 kafka 整个节点误删除，如果副本数大于等于 2，可以按照服役新节点的方式重新服役一个新节点，并执行负载均衡。</p> <h2 id="_5-6-集群压力测试"><a href="#_5-6-集群压力测试" class="header-anchor">#</a> 5.6 集群压力测试</h2> <h4 id="_1-kafka-压测"><a href="#_1-kafka-压测" class="header-anchor">#</a> 1）Kafka 压测</h4> <p>用 Kafka 官方自带的脚本，对 Kafka 进行压测。</p> <ul><li>生产者压测：kafka-producer-perf-test.sh</li> <li>消费者压测：kafka-consumer-perf-test.sh</li></ul> <p><img src="/assets/img/image-20230927233329228.73cc2d55.png" alt="群压力测试"></p> <h4 id="_2-kafka-producer-压力测试"><a href="#_2-kafka-producer-压力测试" class="header-anchor">#</a> 2）Kafka Producer 压力测试</h4> <p>（1）创建一个 test topic，设置为 3 个分区 3 个副本</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop102 kafka]$ bin/kafka-topics.sh --bootstrapserver hadoop102:9092 --create --replication-factor 3 --partitions 3 --topic test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）在/opt/module/kafka/bin 目录下面有这两个文件。我们来测试一下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop105 kafka]$ bin/kafka-producer-perf-test.sh --topic test --record-size 1024 --num-records 1000000 --throughput 10000 --producer-props bootstrap.servers=hadoop102:9092,hadoop103:9092,hadoop104:9092 batch.size=16384 linger.ms=0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数说明：</p> <ul><li>record-size 是一条信息有多大，单位是字节，本次测试设置为 1k。</li> <li>num-records 是总共发送多少条信息，本次测试设置为 100 万条。</li> <li>throughput 是每秒多少条信息，设成-1，表示不限流，尽可能快的生产数据，可测出生产者最大吞吐量。本次实验设置为每秒钟 1 万条。</li> <li>producer-props 后面可以配置生产者相关参数，batch.size 配置为 16k。</li></ul> <h4 id="_3-kafka-consumer-压力测试"><a href="#_3-kafka-consumer-压力测试" class="header-anchor">#</a> 3）Kafka Consumer 压力测试</h4> <p>（1）修改/opt/module/kafka/config/consumer.properties 文件中的一次拉取条数为 500</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>max.poll.records=500
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）消费 100 万条日志进行压测</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[atguigu@hadoop105 kafka]$ bin/kafka-consumer-perf-test.sh --bootstrap-server hadoop102:9092,hadoop103:9092,hadoop104:9092 --topic test --messages 1000000 --consumer.config config/consumer.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数说明:</p> <ul><li>--bootstrap-server 指定 Kafka 集群地址</li> <li>--topic 指定 topic 的名称</li> <li>--messages 总共要消费的消息个数。本次实验 100 万条。</li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/andanyang/vuepress-theme-vdoing/edit/master/docs/大数据/002.kafka/0021.Kafka生产调优手册.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/03/11, 02:40:47</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/kafka/Kafka_integration/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Kafka 外部系统集成 Springboot</div></a> <a href="/Flume/Overview_introduction/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Flume概述与入门</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kafka/Kafka_integration/" class="prev">Kafka 外部系统集成 Springboot</a></span> <span class="next"><a href="/Flume/Overview_introduction/">Flume概述与入门</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/bigdata/spark/SparkStreaming_Driver_Executer/"><div>
            spark中代码的执行位置（Driver or Executer）
            <!----></div></a> <span class="date">12-12</span></dt></dl><dl><dd>02</dd> <dt><a href="/bigdata/spark/SparkStreaming/"><div>
            大数据技术之 SparkStreaming
            <!----></div></a> <span class="date">12-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/bigdata/spark/sql/"><div>
            Spark 核心编程之 RDD 累加器与广播变量
            <!----></div></a> <span class="date">12-06</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1218853253@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/andanyang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Young | <a href="https://github.com/andanyoung/young-blog/blob/master/LICENSE" target="_blank">MIT License</a> <br/> <a  href="https://beian.miit.gov.cn/" target="_blank">浙ICP备20002744号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.e4caa6db.js" defer></script><script src="/assets/js/2.d1be14c5.js" defer></script><script src="/assets/js/80.29d746c7.js" defer></script>
  </body>
</html>
