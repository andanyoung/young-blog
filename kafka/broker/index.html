<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kafka3.0 broker | Young&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="Young丶java后端技术博客,专注后端学习与总结。擅长spring boot,JAVA基础总结,等方面的知识,关注spring,架构,elasticsearch,mysql领域.">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.53c04193.css" as="style"><link rel="preload" href="/assets/js/app.e4caa6db.js" as="script"><link rel="preload" href="/assets/js/2.d1be14c5.js" as="script"><link rel="preload" href="/assets/js/45.7995c3a0.js" as="script"><link rel="prefetch" href="/assets/js/10.20449a2b.js"><link rel="prefetch" href="/assets/js/100.f25e73b5.js"><link rel="prefetch" href="/assets/js/101.3180ba9d.js"><link rel="prefetch" href="/assets/js/102.fcd415ea.js"><link rel="prefetch" href="/assets/js/103.522869bb.js"><link rel="prefetch" href="/assets/js/104.5da1e4e4.js"><link rel="prefetch" href="/assets/js/105.e5a40fe8.js"><link rel="prefetch" href="/assets/js/106.627d6279.js"><link rel="prefetch" href="/assets/js/107.606beca1.js"><link rel="prefetch" href="/assets/js/108.100e1cb2.js"><link rel="prefetch" href="/assets/js/109.9765392e.js"><link rel="prefetch" href="/assets/js/11.da3512b5.js"><link rel="prefetch" href="/assets/js/110.b73cf0d9.js"><link rel="prefetch" href="/assets/js/111.3f77dd60.js"><link rel="prefetch" href="/assets/js/112.0c7d547d.js"><link rel="prefetch" href="/assets/js/113.1827c266.js"><link rel="prefetch" href="/assets/js/114.daf1d8a5.js"><link rel="prefetch" href="/assets/js/115.e7dca24d.js"><link rel="prefetch" href="/assets/js/116.11b303de.js"><link rel="prefetch" href="/assets/js/117.203cefba.js"><link rel="prefetch" href="/assets/js/118.61d8527b.js"><link rel="prefetch" href="/assets/js/119.1f959a37.js"><link rel="prefetch" href="/assets/js/12.11f18e06.js"><link rel="prefetch" href="/assets/js/120.c268b7aa.js"><link rel="prefetch" href="/assets/js/121.64318c96.js"><link rel="prefetch" href="/assets/js/122.cbddb70d.js"><link rel="prefetch" href="/assets/js/123.b49b84fb.js"><link rel="prefetch" href="/assets/js/124.392f030b.js"><link rel="prefetch" href="/assets/js/125.45f631c4.js"><link rel="prefetch" href="/assets/js/126.700cc575.js"><link rel="prefetch" href="/assets/js/127.d649cb2a.js"><link rel="prefetch" href="/assets/js/128.bc018411.js"><link rel="prefetch" href="/assets/js/129.d0a74611.js"><link rel="prefetch" href="/assets/js/13.1cb33dc8.js"><link rel="prefetch" href="/assets/js/130.45b1f75c.js"><link rel="prefetch" href="/assets/js/131.45ba93df.js"><link rel="prefetch" href="/assets/js/132.c58bbbd7.js"><link rel="prefetch" href="/assets/js/133.7f53922e.js"><link rel="prefetch" href="/assets/js/134.ddf0d780.js"><link rel="prefetch" href="/assets/js/135.ada3af13.js"><link rel="prefetch" href="/assets/js/136.4097c2be.js"><link rel="prefetch" href="/assets/js/137.fc910ac9.js"><link rel="prefetch" href="/assets/js/138.9628f460.js"><link rel="prefetch" href="/assets/js/139.3125ef74.js"><link rel="prefetch" href="/assets/js/14.1004ce43.js"><link rel="prefetch" href="/assets/js/140.bb53ac81.js"><link rel="prefetch" href="/assets/js/141.a002ac19.js"><link rel="prefetch" href="/assets/js/142.540d19e4.js"><link rel="prefetch" href="/assets/js/143.4cbccfca.js"><link rel="prefetch" href="/assets/js/144.8a217b6a.js"><link rel="prefetch" href="/assets/js/145.9c7bc0de.js"><link rel="prefetch" href="/assets/js/146.3dfd0773.js"><link rel="prefetch" href="/assets/js/147.bc0f0d42.js"><link rel="prefetch" href="/assets/js/148.e0cdc4d5.js"><link rel="prefetch" href="/assets/js/149.8486db6e.js"><link rel="prefetch" href="/assets/js/15.703e8784.js"><link rel="prefetch" href="/assets/js/150.5f3b7fb5.js"><link rel="prefetch" href="/assets/js/151.98a3f202.js"><link rel="prefetch" href="/assets/js/152.2940f2ba.js"><link rel="prefetch" href="/assets/js/153.75f3a085.js"><link rel="prefetch" href="/assets/js/154.fa2da83b.js"><link rel="prefetch" href="/assets/js/155.113be5c8.js"><link rel="prefetch" href="/assets/js/156.0667e7f5.js"><link rel="prefetch" href="/assets/js/157.0b3e5dfa.js"><link rel="prefetch" href="/assets/js/158.a338bdd7.js"><link rel="prefetch" href="/assets/js/159.33c9771c.js"><link rel="prefetch" href="/assets/js/16.71e3d898.js"><link rel="prefetch" href="/assets/js/160.e868c8b3.js"><link rel="prefetch" href="/assets/js/161.cf61955e.js"><link rel="prefetch" href="/assets/js/162.baee00ca.js"><link rel="prefetch" href="/assets/js/163.183cde82.js"><link rel="prefetch" href="/assets/js/164.c1eadef5.js"><link rel="prefetch" href="/assets/js/165.70ee8a24.js"><link rel="prefetch" href="/assets/js/166.8e185ff2.js"><link rel="prefetch" href="/assets/js/167.0881cf57.js"><link rel="prefetch" href="/assets/js/168.88caf424.js"><link rel="prefetch" href="/assets/js/169.e7e984ff.js"><link rel="prefetch" href="/assets/js/17.b0356f05.js"><link rel="prefetch" href="/assets/js/170.c7052d81.js"><link rel="prefetch" href="/assets/js/171.2ab773fd.js"><link rel="prefetch" href="/assets/js/172.0e39f858.js"><link rel="prefetch" href="/assets/js/173.76661218.js"><link rel="prefetch" href="/assets/js/174.0ac9f795.js"><link rel="prefetch" href="/assets/js/175.da30bba2.js"><link rel="prefetch" href="/assets/js/176.0f230688.js"><link rel="prefetch" href="/assets/js/177.040e0937.js"><link rel="prefetch" href="/assets/js/178.68852030.js"><link rel="prefetch" href="/assets/js/179.c998f0ca.js"><link rel="prefetch" href="/assets/js/18.2e77c8d1.js"><link rel="prefetch" href="/assets/js/180.4f6b395f.js"><link rel="prefetch" href="/assets/js/181.577a5325.js"><link rel="prefetch" href="/assets/js/182.6b43cbf2.js"><link rel="prefetch" href="/assets/js/183.cf9e9cca.js"><link rel="prefetch" href="/assets/js/184.f0e76def.js"><link rel="prefetch" href="/assets/js/185.2d3d8eea.js"><link rel="prefetch" href="/assets/js/186.4db71601.js"><link rel="prefetch" href="/assets/js/187.8b6a6829.js"><link rel="prefetch" href="/assets/js/188.4a0b8f41.js"><link rel="prefetch" href="/assets/js/189.0a28241b.js"><link rel="prefetch" href="/assets/js/19.51c97d4c.js"><link rel="prefetch" href="/assets/js/190.5001309c.js"><link rel="prefetch" href="/assets/js/191.42778cf1.js"><link rel="prefetch" href="/assets/js/192.fabd1cb0.js"><link rel="prefetch" href="/assets/js/193.cbc113b8.js"><link rel="prefetch" href="/assets/js/194.4cf24763.js"><link rel="prefetch" href="/assets/js/195.ea5d1afb.js"><link rel="prefetch" href="/assets/js/196.16115ce4.js"><link rel="prefetch" href="/assets/js/197.b90179d1.js"><link rel="prefetch" href="/assets/js/198.456ceb51.js"><link rel="prefetch" href="/assets/js/199.a28de97a.js"><link rel="prefetch" href="/assets/js/20.79989fc4.js"><link rel="prefetch" href="/assets/js/200.72102ac7.js"><link rel="prefetch" href="/assets/js/201.e2b3a297.js"><link rel="prefetch" href="/assets/js/202.d4283e12.js"><link rel="prefetch" href="/assets/js/203.6e5e6596.js"><link rel="prefetch" href="/assets/js/204.363863cf.js"><link rel="prefetch" href="/assets/js/205.d16c5a36.js"><link rel="prefetch" href="/assets/js/206.dc867263.js"><link rel="prefetch" href="/assets/js/207.acfeaaaa.js"><link rel="prefetch" href="/assets/js/208.22c49054.js"><link rel="prefetch" href="/assets/js/209.0f7c526b.js"><link rel="prefetch" href="/assets/js/21.1b619a3f.js"><link rel="prefetch" href="/assets/js/210.b247a678.js"><link rel="prefetch" href="/assets/js/211.fe8629a4.js"><link rel="prefetch" href="/assets/js/212.48b672e5.js"><link rel="prefetch" href="/assets/js/213.08f571a8.js"><link rel="prefetch" href="/assets/js/214.04da1824.js"><link rel="prefetch" href="/assets/js/215.f60b57f4.js"><link rel="prefetch" href="/assets/js/216.4383ceb6.js"><link rel="prefetch" href="/assets/js/217.3b1ce286.js"><link rel="prefetch" href="/assets/js/218.1534ef52.js"><link rel="prefetch" href="/assets/js/219.6901e38c.js"><link rel="prefetch" href="/assets/js/22.349d3a16.js"><link rel="prefetch" href="/assets/js/220.22e0c5ea.js"><link rel="prefetch" href="/assets/js/221.2e7a5a4f.js"><link rel="prefetch" href="/assets/js/222.76b63073.js"><link rel="prefetch" href="/assets/js/223.500a058f.js"><link rel="prefetch" href="/assets/js/224.7f7c1250.js"><link rel="prefetch" href="/assets/js/225.2f183cbe.js"><link rel="prefetch" href="/assets/js/23.712dd5ac.js"><link rel="prefetch" href="/assets/js/24.77ae5052.js"><link rel="prefetch" href="/assets/js/25.e95f81fb.js"><link rel="prefetch" href="/assets/js/26.82cdd880.js"><link rel="prefetch" href="/assets/js/27.427a5aec.js"><link rel="prefetch" href="/assets/js/28.e245952d.js"><link rel="prefetch" href="/assets/js/29.50596e31.js"><link rel="prefetch" href="/assets/js/3.4f4335cf.js"><link rel="prefetch" href="/assets/js/30.016e73a0.js"><link rel="prefetch" href="/assets/js/31.fb0b0b40.js"><link rel="prefetch" href="/assets/js/32.8e7d8efe.js"><link rel="prefetch" href="/assets/js/33.f05f242b.js"><link rel="prefetch" href="/assets/js/34.893b8c3e.js"><link rel="prefetch" href="/assets/js/35.f98d31b7.js"><link rel="prefetch" href="/assets/js/36.6a5744a0.js"><link rel="prefetch" href="/assets/js/37.67e8976d.js"><link rel="prefetch" href="/assets/js/38.2d8447e0.js"><link rel="prefetch" href="/assets/js/39.3b3fde85.js"><link rel="prefetch" href="/assets/js/4.93e1dc89.js"><link rel="prefetch" href="/assets/js/40.8cde36eb.js"><link rel="prefetch" href="/assets/js/41.9df0f821.js"><link rel="prefetch" href="/assets/js/42.c9f1a26b.js"><link rel="prefetch" href="/assets/js/43.fa088c07.js"><link rel="prefetch" href="/assets/js/44.121055e3.js"><link rel="prefetch" href="/assets/js/46.17d53a2e.js"><link rel="prefetch" href="/assets/js/47.4a374966.js"><link rel="prefetch" href="/assets/js/48.733e5b6c.js"><link rel="prefetch" href="/assets/js/49.0fb92742.js"><link rel="prefetch" href="/assets/js/5.f52855e6.js"><link rel="prefetch" href="/assets/js/50.50fc5031.js"><link rel="prefetch" href="/assets/js/51.69d8d52a.js"><link rel="prefetch" href="/assets/js/52.d84cedc3.js"><link rel="prefetch" href="/assets/js/53.a64ddaf4.js"><link rel="prefetch" href="/assets/js/54.15e09103.js"><link rel="prefetch" href="/assets/js/55.0f7e8fd5.js"><link rel="prefetch" href="/assets/js/56.6cb5bf13.js"><link rel="prefetch" href="/assets/js/57.d90d9da6.js"><link rel="prefetch" href="/assets/js/58.2c03a905.js"><link rel="prefetch" href="/assets/js/59.02cf613a.js"><link rel="prefetch" href="/assets/js/6.0ff35647.js"><link rel="prefetch" href="/assets/js/60.bb6d2b2f.js"><link rel="prefetch" href="/assets/js/61.ef2abfd3.js"><link rel="prefetch" href="/assets/js/62.b09e5f81.js"><link rel="prefetch" href="/assets/js/63.6ca85ec7.js"><link rel="prefetch" href="/assets/js/64.77eab656.js"><link rel="prefetch" href="/assets/js/65.65b00883.js"><link rel="prefetch" href="/assets/js/66.040b5d23.js"><link rel="prefetch" href="/assets/js/67.23318ab1.js"><link rel="prefetch" href="/assets/js/68.5c29433f.js"><link rel="prefetch" href="/assets/js/69.90978695.js"><link rel="prefetch" href="/assets/js/7.463451e9.js"><link rel="prefetch" href="/assets/js/70.0c585fbd.js"><link rel="prefetch" href="/assets/js/71.120e4ae5.js"><link rel="prefetch" href="/assets/js/72.53bf1e3a.js"><link rel="prefetch" href="/assets/js/73.282f5b35.js"><link rel="prefetch" href="/assets/js/74.4f1cb67d.js"><link rel="prefetch" href="/assets/js/75.f5d3ea1e.js"><link rel="prefetch" href="/assets/js/76.fb173587.js"><link rel="prefetch" href="/assets/js/77.8064b022.js"><link rel="prefetch" href="/assets/js/78.d26f8075.js"><link rel="prefetch" href="/assets/js/79.6cff2fa5.js"><link rel="prefetch" href="/assets/js/8.d5f74857.js"><link rel="prefetch" href="/assets/js/80.29d746c7.js"><link rel="prefetch" href="/assets/js/81.c0a214a2.js"><link rel="prefetch" href="/assets/js/82.f0c93ca2.js"><link rel="prefetch" href="/assets/js/83.db6f55e1.js"><link rel="prefetch" href="/assets/js/84.b0a7a28c.js"><link rel="prefetch" href="/assets/js/85.db7376d4.js"><link rel="prefetch" href="/assets/js/86.96ec3402.js"><link rel="prefetch" href="/assets/js/87.ae41a109.js"><link rel="prefetch" href="/assets/js/88.d83c21c8.js"><link rel="prefetch" href="/assets/js/89.33868490.js"><link rel="prefetch" href="/assets/js/9.2680f96d.js"><link rel="prefetch" href="/assets/js/90.ed48459a.js"><link rel="prefetch" href="/assets/js/91.e1ee23ba.js"><link rel="prefetch" href="/assets/js/92.8b354527.js"><link rel="prefetch" href="/assets/js/93.0682d2e4.js"><link rel="prefetch" href="/assets/js/94.105580aa.js"><link rel="prefetch" href="/assets/js/95.d378d658.js"><link rel="prefetch" href="/assets/js/96.a6460598.js"><link rel="prefetch" href="/assets/js/97.a4cc955f.js"><link rel="prefetch" href="/assets/js/98.9a600d4f.js"><link rel="prefetch" href="/assets/js/99.45007523.js">
    <link rel="stylesheet" href="/assets/css/0.styles.53c04193.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Young's blog" class="logo"> <span class="site-name can-hide">Young's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Spring/" class="nav-link">Spring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章1</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/andanyang/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>Young</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Spring/" class="nav-link">Spring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章1</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/andanyang/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hadoop</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>kafka</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kafaka/introduction/" class="sidebar-link">kafka3.0入门</a></li><li><a href="/kafaka/producer/" class="sidebar-link">kafka3.0 生产者</a></li><li><a href="/kafka/broker/" aria-current="page" class="active sidebar-link">kafka3.0 broker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/kafka/broker/#_4-1-kafka-broker-工作流程" class="sidebar-link">4.1 Kafka Broker 工作流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-1-1-zookeeper-存储的-kafka-信息" class="sidebar-link">4.1.1 Zookeeper 存储的 Kafka 信息</a></li><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-1-2-kafka-broker-总体工作流程" class="sidebar-link">4.1.2 Kafka Broker 总体工作流程</a></li><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-1-3-broker-重要参数" class="sidebar-link">4.1.3 Broker 重要参数</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/kafka/broker/#_4-2-生产经验-节点服役和退役" class="sidebar-link">4.2 生产经验——节点服役和退役</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-2-1-服役新节点" class="sidebar-link">4.2.1 服役新节点</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_1-新节点准备" class="sidebar-link">1）新节点准备</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_2-执行负载均衡操作" class="sidebar-link">2）执行负载均衡操作</a></li><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-2-2-退役旧节点" class="sidebar-link">4.2.2 退役旧节点</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_1-执行负载均衡操作" class="sidebar-link">1）执行负载均衡操作</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/kafka/broker/#_4-3-kafka-副本" class="sidebar-link">4.3 Kafka 副本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-3-1-副本基本信息" class="sidebar-link">4.3.1 副本基本信息</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/kafka/broker/#_4-3-2-leader-选举流程" class="sidebar-link">4.3.2 Leader 选举流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-3-3-leader-和-follower-故障处理细节-水位" class="sidebar-link">4.3.3 Leader 和 Follower 故障处理细节 水位</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_1-follower-故障" class="sidebar-link">1）Follower 故障</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_2-leader-故障" class="sidebar-link">2）Leader 故障</a></li><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-3-4-分区副本分配" class="sidebar-link">4.3.4 分区副本分配</a></li><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-3-5-生产经验-手动调整分区副本存储" class="sidebar-link">4.3.5 生产经验——手动调整分区副本存储</a></li><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-3-6-生产经验-leader-partition-负载平衡" class="sidebar-link">4.3.6 生产经验——Leader Partition 负载平衡</a></li><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-3-7-生产经验-增加副本因子" class="sidebar-link">4.3.7 生产经验——增加副本因子</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_1-创建-topic" class="sidebar-link">1）创建 topic</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_2-手动增加副本存储" class="sidebar-link">2）手动增加副本存储</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/kafka/broker/#_4-4-文件存储" class="sidebar-link">4.4 文件存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-4-1-文件存储机制" class="sidebar-link">4.4.1 文件存储机制</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_1-topic-数据的存储机制" class="sidebar-link">1）Topic 数据的存储机制</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_2-思考-topic-数据到底存储在什么位置" class="sidebar-link">2）思考：Topic 数据到底存储在什么位置？</a></li><li class="sidebar-sub-header level4"><a href="/kafka/broker/#_3-index-文件和-log-文件详解" class="sidebar-link">3）index 文件和 log 文件详解</a></li><li class="sidebar-sub-header level3"><a href="/kafka/broker/#_4-4-2-文件清理策略" class="sidebar-link">4.4.2 文件清理策略</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/kafka/broker/#_4-5-高效读写数据" class="sidebar-link">4.5 高效读写数据</a></li></ul></li><li><a href="/kafka/consumer/" class="sidebar-link">Kafka 消费者</a></li><li><a href="/kafka/Kafka_Kraft/" class="sidebar-link">Kafka-Kraft 模式</a></li><li><a href="/kafka/Kafka_Workflow/" class="sidebar-link">Kafka 整体流程</a></li><li><a href="/kafka/Kafka_Idempotent_transactional/" class="sidebar-link">Kafka 幂等性和事务</a></li><li><a href="/kafka/Kafka_integration/" class="sidebar-link">Kafka 外部系统集成 Springboot</a></li><li><a href="/kafka/Kafka_Production_tuning/" class="sidebar-link">Kafka生产调优手册</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flume</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>hive</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>scala</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>spark</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E5%A4%A7%E6%95%B0%E6%8D%AE" title="分类" data-v-06225672>大数据</a></li><li data-v-06225672><a href="/categories/?category=kafka" title="分类" data-v-06225672>kafka</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/andanyoung" target="_blank" title="作者" class="beLink" data-v-06225672>andanyang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-09-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">kafka3.0 broker<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="第-4-章-kafka-broker"><a href="#第-4-章-kafka-broker" class="header-anchor">#</a> 第 4 章 Kafka Broker</h1> <h2 id="_4-1-kafka-broker-工作流程"><a href="#_4-1-kafka-broker-工作流程" class="header-anchor">#</a> 4.1 Kafka Broker 工作流程</h2> <h3 id="_4-1-1-zookeeper-存储的-kafka-信息"><a href="#_4-1-1-zookeeper-存储的-kafka-信息" class="header-anchor">#</a> 4.1.1 Zookeeper 存储的 Kafka 信息</h3> <p>（1）启动 Zookeeper 客户端。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 zookeeper-3.5.7]$ bin/zkCli.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）通过 ls 命令可以查看 kafka 相关信息。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[zk: localhost:2181(CONNECTED) 2] ls /kafka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20230921001018061.abb2e569.png" alt="Zookeeper中存储的Kafka 信息"></p> <h3 id="_4-1-2-kafka-broker-总体工作流程"><a href="#_4-1-2-kafka-broker-总体工作流程" class="header-anchor">#</a> 4.1.2 Kafka Broker 总体工作流程</h3> <p><img src="/assets/img/image-20230921001137942.752c52b3.png" alt="Kafka Broker总体工作流程"></p> <h3 id="_4-1-3-broker-重要参数"><a href="#_4-1-3-broker-重要参数" class="header-anchor">#</a> 4.1.3 Broker 重要参数</h3> <table><thead><tr><th>参数名称</th> <th>描述</th></tr></thead> <tbody><tr><td>replica.lag.time.max.ms</td> <td>ISR 中，如果 Follower 长时间未向 Leader 发送通信请求或同步数据，则该 Follower 将被踢出 ISR。 该时间阈值，<strong>默认 30s。</strong></td></tr> <tr><td>auto.leader.rebalance.enable</td> <td><strong>默认是 true</strong>。 自动 Leader Partition 平衡。</td></tr> <tr><td>leader.imbalance.per.broker.percentage</td> <td><strong>默认是 10%。</strong> 每个 broker 允许的不平衡的 leader 的比率。如果每个 broker 超过了这个值，控制器 会触发 leader 的平衡。</td></tr> <tr><td>leader.imbalance.check.interval.seconds</td> <td><strong>默认值 300 秒</strong>。检查 leader 负载是否平衡的间隔时间。</td></tr> <tr><td>log.segment.bytes</td> <td>Kafka 中 log 日志是分成一块块存储的，此配置是指 log 日志划分成块的大小，<strong>默认值 1G。</strong></td></tr> <tr><td>log.index.interval.bytes</td> <td><strong>默认 4kb</strong>，kafka 里面每当写入了 4kb 大小的日志 （.log），然后就往 index 文件里面记录一个索引。</td></tr> <tr><td>log.retention.hours</td> <td>Kafka 中数据保存的时间，<strong>默认 7 天。</strong></td></tr> <tr><td>log.retention.minutes</td> <td>Kafka 中数据保存的时间，<strong>分钟级别</strong>，默认关闭。</td></tr> <tr><td>log.retention.ms</td> <td>Kafka 中数据保存的时间，<strong>毫秒级别</strong>，默认关闭。</td></tr> <tr><td>log.retention.check.interval.ms</td> <td>检查数据是否保存超时的间隔，<strong>默认是 5 分钟</strong>。</td></tr> <tr><td>log.retention.bytes</td> <td><strong>默认等于-1，表示无穷大</strong>。超过设置的所有日志总 大小，删除最早的 segment。</td></tr> <tr><td>log.cleanup.policy</td> <td><strong>默认是 delete</strong>，表示所有数据启用删除策略； 如果设置值为 compact，表示所有数据启用压缩策略。</td></tr> <tr><td>num.io.threads</td> <td><strong>默认是 8</strong>。负责写磁盘的线程数。整个参数值要占总核数的 50%。</td></tr> <tr><td>num.replica.fetchers</td> <td>副本拉取线程数，这个参数占总核数的 50%的 1/3</td></tr> <tr><td>num.network.threads</td> <td><strong>默认是 3</strong>。数据传输线程数，这个参数占总核数的 50%的 2/3 。</td></tr> <tr><td>log.flush.interval.messages</td> <td>强制页缓存刷写到磁盘的条数，默认是 long 的最大值，9223372036854775807。一般不建议修改， 交给系统自己管理。</td></tr> <tr><td>log.flush.interval.ms</td> <td>每隔多久，刷数据到磁盘，默认是 null。一般不建 议修改，交给系统自己管理。</td></tr></tbody></table> <h2 id="_4-2-生产经验-节点服役和退役"><a href="#_4-2-生产经验-节点服役和退役" class="header-anchor">#</a> 4.2 生产经验——节点服役和退役</h2> <h3 id="_4-2-1-服役新节点"><a href="#_4-2-1-服役新节点" class="header-anchor">#</a> 4.2.1 服役新节点</h3> <h4 id="_1-新节点准备"><a href="#_1-新节点准备" class="header-anchor">#</a> 1）新节点准备</h4> <ul><li>（1）关闭 hadoop104，并右键执行克隆操作。</li> <li>（2）开启 hadoop105，并修改 IP 地址。</li> <li>（3）在 hadoop105 上，修改主机名称为 hadoop105。</li> <li>（4）重新启动 hadoop104、hadoop105。</li> <li>（5）修改 haodoop105 中 kafka 的 broker.id 为 3。</li> <li>（6）删除 hadoop105 中 kafka 下的 datas 和 logs。</li> <li>（7）启动 hadoop102、hadoop103、hadoop104 上的 kafka 集群。</li> <li>（8）单独启动 hadoop105 中的 kafka。</li> <li>2）执行负载均衡操作</li></ul> <h4 id="_2-执行负载均衡操作"><a href="#_2-执行负载均衡操作" class="header-anchor">#</a> 2）执行负载均衡操作</h4> <p>（1）创建一个要均衡的主题。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ vim topics-to-move.json
{
     &quot;topics&quot;: [
     	{&quot;topic&quot;: &quot;first&quot;}
     ],
     &quot;version&quot;: 1
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>（2）生成一个负载均衡的计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --topics-to-move-json-file topics-to-move.json --broker-list &quot;0,1,2,3&quot; --generate

Current partition replica assignment
{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,2,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[2,1,0],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,0,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]}]}

Proposed partition reassignment configuration
{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[2,3,0],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[3,0,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,1,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]}]}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>（3）创建副本存储计划（所有副本存储在 broker0、broker1、broker2、broker3 中）。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ vim increase-replication-factor.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输入如下内容</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[2,3,0],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[3,0,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;to
pic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,1,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]}]}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>（4）执行副本存储计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --reassignment-json-file increase-replication-factor.json --execute
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（5）验证副本存储计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --reassignment-json-file increase-replication-factor.json --verify

Status of partition reassignment:
Reassignment of partition first-0 is complete.
Reassignment of partition first-1 is complete.
Reassignment of partition first-2 is complete.

Clearing broker-level throttles on brokers 0,1,2,3
Clearing topic-level throttles on topic first
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-2-2-退役旧节点"><a href="#_4-2-2-退役旧节点" class="header-anchor">#</a> 4.2.2 退役旧节点</h3> <h4 id="_1-执行负载均衡操作"><a href="#_1-执行负载均衡操作" class="header-anchor">#</a> 1）执行负载均衡操作</h4> <p>先按照退役一台节点，<strong>生成执行计划</strong>，然后按照服役时操作流程<strong>执行负载均衡</strong>。</p> <p>（1）创建一个要均衡的主题。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ vim topics-to-move.json

{
     &quot;topics&quot;: [
     	{&quot;topic&quot;: &quot;first&quot;}
     ],
     &quot;version&quot;: 1
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>（2）创建执行计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --topics-to-move-json-file topics-to-move.json --broker-list &quot;0,1,2&quot; --generate

Current partition replica assignment
{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[2,0,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[3,1,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,2,3],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]}]}

Proposed partition reassignment configuration
{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[2,0,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;par
tition&quot;:1,&quot;replicas&quot;:[0,1,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,2,0],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]}]}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>（3）创建副本存储计划（所有副本存储在 broker0、broker1、broker2 中）。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ vim increase-replication-factor.json

{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[2,0,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,1,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]},{&quot;to
pic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,2,0],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]}]}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>（4）执行副本存储计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --reassignment-json-file increase-replication-factor.json --execute
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（5）验证副本存储计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --reassignment-json-file increase-replication-factor.json --verify

Status of partition reassignment:
Reassignment of partition first-0 is complete.
Reassignment of partition first-1 is complete.
Reassignment of partition first-2 is complete.

Clearing broker-level throttles on brokers 0,1,2,3
Clearing topic-level throttles on topic first
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>2）执行停止命令</p> <p>在 hadoop105 上执行停止命令即可。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop105 kafka]$ bin/kafka-server-stop.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>Kafka 执行负载均衡操作不会自动停止</p></blockquote> <h2 id="_4-3-kafka-副本"><a href="#_4-3-kafka-副本" class="header-anchor">#</a> 4.3 Kafka 副本</h2> <h3 id="_4-3-1-副本基本信息"><a href="#_4-3-1-副本基本信息" class="header-anchor">#</a> 4.3.1 副本基本信息</h3> <p>（1）Kafka 副本作用：提高数据可靠性。</p> <p>（2）Kafka 默认副本 1 个，生产环境一般配置为 2 个，保证数据可靠性；太多副本会增加磁盘存储空间，增加网络上数据传输，降低效率。</p> <p>（3）Kafka 中副本分为：Leader 和 Follower。Kafka 生产者只会把数据发往 Leader， 然后 Follower 找 Leader 进行同步数据。</p> <p>（4）Kafka 分区中的所有副本统称为 AR（Assigned Repllicas）。</p> <p>​ AR(<strong>Assigned Replicas</strong>) = ISR(<strong>In-Sync Replicas</strong>) + OS(<strong>Out-of-Sync Replicas</strong>)</p> <p>ISR，表示和 Leader 保持同步的 Follower 集合。如果 Follower 长时间未向 Leader 发送通信请求或同步数据，则该 Follower 将被踢出 ISR。该时间阈值由 <code>replica.lag.time.max.ms</code> 参数设定，默认 30s。Leader 发生故障之后，就会从 ISR 中选举新的 Leader。</p> <p>OSR，表示 Follower 与 Leader 副本同步时，延迟过多的副本。</p> <h2 id="_4-3-2-leader-选举流程"><a href="#_4-3-2-leader-选举流程" class="header-anchor">#</a> 4.3.2 Leader 选举流程</h2> <p>Kafka 集群中有一个 broker 的 Controller 会被选举为 Controller Leader，负责<strong>管理集群 broker 的上下线</strong>，所有 topic 的分区副本分配和 <strong>Leader 选举</strong>等工作。</p> <p>Controller 的信息同步工作是依赖于 Zookeeper 的。</p> <p><img src="/assets/img/image-20230921235351108.6f9c420d.png" alt="Leader选举流程"></p> <h3 id="_4-3-3-leader-和-follower-故障处理细节-水位"><a href="#_4-3-3-leader-和-follower-故障处理细节-水位" class="header-anchor">#</a> 4.3.3 Leader 和 Follower 故障处理细节 水位</h3> <h4 id="_1-follower-故障"><a href="#_1-follower-故障" class="header-anchor">#</a> 1）Follower 故障</h4> <p><img src="/assets/img/image-20230921235534418.83e739c4.png" alt="Follower故障处理细节"></p> <h4 id="_2-leader-故障"><a href="#_2-leader-故障" class="header-anchor">#</a> 2）Leader 故障</h4> <p><img src="/assets/img/image-20230921235746080.ecd8fc89.png" alt="Leader故障处理细节"></p> <h3 id="_4-3-4-分区副本分配"><a href="#_4-3-4-分区副本分配" class="header-anchor">#</a> 4.3.4 分区副本分配</h3> <p>如果 kafka 服务器只有 4 个节点，那么设置 kafka 的分区数大于服务器台数，在 kafka 底层如何分配存储副本呢？</p> <h3 id="_4-3-5-生产经验-手动调整分区副本存储"><a href="#_4-3-5-生产经验-手动调整分区副本存储" class="header-anchor">#</a> 4.3.5 生产经验——手动调整分区副本存储</h3> <p>在生产环境中，每台服务器的配置和性能不一致，但是 Kafka 只会根据自己的代码规则创建对应的分区副本，就会导致个别服务器存储压力较大。所有需要手动调整分区副本的存储。</p> <p><strong>需求</strong>：创建一个新的 topic，4 个分区，两个副本，名称为 three。将该 topic 的所有副本都存储到 broker0 和 broker1 两台服务器上。</p> <p>手动调整分区副本存储的步骤如下：</p> <ul><li><p>（1）创建一个新的 topic，名称为 three。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>andanyoung@hadoop102 kafka]$ bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --create --partitions 4 --replication-factor 2 --topic three
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>（2）查看分区副本存储情况。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --describe --topic three
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>（3）创建副本存储计划（所有副本都指定存储在 broker0、broker1 中）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ vim increase-replication-factor.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输入如下内容：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    &quot;version&quot;:1,
    &quot;partitions&quot;:[{&quot;topic&quot;:&quot;three&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1]},
                {&quot;topic&quot;:&quot;three&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,1]},
                {&quot;topic&quot;:&quot;three&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,0]},
                {&quot;topic&quot;:&quot;three&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[1,0]}]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>（4）执行副本存储计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --reassignment-json-file increase-replication-factor.json --execute
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>（5）验证副本存储计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --reassignment-json-file increase-replication-factor.json --verify
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>（6）查看分区副本存储情况</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --describe --topic three
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="_4-3-6-生产经验-leader-partition-负载平衡"><a href="#_4-3-6-生产经验-leader-partition-负载平衡" class="header-anchor">#</a> 4.3.6 生产经验——Leader Partition 负载平衡</h3> <p>正常情况下，Kafka 本身会自动把 Leader Partition 均匀分散在各个机器上，来保证每台机器的读写吞吐量都是均匀的。但是如果某些 broker 宕机，会导致 Leader Partition 过于集中在其他少部分几台 broker 上，这会导致少数几台 broker 的读写请求压力过高，其他宕机的 broker 重启之后都是 follower partition，读写请求很低，造成集群负载不均衡。</p> <p><img src="data:image/png;base64,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" alt="Leader Partition 负载平衡"></p> <ul><li><code>auto.leader.rebalance.enable</code>，默认是 true。 自动 Leader Partition 平衡</li> <li><code>leader.imbalance.per.broker.percentage</code>， <strong>默认是 10%</strong>。每个 broker 允许的不平衡的 leader 的比率。如果每个 broker 超过了这个值，控制器会触发 leader 的平衡。</li> <li><code>leader.imbalance.check.interval.seconds</code>， <strong>默认值 300 秒</strong>。检查 leader 负载是否平衡 的间隔时间。</li></ul> <h3 id="_4-3-7-生产经验-增加副本因子"><a href="#_4-3-7-生产经验-增加副本因子" class="header-anchor">#</a> 4.3.7 生产经验——增加副本因子</h3> <p>在生产环境当中，由于某个主题的重要等级需要提升，我们考虑增加副本。副本数的增加需要先制定计划，然后根据计划执行。</p> <h4 id="_1-创建-topic"><a href="#_1-创建-topic" class="header-anchor">#</a> 1）创建 topic</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-topics.sh --bootstrap-server hadoop102:9092 --create --partitions 3 --replication-factor 1 --topic four
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-手动增加副本存储"><a href="#_2-手动增加副本存储" class="header-anchor">#</a> 2）手动增加副本存储</h4> <p>（1）创建副本存储计划（所有副本都指定存储在 broker0、broker1、broker2 中）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ vim increase-replication-factor.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输入如下内容：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;four&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]},{&quot;topic&quot;:&quot;four&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,1,2]},{&quot;topic&quot;:&quot;four&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,1,2]}]}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）执行副本存储计划。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-reassign-partitions.sh --bootstrap-server hadoop102:9092 --reassignment-json-file increase-replication-factor.json --execute
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_4-4-文件存储"><a href="#_4-4-文件存储" class="header-anchor">#</a> 4.4 文件存储</h2> <h3 id="_4-4-1-文件存储机制"><a href="#_4-4-1-文件存储机制" class="header-anchor">#</a> 4.4.1 文件存储机制</h3> <h4 id="_1-topic-数据的存储机制"><a href="#_1-topic-数据的存储机制" class="header-anchor">#</a> 1）Topic 数据的存储机制</h4> <p>Topic 是逻辑上的概念，而 partition 是物理上的概念，<strong>每个 partition 对应于一个 log 文件</strong>，该 log 文件中存储的就是 Producer 生产的数据。<strong>Producer 生产的数据会被不断追加到该 log 文件末端</strong>，为防止 log 文件过大导致数据定位效率低下，Kafka 采取了分片和索引机制， 将<strong>每个 partition 分为多个 segment。每个 segment 包括</strong>：“.index”文件、“.log”文件和.timeindex 等文件。这些文件位于一个文件夹下，该文件夹的命名规则为：topic 名称+分区序号，例如：first-0。</p> <p><img src="/assets/img/image-20230922001024210.60fd33ca.png" alt="Kafka文件存储机制"></p> <h4 id="_2-思考-topic-数据到底存储在什么位置"><a href="#_2-思考-topic-数据到底存储在什么位置" class="header-anchor">#</a> 2）思考：Topic 数据到底存储在什么位置？</h4> <p>（1）启动生产者，并发送消息。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop102 kafka]$ bin/kafka-console-producer.sh --
bootstrap-server hadoop102:9092 --topic first
&gt;hello world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（2）查看 hadoop102（或者 hadoop103、hadoop104）的/opt/module/kafka/datas/first-1 （first-0、first-2）路径上的文件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop104 first-1]$ ls
00000000000000000092.index
00000000000000000092.log
00000000000000000092.snapshot
00000000000000000092.timeindex
leader-epoch-checkpoint
partition.metadata
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>（3）直接查看 log 日志，发现是乱码。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop104 first-1]$ cat 00000000000000000092.log
\CYnF|©|©ÿ&quot;hello world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>（4）通过工具查看 index 和 log 信息。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[andanyoung@hadoop104 first-1]$ kafka-run-class.sh kafka.tools.DumpLogSegments
--files ./00000000000000000000.index

Dumping ./00000000000000000000.index
offset: 3 position: 152

[andanyoung@hadoop104 first-1]$ kafka-run-class.sh kafka.tools.DumpLogSegments
--files ./00000000000000000000.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_3-index-文件和-log-文件详解"><a href="#_3-index-文件和-log-文件详解" class="header-anchor">#</a> 3）index 文件和 log 文件详解</h4> <p><img src="/assets/img/image-20230925225130554.08a34d6c.png" alt="Log文件和Index文件详解"></p> <p>说明：日志存储参数配置</p> <table><thead><tr><th>参数</th> <th>描述</th></tr></thead> <tbody><tr><td>log.segment.bytes</td> <td>Kafka 中 log 日志是分成一块块存储的，此配置是指 log 日志划分 成块的大小，<strong>默认值 1G。</strong></td></tr> <tr><td>log.index.interval.bytes</td> <td><strong>默认 4kb</strong>，kafka 里面每当写入了 4kb 大小的日志（.log），然后就往 index 文件里面记录一个索引。 稀疏索引。</td></tr></tbody></table> <h3 id="_4-4-2-文件清理策略"><a href="#_4-4-2-文件清理策略" class="header-anchor">#</a> 4.4.2 文件清理策略</h3> <p>Kafka <strong>中默认的日志保存时间为 7 天</strong>，可以通过调整如下参数修改保存时间。</p> <ul><li>log.retention.hours，最低优先级小时，默认 7 天。</li> <li>log.retention.minutes，分钟。</li> <li>log.retention.ms，最高优先级毫秒。</li> <li>log.retention.check.interval.ms，负责设置检查周期，默认 5 分钟。</li></ul> <p>那么日志一旦超过了设置的时间，怎么处理呢？</p> <p>Kafka 中提供的日志清理策略有 delete 和 compact 两种。</p> <p>1）delete 日志删除：将过期数据删除</p> <ul><li><p>log.cleanup.policy = delete 所有数据启用删除策略</p> <p>（1）基于时间：默认打开。以 segment 中所有记录中的最大时间戳作为该文件时间戳。</p> <p>（2）基于大小：默认关闭。超过设置的所有日志总大小，删除最早的 segment。</p> <blockquote><p>log.retention.bytes，默认等于-1，表示无穷大。</p></blockquote> <p><strong>思考</strong>：如果一个 segment 中有一部分数据过期，一部分没有过期，怎么处理？</p> <p>“以 segment 中所有记录中的最大时间戳作为该文件时间戳”，所以不会删除的，会等没有过期的部分数据也过期，以最后一条记录的时间戳为准。</p></li></ul> <p>2）compact 日志压缩</p> <p>Kafka 中的 LogCompaction 是指在默认的日志删除（LogRetention）规则之外提供的一种清理过时数据的方式。如图所示，LogCompaction 对于有相同 key 的不同 value 值，只保留最后一个版本。如果应用只关心 key 对应的最新 value 值，则可以开启 Kafka 的日志清理功能，Kafka 会定期将相同 key 的消息进行合井，只保留最新的 value 值</p> <ul><li><p>log.cleanup.policy = compact 所有数据启用压缩策略</p> <p><img src="/assets/img/image-20230925230200533.11d05fee.png" alt="compact日志压缩"></p></li></ul> <p>压缩后的 offset 可能是不连续的，比如上图中没有 6，当从这些 offset 消费消息时，将会拿到比这个 offset 大 的 offset 对应的消息，实际上会拿到 offset 为 7 的消息，并从这个位置开始消费。</p> <p>这种策略只适合特殊场景，比如消息的 key 是用户 ID，value 是用户的资料，通过这种压缩策略，整个消息 集里就保存了所有用户最新的资料。</p> <h2 id="_4-5-高效读写数据"><a href="#_4-5-高效读写数据" class="header-anchor">#</a> 4.5 高效读写数据</h2> <ul><li><p>1）Kafka 本身是分布式集群，可以采用分区技术，并行度高</p></li> <li><p>2）读数据采用稀疏索引，可以快速定位要消费的数据</p></li> <li><p>3）顺序写磁盘</p> <p>Kafka 的 producer 生产数据，要写入到 log 文件中，写的过程是一直追加到文件末端，为顺序写。官网有数据表明，同样的磁盘，顺序写能到 600M/s，而随机写只有 100K/s。这与磁盘的机械机构有关，顺序写之所以快，是因为其省去了大量磁头寻址的时间。</p></li> <li><p>4）页缓存 + 零拷贝技术</p> <p><strong>零拷贝</strong>：Kafka 的数据加工处理操作交由 Kafka 生产者和 Kafka 消费者处理。Kafka Broker 应用层不关心存储的数据，所以就不用走应用层，传输效率高。</p> <p><strong>PageCache 页缓存</strong>：Kafka 重度依赖底层操作系统提供的 PageCache 功 能。当上层有写操作时，操作系统只是将数据写入 PageCache。当读操作发生时，先从 PageCache 中查找，如果找不到，再去磁盘中读取。实际上 PageCache 是把尽可能多的空闲内存 都当做了磁盘缓存来使用。</p> <p><img src="/assets/img/1104875-20230212140822482-728868650.bb621b17.png" alt="零拷贝"></p> <table><thead><tr><th>参数</th> <th>描述</th></tr></thead> <tbody><tr><td>log.flush.interval.messages</td> <td>强制页缓存刷写到磁盘的条数，默认是 long 的最大值， 9223372036854775807。一般不建议修改，交给系统自己管理。</td></tr> <tr><td>log.flush.interval.ms</td> <td>每隔多久，刷数据到磁盘，默认是 null。一般不建议修改， 交给系统自己管理。</td></tr></tbody></table></li></ul> <h1 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h1> <blockquote><p>https://www.cnblogs.com/liujiaqi1101/p/17113748.html#51-%E5%AD%98%E5%82%A8%E6%9C%BA%E5%88%B6</p></blockquote></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/andanyang/vuepress-theme-vdoing/edit/master/docs/大数据/002.kafka/0003.kafka_broker.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/03/11, 02:40:47</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/kafaka/producer/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">kafka3.0 生产者</div></a> <a href="/kafka/consumer/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Kafka 消费者</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kafaka/producer/" class="prev">kafka3.0 生产者</a></span> <span class="next"><a href="/kafka/consumer/">Kafka 消费者</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/bigdata/spark/SparkStreaming_Driver_Executer/"><div>
            spark中代码的执行位置（Driver or Executer）
            <!----></div></a> <span class="date">12-12</span></dt></dl><dl><dd>02</dd> <dt><a href="/bigdata/spark/SparkStreaming/"><div>
            大数据技术之 SparkStreaming
            <!----></div></a> <span class="date">12-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/bigdata/spark/sql/"><div>
            Spark 核心编程之 RDD 累加器与广播变量
            <!----></div></a> <span class="date">12-06</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1218853253@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/andanyang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Young | <a href="https://github.com/andanyoung/young-blog/blob/master/LICENSE" target="_blank">MIT License</a> <br/> <a  href="https://beian.miit.gov.cn/" target="_blank">浙ICP备20002744号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.e4caa6db.js" defer></script><script src="/assets/js/2.d1be14c5.js" defer></script><script src="/assets/js/45.7995c3a0.js" defer></script>
  </body>
</html>
