(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{1135:function(a,s){a.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgwAAADECAYAAADzonn/AAAM+klEQVR4nO3dza8d510H8Ofcex3HiROaKJEDKSpSLSBOZFixQoq6YOFFK0Vi00retuu2/wbQBYtuKiQwMns2ZoNUVDVISAipoaZIwUCruC01pEluiN/uGRbtCdPpzPzm9Txnzvl8pCP7nnn7zcuZ+c7zzD13VRRFkQAAWhzlLgAA2H0CAwAQEhgAgJDAAACEBAbgIKxWq9wl0MES99MSax7iJHcBwDKsVqvU9EtVbcOicftMO1TdMptsxitP0+X/bcvsckGZchtEdfVd3jb2Ud1yuuynrvPsut59t8/Qmpd4fPUODH1OGn02XKS8w6P59bGtDwJMZReP2c3ns29dudZljovBmGVu6w41uhiNCX5zmHL+m2O0qe7qPqjbJ13qGRPEdv34mr1LoiiK2ld5BarDmt5rm98QUx3wL732uVHDoY8oPG/D5sRbftW9Xx6/z7yq04+tdcjnvGma6l1dW+1TrkcXbcuuboddOI7Khu6ntuOnbVtUp4+uLU0hY+g1ZInHV7YuiaF3JFOpLrvtov6jf/7rbZTUqlrfLtTU5KXXPvdL9dW9N9Wyqraxbba5jrnVnWinuEttavqd8rwwtPujbp3L/5ZvbLosa1sn9rrzahTcdqHFauh+SqlbF0Nbi0LTsRx1TYypeanHl2cYfq58ot+1E/8+XJzmrHVXtsM269hm4G4LB9U6duHiUzb2IlRtCS3Pa0wtVVOf7Dfr2icg5dxvQ/dTeZq2eVbHrWuZrmv5bjOm5qUeXwcZGIZ+OMp3s3UXh2h43Xhdxq0bHi2/Os5mPm01Nk1fnbb8ft245X+r8xhTT904baKg1beGIevYVPvQZe+Ktv7eLifd8gVtG6qhpqu6O7gxfdRNw6ZuUam7ey6L7lyb5j23vvupqcug7zr0CQp10/atuW7/LOH4SkVPbZNUh0Wzbxre9n7dq69omkuvfjZ8r/zzpVc/Gw7vM++uw6LxhtZYfS+ats+8htbTtB36brsx26TPOs6xP6qGHPtjNH3mutRRHqf6/6Zh1WX2ffWpsc95rW5YU91912OspnnWbeOm2pvm2/Ze7v3UNp/o2IuuN5Exx1Y0fNeOr8W1MBSZms2iO7xt3QGOuescU2N12inWd6ptNub5jrnGzTG/ubTdfY296yyCVoYpPu9DamxrQYlqamo9qdt2U5/PNvNrerYkMrSmXPupy/RNx1hTzW37vjrd0JqXenwtLjDkNNVvO7TNJwoEdd0BXeY7tq4pxp/LUi68fdR1AeVSvgiV/y1rO1l3GW+u5u6hXR+babrUH52428Yd0xTeV3U/7pIpuqi6XMi77Ju2IFFdxtCal3p8CQwdRf3TfbRdAKZsBZhz+im3R1Mtu9yHvw1Nz0bkVr3w1J1E67TdGQ3pv+1T61DRA51NJ/7qPKKa5riIR3fKu2TsfqrbL23j1B2LTfu56dicqlVlScdX7+9haEpUfZs/cj+VO8Ycd/dNqhfOXTRHfZuL5OY11TxzTr8r5ngif/Nv22e6axPwriiK///OmKZ163qXOeRcN7QrpXyB27zKP4+paddt1r+8HdpaxqrbaPNeeR7V4VPJeXyVt08fg1oYuvSflAtrmkcuXVJbVbWJuK7fvMsdcVMAiFodon76IfMdM33b9piiOb3LOvedR9/w1bZPo3UcW390LE3VdzpG+c4oCg3R+aGt1SKncj1N/y+P26Xurs8SDDFFt8O2u43G6vKMTXRh7jKvOeQ4vqJWjdZpi135ZG7Zkls4DsE+fPfEnIYev0Omq55Euzxs1TSsy/DyOFN9Rrv0F3dphu46rG2+bXeS0XhdRf3tTc3xY5Yxhb77aei8mu7ap9oOXT8jOY6vMYHhYJ9hGNLKALtg23d6fftuxw7vOk4ffVo95hrWNnzu9S13S0y1zLma6adaTjSvqeofUnPO46upBaOLg21h2BAadteSvg57mxyzQA4HHxgAgNjsf60SAFg+gQEACAkMAEBIYAAAQgIDABASGACAkMAAAIQEBgAgJDAAACGBAQAICQwAQEhgAABCAgMAEBIYAICQwAAAhAQGACAkMAAAIYEBAAgJDABASGAAAEICAwAQEhgAgJDAAACEBAYAICQwAAAhgQEACAkMAEBIYAAAQgIDABASGACAkMAAAIQEBgAgJDAAACGBAQAICQwAQEhgAABCAgMAEBIYAICQwAAAhAQGACAkMAAAIYEBAAgJDABASGAAAEICAwAQEhgAgJDAAACEBAYAICQwAAChk9wFANw7vZvu/Pd3c5ex937n5d9P508u5C6DhRIYgOwenN1P//O/P85dxt5bF+vcJbBguiQAgJDAAACEBAYAICQwAAAhgQEACAkMAEBIYAAAQgIDABASGACAkMAAAIQEBgAgJDAAACF/fAqgh2tXrv/Cz7du38hUCWyXFgaAjjZh4dbtGx8HhWqAgH0lMAAAIV0SAB2Vux+0LHBotDAA9HDtyvV07cp1zy5wcAQGgI7KzzDAoREYAIDQqiiKIncRwGF757076a27b+Yuo5OmZxeW0Orw+uU30oVzT+cug4Xy0CNAD0sIBjAHXRIAQEhgAABCAgMAEBIYAICQhx4n9va97+QuYe89/9Sl9PxTl3KXAXBQBIaJvf0TgWFul1+8KjAAbJkuCQAgJDAAACFdEkB2z55/Ll1+8WruMvbeuaNzuUtgwQQGILtnnnwuPfPkc7nLAFrokgAAQgID7LDi8cP00d9+PXcZALokYJcVp/fS/W/9WTr7r39LFz//R7nLmc2Dxx+lDx++n7uMvfeJCy+ko9Vx7jJYKIEBdt25C2n9g++m07/6arr4+T/OXc0s7n34w8X8eesl8+etGUOXBOy8Ih2dnaX1999Kpze/mrsY4EBpYViYa1eu/8LPt27fGDWPIdNH85xyvrvs8Q//NT363jdnXUZx/zSlIqVV8Sgdn6W0/v4/pdObX0kXv/Ansy4XoEpgWKgxF+Rbt2/80gV+rE09U893lz363jfTg7/7RjpazdtQd5KOUiqKlFJKR2cprf/jH4UGYOt0ScAIR6lIJzO/jtNZWq0ffvw6fvRRKv79H9Lpza/kXn3ggGhh2BNjugQ203adZo4ujcUq1ikVZ1tf7PHDR+nszt+n05tfThe/8LWtLx84PFoY9kD5gt+3a+Daleu9ptmMf4hdEHVWxVlarR9leZ08+CClt7+dTm9+OfdmAA6AwHDgNhf+LgGgrhXj0FsYimKdivXjbK/04DSt7/1nKu5/kHtTAHtOl8QeKF+0D/2Of9uKokjr9TrLstfpKKVf/a30zBf/PK2efCZLDcDhEBj2RLlbQmjYnlyBoVgdpfRrr6Rnv/gXwgKwFQLDHuj70CLTKdIqnc3cs7cq1j97uHKzzNVxOnr5VWEB2CqB4UBEoaJuePW9TetF9UHJQw0qxy/9Zjp++bVZl1GcPUrFez9K63ff+dnPR8fp5JOvCQsZ+O0gDp3AsAfKF/Ky6GJe7b7ochKsLuuQT5xPvPKZ9MQrn5l1Geuf3k0//dM/TOtindLRSTr3yavCQia6+zh0AsOeiC7cTeGgT6Douiymt05H6fyvX03PfklYAPLwa5Ww684ep/Of+t307JduCAs7pK5VD/aZwLBQfU9WQ5416DONk+dMTs6n40ufFhZ2TN8vPIN9sCqKn/9VGybxN//yl7lL2HuXX7yaLr9wNXcZTOid9+6kt+6+mbuMUJeHg3fZ65ffSBfOPZ27DBZKCwMAEBIYAICQwAAAhAQGgIGW9PwCjOV7GAB6GPKFZ7APBIaJPf/Updwl7L0L5y7mLoED1eULz2BfCQwT+71P/UHuEgBgcp5hAABCAgMAEBIYAICQwAAAhAQGACAkMAAAIYEBAAj589ZAdg8ef5Q+fPh+7jL23icuvJCOVse5y2ChBAYAIKRLAgAICQwAQMjfkgCy++D+u+nHpz/IXcbe+43nfjudHD+RuwwWSmAAsnv/wbvp7Z98J3cZe+/lX/m0wMBguiQAgJDAAACEBAYAICQwAAAhgQEACAkMAEBIYAAAQgIDABASGACAkMAAAIQEBgAgJDAAACF/fApggGtXrn/8/1u3b2SsBLZDCwNAT9euXE+3bt/4OCiUwwPsKy0MAD1Uw4HWBQ6FFgYAICQwAAAhgQEACAkMAD3UPejooUcOwaooiiJ3EcBhe+e9O+mtu2/mLqOXJf5a5euX30gXzj2duwwWym9JAAywlJAAU9ElAQCEBAYAICQwAAAhgQEACAkMAEBIYAAAQgIDABASGACAkC9uArI7f/xkev6pS7nL2HtHK/eIDOeroQGAkLgJAIQEBgAgJDAAACGBAQAICQwAQEhgAABCAgMAEBIYAICQwAAAhAQGACAkMAAAIYEBAAgJDABASGAAAEICAwAQEhgAgJDAAACEBAYAICQwAAAhgQEACAkMAEDo/wB7D1U3tcRGSQAAAABJRU5ErkJggg=="},1136:function(a,s,t){a.exports=t.p+"assets/img/image-20231016230839588.494454e0.png"},1137:function(a,s,t){a.exports=t.p+"assets/img/image-20231016231001486.75c4c94d.png"},1138:function(a,s,t){a.exports=t.p+"assets/img/image-20231016231244318.76cc9efa.png"},1139:function(a,s,t){a.exports=t.p+"assets/img/image-20231016231501126.83cd58d6.png"},1520:function(a,s,t){"use strict";t.r(s);var e=t(4),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"第3章-ddl-data-definition-language-数据定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第3章-ddl-data-definition-language-数据定义"}},[a._v("#")]),a._v(" 第3章 DDL（Data Definition Language）数据定义")]),a._v(" "),s("h2",{attrs:{id:"_3-1-数据库-database"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-数据库-database"}},[a._v("#")]),a._v(" 3.1 数据库（database）")]),a._v(" "),s("h3",{attrs:{id:"_3-1-1-创建数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-创建数据库"}},[a._v("#")]),a._v(" 3.1.1 创建数据库")]),a._v(" "),s("h4",{attrs:{id:"_1-语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("CREATE DATABASE [IF NOT EXISTS] database_name\n[COMMENT database_comment]\n[LOCATION hdfs_path]\n[WITH DBPROPERTIES (property_name=property_value, ...)];\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("2）案例")]),a._v(" "),s("p",[a._v("（1）创建一个数据库，不指定路径")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> create database db_hive1;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("blockquote",[s("p",[a._v("注：若不指定路径，其默认路径为${hive.metastore.warehouse.dir}/database_name.db")])]),a._v(" "),s("p",[a._v("（2）创建一个数据库，指定路径")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> create database db_hive2 location '/db_hive2';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（3）创建一个数据库，带有dbproperties")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> create database db_hive3 with dbproperties('create_date'='2022-11-18');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_3-1-2-查询数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-查询数据库"}},[a._v("#")]),a._v(" 3.1.2 查询数据库")]),a._v(" "),s("h4",{attrs:{id:"_1-展示所有数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-展示所有数据库"}},[a._v("#")]),a._v(" 1）展示所有数据库")]),a._v(" "),s("p",[a._v("（1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("SHOW DATABASES [LIKE 'identifier_with_wildcards'];\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("注：like通配表达式说明：*表示任意个任意字符，|表示或的关系。")]),a._v(" "),s("p",[a._v("（2）案例")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> show databases like 'db_hive*';\nOK\ndb_hive_1\ndb_hive_2\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h4",{attrs:{id:"_2-查看数据库信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看数据库信息"}},[a._v("#")]),a._v(" 2）查看数据库信息")]),a._v(" "),s("p",[a._v("（1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("DESCRIBE DATABASE [EXTENDED] db_name;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（2）案例")]),a._v(" "),s("p",[a._v("1"),s("strong",[a._v("查看基本信息")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> desc database db_hive3;\nOK\ndb_hive\t\thdfs://hadoop102:8020/user/hive/warehouse/db_hive.db\tatguigu\tUSER\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("查看更多信息")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> desc database extended db_hive3;\nOK\ndb_name\tcomment\tlocation\towner_name\towner_type\tparameters\ndb_hive3\t\thdfs://hadoop102:8020/user/hive/warehouse/db_hive3.db\tatguigu\tUSER\t{create_date=2022-11-18}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"_3-1-3-修改数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-修改数据库"}},[a._v("#")]),a._v(" 3.1.3 修改数据库")]),a._v(" "),s("p",[a._v("用户可以使用alter database命令修改数据库某些信息，其中能够修改的信息包括dbproperties、location、owner user。需要注意的是：修改数据库location，不会改变当前已有表的路径信息，而只是改变后续创建的新表的默认的父目录。")]),a._v(" "),s("h4",{attrs:{id:"_1-语法-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法-2"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("--修改dbproperties\nALTER DATABASE database_name SET DBPROPERTIES (property_name=property_value, ...);\n\n--修改location\nALTER DATABASE database_name SET LOCATION hdfs_path;\n\n--修改owner user\nALTER DATABASE database_name SET OWNER USER user_name;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("2）案例")]),a._v(" "),s("p",[a._v("（1）修改dbproperties")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> ALTER DATABASE db_hive3 SET DBPROPERTIES ('create_date'='2022-11-20');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_3-1-4-删除数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-删除数据库"}},[a._v("#")]),a._v(" 3.1.4 删除数据库")]),a._v(" "),s("h4",{attrs:{id:"_1-语法-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法-3"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("DROP DATABASE [IF EXISTS] database_name [RESTRICT|CASCADE];\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("注：RESTRICT：严格模式，若数据库不为空，则会删除失败，默认为该模式。")]),a._v(" "),s("p",[a._v("CASCADE：级联模式，若数据库不为空，则会将库中的表一并删除。")]),a._v(" "),s("h4",{attrs:{id:"_2-案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例"}},[a._v("#")]),a._v(" 2）案例")]),a._v(" "),s("p",[a._v("（1）删除空数据库")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> drop database db_hive2;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（2）删除非空数据库")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> drop database db_hive3 cascade;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_3-1-5-切换当前数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-切换当前数据库"}},[a._v("#")]),a._v(" 3.1.5 切换当前数据库")]),a._v(" "),s("p",[a._v("1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("USE database_name;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_3-2-表-table"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-表-table"}},[a._v("#")]),a._v(" 3.2 表（table）")]),a._v(" "),s("h3",{attrs:{id:"_3-2-1-创建表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-创建表"}},[a._v("#")]),a._v(" 3.2.1 创建表")]),a._v(" "),s("h4",{attrs:{id:"_3-2-1-1-语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-1-语法"}},[a._v("#")]),a._v(" 3.2.1.1 语法")]),a._v(" "),s("h5",{attrs:{id:"_1-普通建表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-普通建表"}},[a._v("#")]),a._v(" 1）普通建表")]),a._v(" "),s("p",[a._v("（1）完整语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name   \n[(col_name data_type [COMMENT col_comment], ...)]\n[COMMENT table_comment]\n[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]\n[CLUSTERED BY (col_name, col_name, ...) \n[SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS]\n[ROW FORMAT row_format] \n[STORED AS file_format]\n[LOCATION hdfs_path]\n[TBLPROPERTIES (property_name=property_value, ...)]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("（2）关键字说明：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("TEMPORARY")]),a._v(" "),s("p",[a._v("临时表，该表只在当前会话可见，会话结束，表会被删除。")])]),a._v(" "),s("li",[s("p",[a._v("EXTERNAL（重点）")]),a._v(" "),s("p",[a._v("外部表，与之相对应的是内部表（管理表）。管理表意味着Hive会完全接管该表，包括元数据和HDFS中的数据。而外部表则意味着Hive只接管元数据，而不完全接管HDFS中的数据。")])]),a._v(" "),s("li",[s("p",[a._v("data_type（重点）")]),a._v(" "),s("p",[a._v("Hive中的字段类型可分为基本数据类型和复杂数据类型。")]),a._v(" "),s("p",[a._v("基本数据类型如下：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[a._v("Hive")])]),a._v(" "),s("th",[s("strong",[a._v("说明")])]),a._v(" "),s("th",[a._v("定义")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("tinyint")]),a._v(" "),s("td",[a._v("1byte有符号整数")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("smallint")]),a._v(" "),s("td",[a._v("2byte有符号整数")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("int")]),a._v(" "),s("td",[a._v("4byte有符号整数")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("bigint")]),a._v(" "),s("td",[a._v("8byte有符号整数")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("boolean")]),a._v(" "),s("td",[a._v("布尔类型，true或者false")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("float")]),a._v(" "),s("td",[a._v("单精度浮点数")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("double")]),a._v(" "),s("td",[a._v("双精度浮点数")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("decimal")]),a._v(" "),s("td",[a._v("十进制精准数字类型")]),a._v(" "),s("td",[a._v("decimal(16,2)")])]),a._v(" "),s("tr",[s("td",[a._v("varchar")]),a._v(" "),s("td",[a._v("字符序列，需指定最大长度，最大长度的范围是[1,65535]")]),a._v(" "),s("td",[a._v("varchar(32)")])]),a._v(" "),s("tr",[s("td",[a._v("string")]),a._v(" "),s("td",[a._v("字符串，无需指定最大长度")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("timestamp")]),a._v(" "),s("td",[a._v("时间类型")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("binary")]),a._v(" "),s("td",[a._v("二进制数据")]),a._v(" "),s("td")])])]),a._v(" "),s("p",[a._v("复杂数据类型如下；")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("类型")]),a._v(" "),s("th",[a._v("说明")]),a._v(" "),s("th",[a._v("定义")]),a._v(" "),s("th",[a._v("取值")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("array")]),a._v(" "),s("td",[a._v("数组是一组相同类型的值的集合")]),a._v(" "),s("td",[a._v("array"),s("string")],1),a._v(" "),s("td",[a._v("arr[0]")])]),a._v(" "),s("tr",[s("td",[a._v("map")]),a._v(" "),s("td",[a._v("map是一组相同类型的键-值对集合")]),a._v(" "),s("td",[a._v("map<string, int>")]),a._v(" "),s("td",[a._v("map['key']")])]),a._v(" "),s("tr",[s("td",[a._v("struct")]),a._v(" "),s("td",[a._v("结构体由多个属性组成，每个属性都有自己的属性名和数据类型")]),a._v(" "),s("td",[a._v("struct<id:int, name:string>")]),a._v(" "),s("td",[a._v("struct.id")])])])]),a._v(" "),s("p",[a._v("注：类型转换")]),a._v(" "),s("p",[a._v("Hive的基本数据类型可以做类型转换，转换的方式包括隐式转换以及显示转换。")]),a._v(" "),s("p",[s("strong",[a._v("方式一：隐式转换")])]),a._v(" "),s("p",[a._v("具体规则如下：")]),a._v(" "),s("p",[a._v("a. 任何整数类型都可以隐式地转换为一个范围更广的类型，如tinyint可以转换成int，int可以转换成bigint。")]),a._v(" "),s("p",[a._v("b. 所有整数类型、float和string类型都可以隐式地转换成double。")]),a._v(" "),s("p",[a._v("c. tinyint、smallint、int都可以转换为float。")]),a._v(" "),s("p",[a._v("d. boolean类型不可以转换为任何其它的类型。")]),a._v(" "),s("p",[a._v("详情可参考Hive官方说明："),s("a",{attrs:{href:"#LanguageManualTypes-AllowedImplicitConversions"}},[a._v("Allowed Implicit Conversions")])]),a._v(" "),s("p",[s("strong",[a._v("方式二：显示转换")])]),a._v(" "),s("p",[a._v("可以借助cast函数完成显示的类型转换")]),a._v(" "),s("p",[a._v("a.语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cast(expr as <type>) \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("b.案例")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select '1' + 2, cast('1' as int) + 2;\n\n_c0    _c1\n3.0     3\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("PARTITIONED BY（重点）")]),a._v(" "),s("p",[a._v("创建分区表")])]),a._v(" "),s("li",[s("p",[a._v("CLUSTERED BY ... SORTED BY...INTO ... BUCKETS（重点）")]),a._v(" "),s("p",[a._v("创建分桶表")])]),a._v(" "),s("li",[s("p",[a._v("ROW FORMAT（重点）")]),a._v(" "),s("p",[a._v("指定SERDE，SERDE是Serializer and Deserializer的简写。Hive使用SERDE序列化和反序列化每行数据。详情可参考 "),s("a",{attrs:{href:"#DeveloperGuide-HiveSerDe"}},[a._v("Hive-Serde")]),a._v("。语法说明如下：")])])]),a._v(" "),s("p",[s("strong",[a._v("语法一")]),a._v("：DELIMITED关键字表示对文件中的每个字段按照特定分割符进行分割，其会使用默认的SERDE对每行数据进行序列化和反序列化。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ROW FORAMT DELIMITED \n[FIELDS TERMINATED BY char] \n[COLLECTION ITEMS TERMINATED BY char] \n[MAP KEYS TERMINATED BY char] \n[LINES TERMINATED BY char] \n[NULL DEFINED AS char]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("注：")]),a._v(" "),s("ul",[s("li",[a._v("fields terminated by ：列分隔符")]),a._v(" "),s("li",[a._v("collection items terminated by ： map、struct和array中每个元素之间的分隔符")]),a._v(" "),s("li",[a._v("map keys terminated by ：map中的key与value的分隔符")]),a._v(" "),s("li",[a._v("lines terminated by ：行分隔符")])]),a._v(" "),s("p",[s("strong",[a._v("语法二")]),a._v("：SERDE关键字可用于指定其他内置的SERDE或者用户自定义的SERDE。例如JSON SERDE，可用于处理JSON字符串。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ROW FORMAT SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value,property_name=property_value, ...)] \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("STORED AS（重点）")])]),a._v(" "),s("p",[a._v("指定文件格式，常用的文件格式有，textfile（默认值），sequence file，orc file、parquet file等等。")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("LOCATION")]),a._v(" "),s("p",[a._v("指定表所对应的HDFS路径，若不指定路径，其默认值为")]),a._v(" "),s("p",[s("code",[a._v("${hive.metastore.warehouse.dir}/db_name.db/table_name")])])]),a._v(" "),s("li",[s("p",[a._v("TBLPROPERTIES")]),a._v(" "),s("p",[a._v("用于配置表的一些KV键值对参数")])])]),a._v(" "),s("h5",{attrs:{id:"_2-create-table-as-select-ctas-建表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-create-table-as-select-ctas-建表"}},[a._v("#")]),a._v(" 2）Create Table As Select（CTAS）建表")]),a._v(" "),s("p",[a._v("该语法允许用户利用select查询语句返回的结果，直接建表，表的结构和查询语句的结构保持一致，且保证包含select查询语句放回的内容。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("CREATE [TEMPORARY] TABLE [IF NOT EXISTS] table_name \n[COMMENT table_comment] \n[ROW FORMAT row_format] \n[STORED AS file_format] \n[LOCATION hdfs_path]\n[TBLPROPERTIES (property_name=property_value, ...)]\n[AS select_statement]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h5",{attrs:{id:"_3-create-table-like语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-create-table-like语法"}},[a._v("#")]),a._v(" 3）Create Table Like语法")]),a._v(" "),s("p",[a._v("该语法允许用户复刻一张已经存在的表结构，与上述的CTAS语法不同，该语法创建出来的表中不包含数据。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name\n[LIKE exist_table_name]\n[ROW FORMAT row_format] \n[STORED AS file_format] \n[LOCATION hdfs_path]\n[TBLPROPERTIES (property_name=property_value, ...)]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h4",{attrs:{id:"_3-2-1-2-案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-2-案例"}},[a._v("#")]),a._v(" 3.2.1.2 案例")]),a._v(" "),s("h5",{attrs:{id:"_1-内部表与外部表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-内部表与外部表"}},[a._v("#")]),a._v(" 1）内部表与外部表")]),a._v(" "),s("p",[s("strong",[a._v("（1）内部表")])]),a._v(" "),s("p",[a._v("Hive中默认创建的表都是的"),s("strong",[a._v("内部表")]),a._v("，有时也被称为"),s("strong",[a._v("管理表")]),a._v("。对于内部表，Hive会完全管理表的元数据和数据文件。")]),a._v(" "),s("p",[a._v("创建内部表如下：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("create table if not exists student(\n    id int, \n    name string\n)\nrow format delimited fields terminated by '\\t'\nlocation '/user/hive/warehouse/student';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("准备其需要的文件如下，注意字段之间的分隔符。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 datas]$ vim /opt/module/datas/student.txt\n\n1001\tstudent1\n1002\tstudent2\n1003\tstudent3\n1004\tstudent4\n1005\tstudent5\n1006\tstudent6\n1007\tstudent7\n1008\tstudent8\n1009\tstudent9\n1010\tstudent10\n1011\tstudent11\n1012\tstudent12\n1013\tstudent13\n1014\tstudent14\n1015\tstudent15\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br")])]),s("p",[a._v("上传文件到Hive表指定的路径")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 datas]$ hadoop fs -put student.txt /user/hive/warehouse/student\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("删除表，观察数据HDFS中的数据文件是否还在")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> drop table student;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("（2）外部表")])]),a._v(" "),s("p",[a._v("外部表通常可用于处理其他工具上传的数据文件，对于外部表，Hive只负责管理元数据，不负责管理HDFS中的数据文件。")]),a._v(" "),s("p",[a._v("创建外部表如下：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("create external table if not exists student(\n    id int, \n    name string\n)\nrow format delimited fields terminated by '\\t'\nlocation '/user/hive/warehouse/student';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("上传文件到Hive表指定的路径")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 datas]$ hadoop fs -put student.txt /user/hive/warehouse/student\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("删除表，观察数据HDFS中的数据文件是否还在**(文件还在)**")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> drop table student;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h5",{attrs:{id:"_2-serde和复杂数据类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-serde和复杂数据类型"}},[a._v("#")]),a._v(" 2）SERDE和复杂数据类型")]),a._v(" "),s("p",[a._v("本案例重点练习SERDE和复杂数据类型的使用。")]),a._v(" "),s("p",[a._v("若现有如下格式的JSON文件需要由Hive进行分析处理，请考虑如何设计表？")]),a._v(" "),s("p",[a._v("注：以下内容为格式化之后的结果，文件中每行数据为一个完整的JSON字符串。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('{\n    "name": "dasongsong",\n    "friends": [\n        "bingbing",\n        "lili"\n    ],\n    "students": {\n        "xiaohaihai": 18,\n        "xiaoyangyang": 16\n    },\n    "address": {\n        "street": "hui long guan",\n        "city": "beijing",\n        "postal_code": 10010\n    }\n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("p",[a._v("我们可以考虑使用专门负责JSON文件的JSON Serde，设计表字段时，表的字段与JSON字符串中的一级字段保持一致，对于具有嵌套结构的JSON字符串，考虑使用合适复杂数据类型保存其内容。最终设计出的表结构如下：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive>\ncreate table teacher\n(\n    name     string,\n    friends  array<string>,\n    students map<string,int>,\n    address  struct<city:string,street:string,postal_code:int>\n)\nrow format serde 'org.apache.hadoop.hive.serde2.JsonSerDe'\nlocation '/user/hive/warehouse/teacher';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("创建该表，并准备以下文件。注意，需要确保文件中每行数据都是一个完整的JSON字符串，JSON SERDE才能正确的处理。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('[atguigu@hadoop102 datas]$ vim /opt/module/datas/teacher.txt\n\n{"name":"dasongsong","friends":["bingbing","lili"],"students":{"xiaohaihai":18,"xiaoyangyang":16},"address":{"street":"hui long guan","city":"beijing","postal_code":10010}}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("上传文件到Hive表指定的路径")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 datas]$ hadoop fs -put teacher.txt /user/hive/warehouse/teacher\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("尝试从复杂数据类型的字段中取值")]),a._v(" "),s("p",[a._v("![image-20231010221120808](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231010221120808.png?lastModify=1697035398)")]),a._v(" "),s("h5",{attrs:{id:"_3-create-table-as-select和create-table-like"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-create-table-as-select和create-table-like"}},[a._v("#")]),a._v(" 3）create table as select和create table like")]),a._v(" "),s("h5",{attrs:{id:"_1-create-table-as-select"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-create-table-as-select"}},[a._v("#")]),a._v(" （1）create table as select")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive>\ncreate table teacher1 as select * from teacher;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h5",{attrs:{id:"_2-create-table-like"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-create-table-like"}},[a._v("#")]),a._v(" （2）create table like")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive>\ncreate table teacher2 like teacher;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_3-2-2-查看表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-查看表"}},[a._v("#")]),a._v(" 3.2.2 查看表")]),a._v(" "),s("h4",{attrs:{id:"_1-展示所有表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-展示所有表"}},[a._v("#")]),a._v(" 1）展示所有表")]),a._v(" "),s("p",[s("strong",[a._v("（1）语法")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("SHOW TABLES [IN database_name] LIKE ['identifier_with_wildcards'];\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("注：like通配表达式说明：*表示任意个任意字符，|表示或的关系。")]),a._v(" "),s("p",[s("strong",[a._v("（2）案例")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> show tables like 'stu*';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-查看表信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看表信息"}},[a._v("#")]),a._v(" 2）查看表信息")]),a._v(" "),s("p",[s("strong",[a._v("（1）语法")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("DESCRIBE [EXTENDED | FORMATTED] [db_name.]table_name\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("注：EXTENDED：展示详细信息 FORMATTED：对详细信息进行格式化的展示")]),a._v(" "),s("p",[s("strong",[a._v("（2）案例")])]),a._v(" "),s("p",[s("strong",[a._v("查看基本信息")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> desc stu;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("查看更多信息")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> desc formatted stu;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_3-2-3-修改表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-修改表"}},[a._v("#")]),a._v(" 3.2.3 修改表")]),a._v(" "),s("h4",{attrs:{id:"_1-重命名表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-重命名表"}},[a._v("#")]),a._v(" 1）重命名表")]),a._v(" "),s("p",[s("strong",[a._v("（1）语法")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ALTER TABLE table_name RENAME TO new_table_name\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("（2）案例")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> alter table stu rename to stu1;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-修改列信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改列信息"}},[a._v("#")]),a._v(" 2）修改列信息")]),a._v(" "),s("p",[s("strong",[a._v("（1）语法")])]),a._v(" "),s("p",[a._v("增加列")]),a._v(" "),s("p",[a._v("该语句允许用户增加新的列，新增列的位置位于末尾。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ALTER TABLE table_name ADD COLUMNS (col_name data_type [COMMENT col_comment], ...)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("更新列")]),a._v(" "),s("p",[a._v("该语句允许用户修改指定列的列名、数据类型、注释信息以及在表中的位置。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment] [FIRST|AFTER column_name]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("替换列")]),a._v(" "),s("p",[a._v("该语句允许用户用新的列集替换表中原有的全部列。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ALTER TABLE table_name REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-案例-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例-2"}},[a._v("#")]),a._v(" 2）案例")]),a._v(" "),s("p",[s("strong",[a._v("（1）查询表结构")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> desc stu;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("（2）添加列")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> alter table stu add columns(age int);\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("（3）查询表结构")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> desc stu;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("（4）更新列")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> alter table stu change column age ages double;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("（6）替换列")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> alter table stu replace columns(id int, name string);\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_3-2-4-删除表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-删除表"}},[a._v("#")]),a._v(" 3.2.4 删除表")]),a._v(" "),s("h4",{attrs:{id:"_1-语法-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法-4"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("DROP TABLE [IF EXISTS] table_name;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-案例-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例-3"}},[a._v("#")]),a._v(" 2）案例")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> drop table stu;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_3-2-5-清空表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-5-清空表"}},[a._v("#")]),a._v(" 3.2.5 清空表")]),a._v(" "),s("h4",{attrs:{id:"_1-语法-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法-5"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("TRUNCATE [TABLE] table_name\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("注意：truncate只能清空管理表，不能删除外部表中数据。")]),a._v(" "),s("h4",{attrs:{id:"_2-案例-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例-4"}},[a._v("#")]),a._v(" 2）案例")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> truncate table student;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h1",{attrs:{id:"第4章-dml-data-manipulation-language-数据操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第4章-dml-data-manipulation-language-数据操作"}},[a._v("#")]),a._v(" 第4章 DML（Data Manipulation Language）数据操作")]),a._v(" "),s("h2",{attrs:{id:"_4-1-load"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-load"}},[a._v("#")]),a._v(" 4.1 Load")]),a._v(" "),s("p",[a._v("Load语句可将文件导入到Hive表中。")]),a._v(" "),s("p",[s("strong",[a._v("1）语法")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> \nLOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)];\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("关键字说明：")]),a._v(" "),s("ul",[s("li",[a._v("（1）local：表示从本地加载数据到Hive表；否则从HDFS加载数据到Hive表。")]),a._v(" "),s("li",[a._v("（2）overwrite：表示覆盖表中已有数据，否则表示追加。")]),a._v(" "),s("li",[a._v("（3）partition：表示上传到指定分区，若目标是分区表，需指定分区。")])]),a._v(" "),s("h4",{attrs:{id:"_2-实操案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-实操案例"}},[a._v("#")]),a._v(" 2）实操案例")]),a._v(" "),s("p",[a._v("（0）创建一张表")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \ncreate table student(\n    id int, \n    name string\n) \nrow format delimited fields terminated by '\\t';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("（1）加载本地文件到hive")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> load data local inpath '/opt/module/datas/student.txt' into table student;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（2）加载HDFS文件到hive中")]),a._v(" "),s("p",[a._v("上传文件到HDFS")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 ~]$ hadoop fs -put /opt/module/datas/student.txt /user/atguigu\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("加载HDFS上数据，导入完成后去HDFS上查看文件是否还存在")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nload data inpath '/user/atguigu/student.txt' \ninto table student;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("（3）加载数据覆盖表中已有的数据")]),a._v(" "),s("p",[a._v("上传文件到HDFS")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> dfs -put /opt/module/datas/student.txt /user/atguigu;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("加载数据覆盖表中已有的数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nload data inpath '/user/atguigu/student.txt' overwrite into table student;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h2",{attrs:{id:"_4-2-insert"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-insert"}},[a._v("#")]),a._v(" 4.2 Insert")]),a._v(" "),s("h3",{attrs:{id:"_4-2-1-将查询结果插入表中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-将查询结果插入表中"}},[a._v("#")]),a._v(" 4.2.1  将查询结果插入表中")]),a._v(" "),s("h4",{attrs:{id:"_1-语法-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法-6"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("INSERT (INTO | OVERWRITE) TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("关键字说明：")]),a._v(" "),s("p",[a._v("（1）INTO：将结果追加到目标表")]),a._v(" "),s("p",[a._v("（2）OVERWRITE：用结果覆盖原有数据")]),a._v(" "),s("h4",{attrs:{id:"_2-案例-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例-5"}},[a._v("#")]),a._v(" 2）案例")]),a._v(" "),s("p",[a._v("（1）新建一张表")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \ncreate table student1(\n    id int, \n    name string\n) \nrow format delimited fields terminated by '\\t';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("（2）根据查询结果插入数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> insert overwrite table student3 \nselect \n    id, \n    name \nfrom student;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"_4-2-2-将给定values插入表中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-将给定values插入表中"}},[a._v("#")]),a._v(" 4.2.2 将给定Values插入表中")]),a._v(" "),s("p",[s("strong",[a._v("1）语法")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("INSERT (INTO | OVERWRITE) TABLE tablename [PARTITION (partcol1[=val1], partcol2[=val2] ...)] VALUES values_row [, values_row ...]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("2）案例")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> insert into table  student1 values(1,'wangwu'),(2,'zhaoliu');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_4-2-3-将查询结果写入目标路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-将查询结果写入目标路径"}},[a._v("#")]),a._v(" 4.2.3 将查询结果写入目标路径")]),a._v(" "),s("h4",{attrs:{id:"_1-语法-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法-7"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("INSERT OVERWRITE [LOCAL] DIRECTORY directory\n  [ROW FORMAT row_format] [STORED AS file_format] select_statement;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_2-案例-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例-6"}},[a._v("#")]),a._v(" 2）案例")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("insert overwrite local directory '/opt/module/datas/student' ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.JsonSerDe'\nselect id,name from student;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_4-3-export-import"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-export-import"}},[a._v("#")]),a._v(" 4.3 Export&Import")]),a._v(" "),s("p",[a._v("Export导出语句可将表的数据和元数据信息一并到处的HDFS路径，Import可将Export导出的内容导入Hive，表的数据和元数据信息都会恢复。Export和Import可用于两个Hive实例之间的数据迁移。")]),a._v(" "),s("h4",{attrs:{id:"_1-语法-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法-8"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("--导出\nEXPORT TABLE tablename TO 'export_target_path'\n\n--导入\nIMPORT [EXTERNAL] TABLE new_or_original_tablena\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h4",{attrs:{id:"_2-案例-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例-7"}},[a._v("#")]),a._v(" 2）案例")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("--导出\nhive>\nexport table default.student to '/user/hive/warehouse/export/student';\n\n--导入\nhive>\nimport table student2 from '/user/hive/warehouse/export/student';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h1",{attrs:{id:"第6章-查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第6章-查询"}},[a._v("#")]),a._v(" 第6章 查询")]),a._v(" "),s("h2",{attrs:{id:"_6-1-基础语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-基础语法"}},[a._v("#")]),a._v(" 6.1 基础语法")]),a._v(" "),s("h4",{attrs:{id:"_1-官网地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-官网地址"}},[a._v("#")]),a._v(" 1）官网地址")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("2）查询语句语法：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("SELECT [ALL | DISTINCT] select_expr, select_expr, ...\n  FROM table_reference       -- 从什么表查\n  [WHERE where_condition]   -- 过滤\n  [GROUP BY col_list]        -- 分组查询\n   [HAVING col_list]          -- 分组后过滤\n  [ORDER BY col_list]        -- 排序\n  [CLUSTER BY col_list\n    | [DISTRIBUTE BY col_list] [SORT BY col_list]\n  ]\n [LIMIT number]                -- 限制输出的行数\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h2",{attrs:{id:"_6-2-基本查询-select-from"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-基本查询-select-from"}},[a._v("#")]),a._v(" 6.2 基本查询（Select…From）")]),a._v(" "),s("h3",{attrs:{id:"_6-2-1-数据准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-1-数据准备"}},[a._v("#")]),a._v(" 6.2.1 数据准备")]),a._v(" "),s("p",[a._v("（0）原始数据")]),a._v(" "),s("p",[a._v("在/opt/module/hive/datas/路径上创建dept.txt文件，并赋值如下内容：")]),a._v(" "),s("p",[a._v("部门编号 部门名称 部门位置id")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 datas]$ vim dept.txt\n\n10  行政部 1700\n20  财务部 1800\n30  教学部 1900\n40  销售部 1700\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("/opt/module/hive/datas/路径上创建emp.txt文件，并赋值如下内容：")]),a._v(" "),s("p",[a._v("员工编号 姓名 岗位    薪资  部门")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 datas]$ vim emp.txt\n\n7369    张三  研发  800.00  30\n7499    李四  财务  1600.00 20\n7521    王五  行政  1250.00 10\n7566    赵六  销售  2975.00 40\n7654    侯七  研发  1250.00 30\n7698    马八  研发  2850.00 30\n7782    金九  \\N  2450.0  30\n7788    银十  行政  3000.00 10\n7839    小芳  销售  5000.00 40\n7844    小明  销售  1500.00 40\n7876    小李  行政  1100.00 10\n7900    小元  讲师  950.00  30\n7902    小海  行政  3000.00 10\n7934    小红明 讲师  1300.00 30\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("p",[a._v("（1）创建部门表")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)>\ncreate table if not exists dept(\n    deptno int,    -- 部门编号\n    dname string,  -- 部门名称\n    loc int        -- 部门位置\n)\nrow format delimited fields terminated by '\\t';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("（2）创建员工表")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)>\ncreate table if not exists emp(\n    empno int,      -- 员工编号\n    ename string,   -- 员工姓名\n    job string,     -- 员工岗位（大数据工程师、前端工程师、java工程师）\n    sal double,     -- 员工薪资\n    deptno int      -- 部门编号\n)\nrow format delimited fields terminated by '\\t';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("（3）导入数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)>\nload data local inpath '/opt/module/hive/datas/dept.txt' into table dept;\nload data local inpath '/opt/module/hive/datas/emp.txt' into table emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"_6-2-2-全表和特定列查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-2-全表和特定列查询"}},[a._v("#")]),a._v(" 6.2.2 全表和特定列查询")]),a._v(" "),s("h4",{attrs:{id:"_1-全表查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-全表查询"}},[a._v("#")]),a._v(" 1）全表查询")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select * from emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-选择特定列查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-选择特定列查询"}},[a._v("#")]),a._v(" 2）选择特定列查询")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select empno, ename from emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("注意： （1）SQL 语言"),s("strong",[a._v("大小写不敏感")]),a._v("。  （2）SQL 可以写在一行或者多行。 （3）关键字不能被缩写也不能分行。 （4）各子句一般要分行写。 （5）使用缩进提高语句的可读性。")]),a._v(" "),s("h3",{attrs:{id:"_6-2-3-列别名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-3-列别名"}},[a._v("#")]),a._v(" 6.2.3 列别名")]),a._v(" "),s("p",[a._v("1）重命名一个列 2）便于计算 3）紧跟列名，也可以在列名和别名之间加入关键字‘AS’  4）案例实操")]),a._v(" "),s("p",[a._v("查询名称和部门。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    ename AS name, \n    deptno dn \nfrom emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"_6-2-4-limit语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-4-limit语句"}},[a._v("#")]),a._v(" 6.2.4 Limit语句")]),a._v(" "),s("p",[a._v("典型的查询会返回多行数据。limit子句用于限制返回的行数。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select * from emp limit 5; \nhive (default)> select * from emp limit 2,3; -- 表示从第2行开始，向下抓取3行\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_6-2-5-where语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-5-where语句"}},[a._v("#")]),a._v(" 6.2.5 Where语句")]),a._v(" "),s("p",[a._v("1）使用where子句，将不满足条件的行过滤掉")]),a._v(" "),s("p",[a._v("2）where子句紧随from子句")]),a._v(" "),s("p",[a._v("3）案例实操")]),a._v(" "),s("p",[a._v("查询出薪水大于1000的所有员工。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select * from emp where sal > 1000;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("blockquote",[s("p",[a._v("注意：where子句中不能使用字段别名。")])]),a._v(" "),s("h3",{attrs:{id:"_6-2-6-关系运算函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-6-关系运算函数"}},[a._v("#")]),a._v(" 6.2.6 关系运算函数")]),a._v(" "),s("p",[a._v("1）基本语法")]),a._v(" "),s("p",[a._v("如下操作符主要用于where和having语句中。")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[a._v("操作符")])]),a._v(" "),s("th",[s("strong",[a._v("支持的数据类型")])]),a._v(" "),s("th",[s("strong",[a._v("描述")])])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("A=B")]),a._v(" "),s("td",[a._v("基本数据类型")]),a._v(" "),s("td",[a._v("如果A等于B则返回true，反之返回false")])]),a._v(" "),s("tr",[s("td",[a._v("A<=>B")]),a._v(" "),s("td",[a._v("基本数据类型")]),a._v(" "),s("td",[a._v("如果A和B都为null或者都不为null，则返回true，如果只有一边为null，返回false")])]),a._v(" "),s("tr",[s("td",[a._v("A<>B, A!=B")]),a._v(" "),s("td",[a._v("基本数据类型")]),a._v(" "),s("td",[a._v("A或者B为null则返回null；如果A不等于B，则返回true，反之返回false")])]),a._v(" "),s("tr",[s("td",[a._v("A<B")]),a._v(" "),s("td",[a._v("基本数据类型")]),a._v(" "),s("td",[a._v("A或者B为null，则返回null；如果A小于B，则返回true，反之返回false")])]),a._v(" "),s("tr",[s("td",[a._v("A<=B")]),a._v(" "),s("td",[a._v("基本数据类型")]),a._v(" "),s("td",[a._v("A或者B为null，则返回null；如果A小于等于B，则返回true，反之返回false")])]),a._v(" "),s("tr",[s("td",[a._v("A>B")]),a._v(" "),s("td",[a._v("基本数据类型")]),a._v(" "),s("td",[a._v("A或者B为null，则返回null；如果A大于B，则返回true，反之返回false")])]),a._v(" "),s("tr",[s("td",[a._v("A>=B")]),a._v(" "),s("td",[a._v("基本数据类型")]),a._v(" "),s("td",[a._v("A或者B为null，则返回null；如果A大于等于B，则返回true，反之返回false")])]),a._v(" "),s("tr",[s("td",[a._v("A [not] between B and C")]),a._v(" "),s("td",[a._v("基本数据类型")]),a._v(" "),s("td",[a._v("如果A，B或者C任一为null，则结果为null。如果A的值大于等于B而且小于或等于C，则结果为true，反之为false。如果使用not关键字则可达到相反的效果。")])]),a._v(" "),s("tr",[s("td",[a._v("A is null")]),a._v(" "),s("td",[a._v("所有数据类型")]),a._v(" "),s("td",[a._v("如果A等于null，则返回true，反之返回false")])]),a._v(" "),s("tr",[s("td",[a._v("A is not null")]),a._v(" "),s("td",[a._v("所有数据类型")]),a._v(" "),s("td",[a._v("如果A不等于null，则返回true，反之返回false")])]),a._v(" "),s("tr",[s("td",[a._v("in（数值1，数值2）")]),a._v(" "),s("td",[a._v("所有数据类型")]),a._v(" "),s("td",[a._v("使用 in运算显示列表中的值")])]),a._v(" "),s("tr",[s("td",[a._v("A [not] like B")]),a._v(" "),s("td",[a._v("string 类型")]),a._v(" "),s("td",[a._v("B是一个SQL下的简单正则表达式，也叫通配符模式，如果A与其匹配的话，则返回true；反之返回false。B的表达式说明如下：‘x%’表示A必须以字母‘x’开头，‘%x’表示A必须以字母‘x’结尾，而‘%x%’表示A包含有字母‘x’,可以位于开头，结尾或者字符串中间。如果使用not关键字则可达到相反的效果。")])]),a._v(" "),s("tr",[s("td",[a._v("A rlike B, A regexp B")]),a._v(" "),s("td",[a._v("string 类型")]),a._v(" "),s("td",[a._v("B是基于java的正则表达式，如果A与其匹配，则返回true；反之返回false。匹配使用的是JDK中的正则表达式接口实现的，因为正则也依据其中的规则。例如，正则表达式必须和整个字符串A相匹配，而不是只需与其字符串匹配。")])])])]),a._v(" "),s("h3",{attrs:{id:"_6-2-7-逻辑运算函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-7-逻辑运算函数"}},[a._v("#")]),a._v(" 6.2.7 逻辑运算函数")]),a._v(" "),s("h4",{attrs:{id:"_1-基本语法-and-or-not"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-基本语法-and-or-not"}},[a._v("#")]),a._v(" 1）基本语法（and/or/not）")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[a._v("操作符")])]),a._v(" "),s("th",[s("strong",[a._v("含义")])])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("and")]),a._v(" "),s("td",[a._v("逻辑并")])]),a._v(" "),s("tr",[s("td",[a._v("or")]),a._v(" "),s("td",[a._v("逻辑或")])]),a._v(" "),s("tr",[s("td",[a._v("not")]),a._v(" "),s("td",[a._v("逻辑否")])])])]),a._v(" "),s("h4",{attrs:{id:"_2-案例实操"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例实操"}},[a._v("#")]),a._v(" 2）案例实操")]),a._v(" "),s("p",[a._v("（1）查询薪水大于1000，部门是30")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    * \nfrom emp \nwhere sal > 1000 and deptno = 30;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("（2）查询薪水大于1000，或者部门是30")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    * \nfrom emp \nwhere sal>1000 or deptno=30;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("（3）查询除了20部门和30部门以外的员工信息")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    * \nfrom emp \nwhere deptno not in(30, 20);\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"_6-2-8-聚合函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-8-聚合函数"}},[a._v("#")]),a._v(" 6.2.8 聚合函数")]),a._v(" "),s("h4",{attrs:{id:"_1-语法-9"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法-9"}},[a._v("#")]),a._v(" 1）语法")]),a._v(" "),s("p",[a._v("count(*)，表示统计所有行数，包含null值； count(某列)，表示该列一共有多少行，不包含null值； max()，求最大值，不包含null，除非所有值都是null； min()，求最小值，不包含null，除非所有值都是null； sum()，求和，不包含null。")]),a._v(" "),s("p",[a._v("avg()，求平均值，不包含null。")]),a._v(" "),s("h4",{attrs:{id:"_2-案例实操-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例实操-2"}},[a._v("#")]),a._v(" 2）案例实操")]),a._v(" "),s("p",[a._v("（1）求总行数（count）")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select count(*) cnt from emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225053279](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225053279.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("（2）求工资的最大值（max）")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select max(sal) max_sal from emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225122471](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225122471.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("（3）求工资的最小值（min）")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select min(sal) min_sal from emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225148103](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225148103.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("（4）求工资的总和（sum）")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select sum(sal) sum_sal from emp; \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225210915](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225210915.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("（5）求工资的平均值（avg）")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select avg(sal) avg_sal from emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225244386](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225244386.png?lastModify=1697035398)")]),a._v(" "),s("h2",{attrs:{id:"_6-3-分组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-分组"}},[a._v("#")]),a._v(" 6.3 分组")]),a._v(" "),s("h3",{attrs:{id:"_6-3-1-group-by语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-1-group-by语句"}},[a._v("#")]),a._v(" 6.3.1 Group By语句")]),a._v(" "),s("p",[a._v("Group By语句通常会和聚合函数一起使用，按照一个或者多个列队结果进行分组，然后对每个组执行聚合操作。")]),a._v(" "),s("h4",{attrs:{id:"_1-案例实操"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-案例实操"}},[a._v("#")]),a._v(" 1）案例实操：")]),a._v(" "),s("p",[a._v("（1）计算emp表每个部门的平均工资。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    t.deptno, \n    avg(t.sal) avg_sal \nfrom emp t \ngroup by t.deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225338623](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225338623.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("（2）计算emp每个部门中每个岗位的最高薪水。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)>\nselect \n    t.deptno, \n    t.job, \n    max(t.sal) max_sal \nfrom emp t \ngroup by t.deptno, t.job;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225413706](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225413706.png?lastModify=1697035398)")]),a._v(" "),s("h3",{attrs:{id:"_6-3-2-having语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-2-having语句"}},[a._v("#")]),a._v(" 6.3.2 Having语句")]),a._v(" "),s("h4",{attrs:{id:"_1-having与where不同点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-having与where不同点"}},[a._v("#")]),a._v(" 1）having与where不同点")]),a._v(" "),s("p",[a._v("（1）where后面不能写分组聚合函数，而having后面可以使用分组聚合函数。 （2）having只用于group by分组统计语句。")]),a._v(" "),s("h4",{attrs:{id:"_2-案例实操-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例实操-3"}},[a._v("#")]),a._v(" 2）案例实操")]),a._v(" "),s("p",[a._v("（1）求每个部门的平均薪水大于2000的部门")]),a._v(" "),s("p",[a._v("求每个部门的平均工资。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    deptno, \n    avg(sal) \nfrom emp \ngroup by deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225521319](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225521319.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("求每个部门的平均薪水大于2000的部门。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)>\nselect \n    deptno, \n    avg(sal) avg_sal \nfrom emp \ngroup by deptno  \nhaving avg_sal > 2000;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225549789](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225549789.png?lastModify=1697035398)")]),a._v(" "),s("h2",{attrs:{id:"_6-4-join语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-join语句"}},[a._v("#")]),a._v(" 6.4 Join语句")]),a._v(" "),s("h3",{attrs:{id:"_6-4-1-等值join"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-1-等值join"}},[a._v("#")]),a._v(" 6.4.1 等值Join")]),a._v(" "),s("p",[a._v("Hive支持通常的sql join语句，但是"),s("strong",[a._v("只支持等值连接，不支持非等值连接")]),a._v("（hive 高版本 > 2.0 支持非等值连接）。")]),a._v(" "),s("h4",{attrs:{id:"_1-案例实操-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-案例实操-2"}},[a._v("#")]),a._v(" 1）案例实操")]),a._v(" "),s("p",[a._v("（1）根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门名称。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    e.empno, \n    e.ename, \n    d.dname \nfrom emp e \njoin dept d \non e.deptno = d.deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011225637019](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011225637019.png?lastModify=1697035398)")]),a._v(" "),s("h3",{attrs:{id:"_6-4-2-表的别名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-2-表的别名"}},[a._v("#")]),a._v(" 6.4.2 表的别名")]),a._v(" "),s("h4",{attrs:{id:"_1-好处"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-好处"}},[a._v("#")]),a._v(" 1）好处")]),a._v(" "),s("p",[a._v("（1）使用别名可以简化查询。")]),a._v(" "),s("p",[a._v("（2）区分字段的来源。")]),a._v(" "),s("h4",{attrs:{id:"_2-案例实操-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例实操-4"}},[a._v("#")]),a._v(" 2）案例实操")]),a._v(" "),s("p",[a._v("合并员工表和部门表。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    e.*,\n    d.* \nfrom emp e \njoin dept d \non e.deptno = d.deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h3",{attrs:{id:"_6-4-3-内连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-3-内连接"}},[a._v("#")]),a._v(" 6.4.3 内连接")]),a._v(" "),s("p",[a._v("内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    e.empno, \n    e.ename, \n    d.deptno \nfrom emp e \njoin dept d \non e.deptno = d.deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h3",{attrs:{id:"_6-4-4-左外连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-4-左外连接"}},[a._v("#")]),a._v(" 6.4.4 左外连接")]),a._v(" "),s("p",[a._v("左外连接：join操作符左边表中符合where子句的所有记录将会被返回。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    e.empno, \n    e.ename, \n    d.deptno \nfrom emp e \nleft join dept d \non e.deptno = d.deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h3",{attrs:{id:"_6-4-5-右外连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-5-右外连接"}},[a._v("#")]),a._v(" 6.4.5 右外连接")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    e.empno, \n    e.ename, \n    d.deptno \nfrom emp e \nright join dept d \non e.deptno = d.deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h3",{attrs:{id:"_6-4-6-满外连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-6-满外连接"}},[a._v("#")]),a._v(" 6.4.6 满外连接")]),a._v(" "),s("p",[a._v("满外连接：将会返回所有表中符合where语句条件的所有记录。如果任一表的指定字段没有符合条件的值的话，那么就使用null值替代。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    e.empno, \n    e.ename, \n    d.deptno \nfrom emp e \nfull join dept d \non e.deptno = d.deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h3",{attrs:{id:"_6-4-7-多表连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-7-多表连接"}},[a._v("#")]),a._v(" 6.4.7 多表连接")]),a._v(" "),s("p",[a._v("注意：连接n个表，至少需要n-1个连接条件。例如：连接三个表，至少需要两个连接条件。")]),a._v(" "),s("p",[a._v("部门位置id  部门位置")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[atguigu@hadoop102 datas]$ vim location.txt\n\n1700    北京\n1800    上海\n1900    深圳\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h4",{attrs:{id:"_1-创建位置表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建位置表"}},[a._v("#")]),a._v(" 1）创建位置表")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)>\ncreate table if not exists location(\n    loc int,           -- 部门位置id\n    loc_name string   -- 部门位置\n)\nrow format delimited fields terminated by '\\t';\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h4",{attrs:{id:"_2-导入数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入数据"}},[a._v("#")]),a._v(" 2）导入数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> load data local inpath '/opt/module/hive/datas/location.txt' into table location;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-多表连接查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-多表连接查询"}},[a._v("#")]),a._v(" 3）多表连接查询")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    e.ename, \n    d.dname, \n    l.loc_name\nfrom emp e \njoin dept d\non d.deptno = e.deptno \njoin location l\non d.loc = l.loc;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("大多数情况下，Hive会对每对join连接对象启动一个MapReduce任务。本例中会首先启动一个MapReduce job对表e和表d进行连接操作，然后会再启动一个MapReduce job将第一个MapReduce job的输出和表l进行连接操作。")]),a._v(" "),s("p",[a._v("注意：为什么不是表d和表l先进行连接操作呢？这是因为Hive总是按照从左到右的顺序执行的。")]),a._v(" "),s("h3",{attrs:{id:"_6-4-8-笛卡尔集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-8-笛卡尔集"}},[a._v("#")]),a._v(" 6.4.8 笛卡尔集")]),a._v(" "),s("h4",{attrs:{id:"_1-笛卡尔集会在下面条件下产生"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-笛卡尔集会在下面条件下产生"}},[a._v("#")]),a._v(" 1）笛卡尔集会在下面条件下产生")]),a._v(" "),s("p",[a._v("（1）省略连接条件")]),a._v(" "),s("p",[a._v("（2）连接条件无效")]),a._v(" "),s("p",[a._v("（3）所有表中的所有行互相连接")]),a._v(" "),s("h4",{attrs:{id:"_2-案例实操-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例实操-5"}},[a._v("#")]),a._v(" 2）案例实操")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    empno, \n    dname \nfrom emp, dept;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011230113293](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011230113293.png?lastModify=1697035398)")]),a._v(" "),s("h3",{attrs:{id:"_6-4-9-联合-union-union-all"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-9-联合-union-union-all"}},[a._v("#")]),a._v(" 6.4.9 联合（union & union all）")]),a._v(" "),s("h4",{attrs:{id:"_1-union-union-all上下拼接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-union-union-all上下拼接"}},[a._v("#")]),a._v(" 1）union&union all上下拼接")]),a._v(" "),s("p",[a._v("union和union all都是上下拼接sql的结果，这点是和join有区别的，join是左右关联，union和union all是上下拼接。union去重，union all不去重。")]),a._v(" "),s("p",[a._v("union和union all在上下拼接sql结果时有两个要求： （1）两个sql的结果，列的个数必须相同 （2）两个sql的结果，上下所对应列的类型必须一致")]),a._v(" "),s("h4",{attrs:{id:"_2-案例实操-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-案例实操-6"}},[a._v("#")]),a._v(" 2）案例实操")]),a._v(" "),s("p",[a._v("将员工表30部门的员工信息和40部门的员工信息，利用union进行拼接显示。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    *\nfrom emp\nwhere deptno=30\nunion\nselect \n    *\nfrom emp\nwhere deptno=40;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h2",{attrs:{id:"_6-5-排序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-排序"}},[a._v("#")]),a._v(" 6.5 排序")]),a._v(" "),s("h3",{attrs:{id:"_6-5-1-全局排序-order-by"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-1-全局排序-order-by"}},[a._v("#")]),a._v(" 6.5.1 全局排序（Order By）")]),a._v(" "),s("p",[a._v("Order By：全局排序，只有一个Reduce。")]),a._v(" "),s("p",[a._v("1）使用Order By子句排序")]),a._v(" "),s("p",[a._v("asc（ascend）：升序（默认） desc（descend）：降序")]),a._v(" "),s("p",[a._v("2）Order By子句在select语句的结尾")]),a._v(" "),s("p",[a._v("3）基础案例实操")]),a._v(" "),s("p",[a._v("（1）查询员工信息按工资升序排列")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    * \nfrom emp \norder by sal;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011230316290](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011230316290.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("（2)查询员工信息按工资降序排列")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    * \nfrom emp \norder by sal desc;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("4）按照别名排序案例实操")]),a._v(" "),s("p",[a._v("按照员工薪水的2倍排序。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    ename, \n    sal * 2 twosal \nfrom emp \norder by twosal;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011230356852](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011230356852.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("5）多个列排序案例实操")]),a._v(" "),s("p",[a._v("按照部门和工资升序排序。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    ename, \n    deptno, \n    sal \nfrom emp \norder by deptno, sal;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011230417073](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011230417073.png?lastModify=1697035398)")]),a._v(" "),s("h3",{attrs:{id:"_6-5-2-每个reduce内部排序-sort-by"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-2-每个reduce内部排序-sort-by"}},[a._v("#")]),a._v(" 6.5.2 每个Reduce内部排序（Sort By）")]),a._v(" "),s("p",[a._v("Sort By：对于大规模的数据集order by的效率非常低。在很多情况下，并不需要全局排序，此时可以使用"),s("strong",[a._v("Sort by")]),a._v("。 Sort by为每个reduce产生一个排序文件。每个Reduce内部进行排序，对全局结果集来说不是排序。")]),a._v(" "),s("h4",{attrs:{id:"_1-设置reduce个数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-设置reduce个数"}},[a._v("#")]),a._v(" 1）设置reduce个数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> set mapreduce.job.reduces=3;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-查看设置reduce个数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看设置reduce个数"}},[a._v("#")]),a._v(" 2）查看设置reduce个数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> set mapreduce.job.reduces;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-根据部门编号降序查看员工信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-根据部门编号降序查看员工信息"}},[a._v("#")]),a._v(" 3）根据部门编号降序查看员工信息")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    * \nfrom emp \nsort by deptno desc;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011230546504](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011230546504.png?lastModify=1697035398)")]),a._v(" "),s("p",[a._v("4）将查询结果导入到文件中（按照部门编号降序排序）")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> insert overwrite local directory '/opt/module/hive/datas/sortby-result'\n select * from emp sort by deptno desc;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_6-5-3-分区-distribute-by"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-3-分区-distribute-by"}},[a._v("#")]),a._v(" 6.5.3 分区（Distribute By）")]),a._v(" "),s("p",[a._v("Distribute By：在有些情况下，我们需要控制某个特定行应该到哪个Reducer，通常是为了进行后续的聚集操作。"),s("strong",[a._v("distribute by")]),a._v("子句可以做这件事。"),s("strong",[a._v("distribute by")]),a._v("类似MapReduce中partition（自定义分区），进行分区，结合sort by使用。")]),a._v(" "),s("p",[a._v("对于distribute by进行测试，一定要分配多reduce进行处理，否则无法看到distribute by的效果。")]),a._v(" "),s("p",[a._v("1）案例实操：")]),a._v(" "),s("p",[a._v("（1）先按照部门编号分区，再按照员工编号薪资排序")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> set mapreduce.job.reduces=3;\nhive (default)> \ninsert overwrite local directory \n'/opt/module/hive/datas/distribute-result' \n\nselect \n    * \nfrom emp \ndistribute by deptno \nsort by sal desc;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("注意：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("distribute by的分区规则是根据分区字段的hash码与reduce的个数进行相除后，余数相同的分到一个区")])]),a._v(" "),s("li",[s("p",[a._v("Hive要求distribute by语句要写在sort by语句之前。")])]),a._v(" "),s("li",[s("p",[a._v("演示完以后mapreduce.job.reduces的值要设置回-1，否则下面分区or分桶表load跑MapReduce的时候会报错。 hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011230935029](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011230935029.png?lastModify=1697035398)")])])]),a._v(" "),s("h3",{attrs:{id:"_6-5-4-分区排序-cluster-by"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-4-分区排序-cluster-by"}},[a._v("#")]),a._v(" 6.5.4 分区排序（Cluster By）")]),a._v(" "),s("p",[a._v("当distribute by和sort by字段相同时，可以使用cluster by方式。 cluster by除了具有distribute by的功能外还兼具sort by的功能。但是排序"),s("strong",[a._v("只能是升序排序")]),a._v("，不能指定排序规则为asc或者desc。")]),a._v(" "),s("p",[a._v("（1）以下两种写法等价")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    * \nfrom emp \ncluster by deptno;\n\nhive (default)> \nselect \n    * \nfrom emp \ndistribute by deptno \nsort by deptno;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[a._v("注意：按照部门编号分区，不一定就是固定死的数值，可以是20号和30号部门分到一个分区里面去。")]),a._v(" "),s("p",[a._v("hive sql执行过程：")]),a._v(" "),s("p",[a._v("![image-20231011231305562](file://F:/workspace/github/young-blog/docs/.vuepress/public/kafka/image-20231011231305562.png?lastModify=1697035398)")]),a._v(" "),s("h1",{attrs:{id:"第8章-函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第8章-函数"}},[a._v("#")]),a._v(" 第8章 函数")]),a._v(" "),s("h2",{attrs:{id:"_8-1-函数简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-函数简介"}},[a._v("#")]),a._v(" 8.1 函数简介")]),a._v(" "),s("p",[a._v("Hive会将常用的逻辑封装成"),s("strong",[a._v("函数")]),a._v("给用户进行使用，类似于Java中的函数。\n好处：避免用户反复写逻辑，可以直接拿来使用。\n重点：用户需要知道函数"),s("strong",[a._v("叫什么")]),a._v("，能"),s("strong",[a._v("做什么")]),a._v("。\nHive提供了大量的内置函数，按照其特点可大致分为如下几类：单行函数、聚合函数、炸裂函数、窗口函数。以下命令可用于查询所有内置函数的相关信息。")]),a._v(" "),s("p",[a._v("1）查看系统内置函数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> show functions;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("2）查看内置函数用法")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> desc function upper;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("3）查看内置函数详细信息")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> desc function extended upper;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_8-2-单行函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-单行函数"}},[a._v("#")]),a._v(" 8.2 单行函数")]),a._v(" "),s("p",[a._v("单行函数的特点是一进一出，即输入一行，输出一行。\n单行函数按照功能可分为如下几类: 日期函数、字符串函数、集合函数、数学函数、流程控制函数等。")]),a._v(" "),s("h3",{attrs:{id:"_8-2-1-算术运算函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-1-算术运算函数"}},[a._v("#")]),a._v(" "),s("strong",[a._v("8.2.1 算术运算")]),a._v("函数")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[a._v("运算符")])]),a._v(" "),s("th",[s("strong",[a._v("描述")])])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("A+B")]),a._v(" "),s("td",[a._v("A和B 相加")])]),a._v(" "),s("tr",[s("td",[a._v("A-B")]),a._v(" "),s("td",[a._v("A减去B")])]),a._v(" "),s("tr",[s("td",[a._v("A*B")]),a._v(" "),s("td",[a._v("A和B 相乘")])]),a._v(" "),s("tr",[s("td",[a._v("A/B")]),a._v(" "),s("td",[a._v("A除以B")])]),a._v(" "),s("tr",[s("td",[a._v("A%B")]),a._v(" "),s("td",[a._v("A对B取余")])]),a._v(" "),s("tr",[s("td",[a._v("A&B")]),a._v(" "),s("td",[a._v("A和B按位取与")])]),a._v(" "),s("tr",[s("td",[a._v("A|B")]),a._v(" "),s("td",[a._v("A和B按位取或")])]),a._v(" "),s("tr",[s("td",[a._v("A^B")]),a._v(" "),s("td",[a._v("A和B按位取异或")])]),a._v(" "),s("tr",[s("td",[a._v("~A")]),a._v(" "),s("td",[a._v("A按位取反")])])])]),a._v(" "),s("p",[a._v("案例实操：查询出所有员工的薪水后加1显示。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> select sal + 1 from emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_8-2-2-数值函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-2-数值函数"}},[a._v("#")]),a._v(" 8.2.2 数值函数")]),a._v(" "),s("h4",{attrs:{id:"_1-round-四舍五入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-round-四舍五入"}},[a._v("#")]),a._v(" 1）round：四舍五入")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select round(3.3);   3\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-ceil-向上取整"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ceil-向上取整"}},[a._v("#")]),a._v(" 2）ceil：向上取整")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select ceil(3.1) ;   4\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-floor-向下取整"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-floor-向下取整"}},[a._v("#")]),a._v(" 3）floor：向下取整")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select floor(4.8);  4\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_8-2-3-字符串函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-3-字符串函数"}},[a._v("#")]),a._v(" 8.2.3 字符串函数")]),a._v(" "),s("h4",{attrs:{id:"_1-substring-截取字符串"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-substring-截取字符串"}},[a._v("#")]),a._v(" 1）substring：截取字符串")]),a._v(" "),s("p",[a._v("语法一：substring(string A, int start)\n返回值：string\n说明：返回字符串A从start位置到结尾的字符串\n语法二：substring(string A, int start, int len)\n返回值：string\n说明：返回字符串A从start位置开始，长度为len的字符串\n案例实操：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("（1）获取第二个字符以后的所有字符")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive> select substring("andanyoung",2);  ndanyoung\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("（2）获取倒数第三个字符以后的所有字符")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive> select substring("andanyoung",-3); ung\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("（3）从第3个字符开始，向后获取2个字符")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive> select substring("andanyoung",3,2); da\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])]),a._v(" "),s("h4",{attrs:{id:"_2-replace-替换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-replace-替换"}},[a._v("#")]),a._v(" 2）replace ：替换")]),a._v(" "),s("p",[a._v("语法：replace(string A, string B, string C)")]),a._v(" "),s("p",[a._v("返回值：string")]),a._v(" "),s("p",[a._v("说明：将字符串A中的子字符串B替换为C。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select replace('andanyoung', 'a', 'A');  Andanyoung\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-regexp-replace-正则替换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-regexp-replace-正则替换"}},[a._v("#")]),a._v(" 3）regexp_replace：正则替换")]),a._v(" "),s("p",[a._v("语法：regexp_replace(string A, string B, string C)")]),a._v(" "),s("p",[a._v("返回值：string")]),a._v(" "),s("p",[a._v("说明：将字符串A中的符合java正则表达式B的部分替换为C。注意，在有些情况下要使用转义字符。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ive> select regexp_replace('100-200', '(\\\\d+)', 'num');  num-num\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_4-regexp-正则匹配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-regexp-正则匹配"}},[a._v("#")]),a._v(" 4）regexp：正则匹配")]),a._v(" "),s("p",[a._v("语法：字符串 regexp 正则表达式")]),a._v(" "),s("p",[a._v("返回值：boolean\n说明：若字符串符合正则表达式，则返回true，否则返回false。")]),a._v(" "),s("p",[a._v("（1）正则匹配成功，输出true")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select 'dfsaaaa' regexp 'dfsa+'; true\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（2）正则匹配失败，输出false")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select 'dfsaaaa' regexp 'dfsb+';  false\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_5-repeat-重复字符串"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-repeat-重复字符串"}},[a._v("#")]),a._v(" 5）repeat：重复字符串")]),a._v(" "),s("p",[a._v("语法：repeat(string A, int n)\n返回值：string\n说明：将字符串A重复n遍。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select repeat('123', 3);  123123123\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h5",{attrs:{id:"_6-split-字符串切割"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-split-字符串切割"}},[a._v("#")]),a._v(" 6）split ：字符串切割")]),a._v(" "),s("p",[a._v("语法：split(string str, string pat)\n返回值：array\n说明：按照正则表达式pat匹配到的内容分割str，分割后的字符串，以数组的形式返回。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive> select split(\'a-b-c-d\',\'-\'); ["a","b","c","d"]\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_7-nvl-替换null值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-nvl-替换null值"}},[a._v("#")]),a._v(" 7）nvl ：替换null值")]),a._v(" "),s("p",[a._v("语法：nvl(A,B)\n说明：若A的值不为null，则返回A，否则返回B。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select nvl(null,1);  1\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_8-concat-拼接字符串"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-concat-拼接字符串"}},[a._v("#")]),a._v(" 8）concat ：拼接字符串")]),a._v(" "),s("p",[a._v("语法：concat(string A, string B, string C, ……)")]),a._v(" "),s("p",[a._v("返回：string")]),a._v(" "),s("p",[a._v("说明：将A,B,C……等字符拼接为一个字符串")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select concat('beijing','-','shanghai','-','shenzhen'); beijing-shanghai-shenzhen\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_9-concat-ws-以指定分隔符拼接字符串或者字符串数组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-concat-ws-以指定分隔符拼接字符串或者字符串数组"}},[a._v("#")]),a._v(" 9）concat_ws：以指定分隔符拼接字符串或者字符串数组")]),a._v(" "),s("p",[a._v("语法：concat_ws(string A, string…| array(string))")]),a._v(" "),s("p",[a._v("返回值：string")]),a._v(" "),s("p",[a._v("说明：使用分隔符A拼接多个字符串，或者一个数组的所有元素。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive>select concat_ws('-','beijing','shanghai','shenzhen');  beijing-shanghai-shenzhen\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select concat_ws('-',array('beijing','shenzhen','shanghai')); hive> beijing-shanghai-shenzhen\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_10-get-json-object-解析json字符串"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-get-json-object-解析json字符串"}},[a._v("#")]),a._v(" 10）get_json_object：解析json字符串")]),a._v(" "),s("p",[a._v("语法：get_json_object(string json_string, string path)\n返回值：string\n说明：解析json的字符串json_string，返回path指定的内容。如果输入的json字符串无效，那么返回NULL。")]),a._v(" "),s("p",[a._v("案例实操：")]),a._v(" "),s("p",[a._v("（1）获取json数组里面的json具体数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive> select get_json_object(\'[{"name":"大海海","sex":"男","age":"25"},{"name":"小宋宋","sex":"男","age":"47"}]\',\'$.[0].name\'); 大海海\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（2）获取json数组里面的数据")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive> select get_json_object(\'[{"name":"大海海","sex":"男","age":"25"},{"name":"小宋宋","sex":"男","age":"47"}]\',\'$.[0]\'); {"name":"大海海","sex":"男","age":"25"}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_8-2-4-日期函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-4-日期函数"}},[a._v("#")]),a._v(" 8.2.4 日期函数")]),a._v(" "),s("h4",{attrs:{id:"_1-unix-timestamp-返回当前或指定时间的时间戳"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-unix-timestamp-返回当前或指定时间的时间戳"}},[a._v("#")]),a._v(" 1）unix_timestamp：返回当前或指定时间的时间戳")]),a._v(" "),s("p",[a._v("语法：unix_timestamp()\n返回值：bigint\n案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select unix_timestamp('2022/08/08 08-08-08','yyyy/MM/dd HH-mm-ss');  1659946088\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("说明：-前面是日期后面是指，日期传进来的具体格式")]),a._v(" "),s("h4",{attrs:{id:"_2-from-unixtime-转化unix时间戳-从-1970-01-01-00-00-00-utc-到指定时间的秒数-到当前时区的时间格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-from-unixtime-转化unix时间戳-从-1970-01-01-00-00-00-utc-到指定时间的秒数-到当前时区的时间格式"}},[a._v("#")]),a._v(" 2）from_unixtime：转化UNIX时间戳（从 1970-01-01 00:00:00 UTC 到指定时间的秒数）到当前时区的时间格式")]),a._v(" "),s("p",[a._v("语法：from_unixtime(bigint unixtime[, string format])\n返回值：string\n案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select from_unixtime(1659946088);   2022-08-08 08:08:08\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-current-date-当前日期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-current-date-当前日期"}},[a._v("#")]),a._v(" 3）current_date：当前日期")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select current_date; 2022-07-11\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_4-current-timestamp-当前的日期加时间-并且精确的毫秒"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-current-timestamp-当前的日期加时间-并且精确的毫秒"}},[a._v("#")]),a._v(" 4）current_timestamp：当前的日期加时间，并且精确的毫秒")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select current_timestamp;    2022-07-11 15:32:22.402\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_5-month-获取日期中的月"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-month-获取日期中的月"}},[a._v("#")]),a._v(" 5）month：获取日期中的月")]),a._v(" "),s("p",[a._v("语法：month (string date)")]),a._v(" "),s("p",[a._v("返回值：int")]),a._v(" "),s("p",[a._v("案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select month('2022-08-08 08:08:08'); 8\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_6-day-获取日期中的日"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-day-获取日期中的日"}},[a._v("#")]),a._v(" 6）day：获取日期中的日")]),a._v(" "),s("p",[a._v("语法：day (string date)\n返回值：int\n案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select day('2022-08-08 08:08:08')    8\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_7-hour-获取日期中的小时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-hour-获取日期中的小时"}},[a._v("#")]),a._v(" 7）hour：获取日期中的小时")]),a._v(" "),s("p",[a._v("语法：hour (string date)")]),a._v(" "),s("p",[a._v("返回值：int")]),a._v(" "),s("p",[a._v("案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select hour('2022-08-08 08:08:08');   8\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_8-datediff-两个日期相差的天数-结束日期减去开始日期的天数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-datediff-两个日期相差的天数-结束日期减去开始日期的天数"}},[a._v("#")]),a._v(" 8）datediff：两个日期相差的天数（结束日期减去开始日期的天数）")]),a._v(" "),s("p",[a._v("语法：datediff(string enddate, string startdate)")]),a._v(" "),s("p",[a._v("返回值：int")]),a._v(" "),s("p",[a._v("案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select datediff('2021-08-08','2022-10-09');   -427\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_9-date-add-日期加天数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-date-add-日期加天数"}},[a._v("#")]),a._v(" 9）date_add：日期加天数")]),a._v(" "),s("p",[a._v("语法：date_add(string startdate, int days)\n返回值：string\n说明：返回开始日期 startdate 增加 days 天后的日期\n案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select date_add('2022-08-08',2);   2022-08-10\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_10-date-sub-日期减天数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-date-sub-日期减天数"}},[a._v("#")]),a._v(" 10）date_sub：日期减天数")]),a._v(" "),s("p",[a._v("语法：date_sub (string startdate, int days)\n返回值：string\n说明：返回开始日期startdate减少days天后的日期。\n案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select date_sub('2022-08-08',2);   2022-08-06 \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_11-date-format-将标准日期解析成指定格式字符串"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-date-format-将标准日期解析成指定格式字符串"}},[a._v("#")]),a._v(" 11）date_format:将标准日期解析成指定格式字符串")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select date_format('2022-08-08','yyyy年-MM月-dd日');   2022年-08月-08日\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_8-2-5-流程控制函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-5-流程控制函数"}},[a._v("#")]),a._v(" 8.2.5 流程控制函数")]),a._v(" "),s("h4",{attrs:{id:"_1-case-when-条件判断函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-case-when-条件判断函数"}},[a._v("#")]),a._v(" 1）case when：条件判断函数")]),a._v(" "),s("p",[a._v("语法一：case when a then b [when c then d]* [else e] end\n返回值：T\n说明：如果a为true，则返回b；如果c为true，则返回d；否则返回 e")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select case when 1=2 then 'tom' when 2=2 then 'mary' else 'tim' end from tabl eName; \nmary\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("语法二： case a when b then c [when d then e]* [else f] end\n返回值: T\n说明：如果a等于b，那么返回c；如果a等于d，那么返回e；否则返回f")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select case 100 when 50 then 'tom' when 100 then 'mary' else 'tim' end from t ableName; \nmary\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_2-if-条件判断-类似于java中三元运算符"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-if-条件判断-类似于java中三元运算符"}},[a._v("#")]),a._v(" 2）if: 条件判断，类似于Java中三元运算符")]),a._v(" "),s("p",[a._v("语法：if（boolean testCondition, T valueTrue, T valueFalseOrNull）\n返回值：T\n说明：当条件testCondition为true时，返回valueTrue；否则返回valueFalseOrNull")]),a._v(" "),s("p",[a._v("（1）条件满足，输出正确")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select if(10 > 5,'正确','错误')\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("输出：正确\n（2）条件满足，输出错误")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select if(10 < 5,'正确','错误');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("输出：错误")]),a._v(" "),s("h3",{attrs:{id:"_8-2-6-集合函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-6-集合函数"}},[a._v("#")]),a._v(" 8.2.6 集合函数")]),a._v(" "),s("h4",{attrs:{id:"_1-size-集合中元素的个数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-size-集合中元素的个数"}},[a._v("#")]),a._v(" 1）size：集合中元素的个数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select size(friends) from test;  --2/2  每一行数据中的friends集合里的个数\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-map-创建map集合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-map-创建map集合"}},[a._v("#")]),a._v(" 2）map：创建map集合")]),a._v(" "),s("p",[a._v("语法：map (key1, value1, key2, value2, …)\n说明：根据输入的key和value对构建map类型\n案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select map('xiaohai',1,'dahai',2);  \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("输出：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive> {"xiaohai":1,"dahai":2}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-map-keys-返回map中的key"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-map-keys-返回map中的key"}},[a._v("#")]),a._v(" 3）map_keys： 返回map中的key")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select map_keys(map('xiaohai',1,'dahai',2));\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("输出：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive>["xiaohai","dahai"]\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_4-map-values-返回map中的value"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-map-values-返回map中的value"}},[a._v("#")]),a._v(" 4）map_values: 返回map中的value")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select map_values(map('xiaohai',1,'dahai',2));\nhive>[1,2]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_5-array-声明array集合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-array-声明array集合"}},[a._v("#")]),a._v(" 5）array 声明array集合")]),a._v(" "),s("p",[a._v("语法：array(val1, val2, …)\n说明：根据输入的参数构建数组array类\n案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select array('1','2','3','4');\nhive>[\"1\",\"2\",\"3\",\"4\"]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_6-array-contains-判断array中是否包含某个元素"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-array-contains-判断array中是否包含某个元素"}},[a._v("#")]),a._v(" 6）array_contains: 判断array中是否包含某个元素")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select array_contains(array('a','b','c','d'),'a');\nhive> true\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_7-sort-array-将array中的元素排序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-sort-array-将array中的元素排序"}},[a._v("#")]),a._v(" 7）sort_array：将array中的元素排序")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select sort_array(array('a','d','c'));\nhive> [\"a\",\"c\",\"d\"]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_8-struct声明struct中的各属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-struct声明struct中的各属性"}},[a._v("#")]),a._v(" 8）struct声明struct中的各属性")]),a._v(" "),s("p",[a._v("语法：struct(val1, val2, val3, …)\n说明：根据输入的参数构建结构体struct类\n案例实操：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive> select struct(\'name\',\'age\',\'weight\');\nhive> {"col1":"name","col2":"age","col3":"weight"}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_9-named-struct声明struct的属性和值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-named-struct声明struct的属性和值"}},[a._v("#")]),a._v(" 9）named_struct声明struct的属性和值")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> select named_struct('name','xiaosong','age',18,'weight',80);\nhive> {\"name\":\"xiaosong\",\"age\":18,\"weight\":80}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_8-2-7-案例演示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-7-案例演示"}},[a._v("#")]),a._v(" 8.2.7 案例演示")]),a._v(" "),s("h4",{attrs:{id:"_1-数据准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-数据准备"}},[a._v("#")]),a._v(" 1.数据准备")]),a._v(" "),s("p",[s("strong",[a._v("1）表结构")])]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("name")]),a._v(" "),s("th",[a._v("sex")]),a._v(" "),s("th",[a._v("birthday")]),a._v(" "),s("th",[a._v("hiredate")]),a._v(" "),s("th",[a._v("job")]),a._v(" "),s("th",[a._v("salary")]),a._v(" "),s("th",[a._v("bonus")]),a._v(" "),s("th",[a._v("friends")]),a._v(" "),s("th",[a._v("children")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("张无忌")]),a._v(" "),s("td",[s("strong",[a._v("男")])]),a._v(" "),s("td",[a._v("1980/02/12")]),a._v(" "),s("td",[a._v("2022/08/09")]),a._v(" "),s("td",[a._v("销售")]),a._v(" "),s("td",[a._v("3000")]),a._v(" "),s("td",[a._v("12000")]),a._v(" "),s("td",[a._v("[阿朱，小昭]")]),a._v(" "),s("td",[a._v("{张小无:8,张小忌:9}")])]),a._v(" "),s("tr",[s("td",[a._v("赵敏")]),a._v(" "),s("td",[s("strong",[a._v("女")])]),a._v(" "),s("td",[a._v("1982/05/18")]),a._v(" "),s("td",[a._v("2022/09/10")]),a._v(" "),s("td",[a._v("行政")]),a._v(" "),s("td",[a._v("9000")]),a._v(" "),s("td",[a._v("2000")]),a._v(" "),s("td",[a._v("[阿三，阿四]")]),a._v(" "),s("td",[a._v("{赵小敏:8}")])]),a._v(" "),s("tr",[s("td",[a._v("黄蓉")]),a._v(" "),s("td",[s("strong",[a._v("女")])]),a._v(" "),s("td",[a._v("1982/04/13")]),a._v(" "),s("td",[a._v("2022/06/11")]),a._v(" "),s("td",[a._v("行政")]),a._v(" "),s("td",[a._v("12000")]),a._v(" "),s("td",[a._v("Null")]),a._v(" "),s("td",[a._v("[东邪，西毒]")]),a._v(" "),s("td",[a._v("{郭芙:5,郭襄:4}2）建表语句")])])])]),a._v(" "),s("p",[s("strong",[a._v("2）建表语句")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> \ncreate  table  employee(\n    name string,  --姓名\n    sex  string,  --性别\n    birthday string, --出生年月\n    hiredate string, --入职日期\n    job string,   --岗位\n    salary double, --薪资\n    bonus double,  --奖金\n    friends array<string>, --朋友\n    children map<string,int> --孩子\n)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[s("strong",[a._v("3）插入数据")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> insert into employee  \n  values('张无忌','男','1980/02/12','2022/08/09','销售',3000,12000,array('阿朱','小昭'),map('张小无',8,'张小忌',9)),\n        ('赵敏','女','1982/05/18','2022/09/10','行政',9000,2000,array('阿三','阿四'),map('赵小敏',8)),\n        ('宋青书','男','1981/03/15','2022/04/09','研发',18000,1000,array('王五','赵六'),map('宋小青',7,'宋小书',5)),\n        ('周芷若','女','1981/03/17','2022/04/10','研发',18000,1000,array('王五','赵六'),map('宋小青',7,'宋小书',5)),\n        ('郭靖','男','1985/03/11','2022/07/19','销售',2000,13000,array('南帝','北丐'),map('郭芙',5,'郭襄',4)),\n        ('黄蓉','女','1982/12/13','2022/06/11','行政',12000,null,array('东邪','西毒'),map('郭芙',5,'郭襄',4)),\n        ('杨过','男','1988/01/30','2022/08/13','前台',5000,null,array('郭靖','黄蓉'),map('杨小过',2)),\n        ('小龙女','女','1985/02/12','2022/09/24','前台',6000,null,array('张三','李四'),map('杨小过',2))\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h4",{attrs:{id:"_2-需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-需求"}},[a._v("#")]),a._v(" 2.需求")]),a._v(" "),s("p",[a._v("1）统计每个月的入职人数")]),a._v(" "),s("p",[s("strong",[a._v("（1）期望结果")])]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("month")]),a._v(" "),s("th",[a._v("cnt")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[a._v("4")])]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("6")])]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("7")])]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("8")])]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("9")])]),a._v(" "),s("td",[a._v("2")])])])]),a._v(" "),s("p",[s("strong",[a._v("（2）需求实现")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select\n  month(replace(hiredate,'/','-')) as month,\n  count(*) as cn\nfrom\n  employee\ngroup by\n  month(replace(hiredate,'/','-'))\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("2）查询每个人的年龄（年 + 月）")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("-- 转换日期\nselect\n  name,\n  replace(birthday,'/','-') birthday\nfrom\n  employee  t1\n\n-- 求出年和月\nselect\n  name,\n  year(current_date())-year(t1.birthday) year,\n  month(current_date())-month(t1.birthday) month\nfrom\n  (\n    select\n      name,\n      replace(birthday,'/','-') birthday\n    from\n      employee\n)t1 t2\n\n-- 根据月份正负决定年龄\n\nselect\n  name,\n  concat(if(month>=0,year,year-1),'年',if(month>=0,month,12+month),'月') age\nfrom\n  (\n    select\n      name,\n      year(current_date())-year(t1.birthday) year,\n      month(current_date())-month(t1.birthday) month\n    from\n      (\n        select\n          name,\n          replace(birthday,'/','-') birthday\n        from\n          employee\n    )t1\n)t2 \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br")])]),s("p",[a._v("3）按照薪资，奖金的和进行倒序排序，如果奖金为null，置位0")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select\n  name,\n  salary + nvl(bonus,0) sal\nfrom\n  employee\norder by\n   sal desc\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("4）查询每个人有多少个朋友")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select \nname,\nsize(friends) cnt\nfrom \nemployee; \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h2",{attrs:{id:"_8-3-高级聚合函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-高级聚合函数"}},[a._v("#")]),a._v(" 8.3 高级聚合函数")]),a._v(" "),s("p",[a._v("多进一出 （多行传入，一个行输出）。")]),a._v(" "),s("h4",{attrs:{id:"_1-普通聚合-count-sum-见第6章-6-2-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-普通聚合-count-sum-见第6章-6-2-4"}},[a._v("#")]),a._v(" 1）普通聚合 count/sum.... 见第6章 6.2.4")]),a._v(" "),s("h4",{attrs:{id:"_2-collect-list-收集并形成list集合-结果不去重"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-collect-list-收集并形成list集合-结果不去重"}},[a._v("#")]),a._v(" 2）collect_list 收集并形成list集合，结果不去重")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive>\nselect \n  sex,\n  collect_list(job)\nfrom\n  employee\ngroup by \n  sex\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("结果：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('女\t["行政","研发","行政","前台"]\n男\t["销售","研发","销售","前台"]\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_3-collect-set-收集并形成set集合-结果去重"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-collect-set-收集并形成set集合-结果去重"}},[a._v("#")]),a._v(" 3）collect_set 收集并形成set集合，结果去重")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive>\nselect \n  sex,\n  collect_set(job)\nfrom\n  employee\ngroup by \n  sex\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("结果：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('女\t["行政","研发","前台"]\n男\t["销售","研发","前台"]\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_8-3-1-案例演示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-1-案例演示"}},[a._v("#")]),a._v(" 8.3.1 案例演示")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive> \nselect\n  month(replace(hiredate,'/','-')) as month,\n  count(*) as cn,\n  Collect_list(name) as name_list\nfrom\n  employee\ngroup by\n  month(replace(hiredate,'/','-'));\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('month  cn  name_list\n4\t    2\t["宋青书","周芷若"]\n6\t    1\t["黄蓉"]\n7\t    1\t["郭靖"]\n8\t    2\t["张无忌","杨过"]\n9\t    2\t["赵敏","小龙女"]\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h2",{attrs:{id:"_8-4-炸裂函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-炸裂函数"}},[a._v("#")]),a._v(" 8.4 炸裂函数")]),a._v(" "),s("h3",{attrs:{id:"_8-4-1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-1-概述"}},[a._v("#")]),a._v(" 8.4.1 概述")]),a._v(" "),s("p",[s("img",{attrs:{src:t(1135),alt:"炸裂函数"}})]),a._v(" "),s("h3",{attrs:{id:"_8-4-2-案例演示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-2-案例演示"}},[a._v("#")]),a._v(" 8.4.2 案例演示")]),a._v(" "),s("h4",{attrs:{id:"_1-数据准备-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-数据准备-2"}},[a._v("#")]),a._v(" 1.数据准备")]),a._v(" "),s("p",[a._v("1）表结构")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[a._v("movie")])]),a._v(" "),s("th",[s("strong",[a._v("category")])])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("《疑犯追踪》")]),a._v(" "),s("td",[a._v("悬疑，动作，科幻，剧情")])]),a._v(" "),s("tr",[s("td",[a._v("《Lie to me》")]),a._v(" "),s("td",[a._v("悬疑，警匪，动作，心理，剧情")])]),a._v(" "),s("tr",[s("td",[a._v("《战狼2》")]),a._v(" "),s("td",[a._v("战争，动作，灾难")])])])]),a._v(" "),s("p",[a._v("2）建表语句")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive (default)>\ncreate table movie_info(\n    movie string,     --电影名称\n    category string   --电影分类\n) \nrow format delimited fields terminated by "\\t";\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("3）装载语句")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('insert overwrite table movie_info\nvalues ("《疑犯追踪》", "悬疑,动作,科幻,剧情"),\n       ("《Lie to me》", "悬疑,警匪,动作,心理,剧情"),\n       ("《战狼2》", "战争,动作,灾难");\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h4",{attrs:{id:"_2-需求-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-需求-2"}},[a._v("#")]),a._v(" 2. 需求")]),a._v(" "),s("p",[a._v("1）需求说明\n根据上述电影信息表，统计各分类的电影数量，期望结果如下：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("剧情")]),a._v(" "),s("th",[a._v("2")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("动作")]),a._v(" "),s("td",[a._v("3")])]),a._v(" "),s("tr",[s("td",[a._v("心理")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[a._v("悬疑")]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[a._v("战争")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[a._v("灾难")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[a._v("科幻")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[a._v("警匪")]),a._v(" "),s("td",[a._v("1")])])])]),a._v(" "),s("p",[s("strong",[a._v("2）答案")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select\n    cate,\n    count(*)\nfrom\n(\n    select\n        movie,\n        cate\n    from\n    (\n        select\n            movie,\n            split(category,',') cates\n        from movie_info\n    )t1 lateral view explode(cates) tmp as cate\n)t2\ngroup by cate;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br")])]),s("h2",{attrs:{id:"_8-5-窗口函数-开窗函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-窗口函数-开窗函数"}},[a._v("#")]),a._v(" 8.5 窗口函数（开窗函数）")]),a._v(" "),s("h3",{attrs:{id:"_8-5-1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-1-概述"}},[a._v("#")]),a._v(" 8.5.1 概述")]),a._v(" "),s("p",[s("img",{attrs:{src:t(1136),alt:"窗口函数"}})]),a._v(" "),s("h3",{attrs:{id:"_8-5-2-常用窗口函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-2-常用窗口函数"}},[a._v("#")]),a._v(" 8.5.2 常用窗口函数")]),a._v(" "),s("p",[a._v("按照功能，常用窗口可划分为如下几类：聚合函数、跨行取值函数、排名函数。")]),a._v(" "),s("h4",{attrs:{id:"_1-聚合函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-聚合函数"}},[a._v("#")]),a._v(" "),s("strong",[a._v("1）聚合函数")])]),a._v(" "),s("p",[a._v("max：最大值。\nmin：最小值。\nsum：求和。\navg：平均值。\ncount：计数。")]),a._v(" "),s("h4",{attrs:{id:"_2-跨行取值函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-跨行取值函数"}},[a._v("#")]),a._v(" "),s("strong",[a._v("2）跨行取值函数")])]),a._v(" "),s("h5",{attrs:{id:"_1-lead和lag"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-lead和lag"}},[a._v("#")]),a._v(" （1）lead和lag")]),a._v(" "),s("p",[s("img",{attrs:{src:t(1137),alt:"image-20231016231001486"}})]),a._v(" "),s("p",[a._v("注：lag和lead函数不支持自定义窗口。")]),a._v(" "),s("h5",{attrs:{id:"_2-first-value和last-value"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-first-value和last-value"}},[a._v("#")]),a._v(" （2）first_value和last_value")]),a._v(" "),s("p",[s("img",{attrs:{src:t(1138),alt:"first_value和last_value"}})]),a._v(" "),s("h3",{attrs:{id:"_3-排名函数-rank-、dense-rank、row-number"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-排名函数-rank-、dense-rank、row-number"}},[a._v("#")]),a._v(" 3）排名函数 rank 、dense_rank、row_number")]),a._v(" "),s("p",[s("img",{attrs:{src:t(1139),alt:"排名函数 rank 、dense_rank、row_number"}})]),a._v(" "),s("p",[a._v("注：rank 、dense_rank、row_number不支持自定义窗口。")]),a._v(" "),s("h3",{attrs:{id:"_8-5-3-案例演示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-3-案例演示"}},[a._v("#")]),a._v(" 8.5.3 案例演示")]),a._v(" "),s("h4",{attrs:{id:"_1-数据准备-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-数据准备-3"}},[a._v("#")]),a._v(" 1.数据准备")]),a._v(" "),s("h5",{attrs:{id:"_1-表结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-表结构"}},[a._v("#")]),a._v(" 1）表结构")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("order_id")]),a._v(" "),s("th",[a._v("user_id")]),a._v(" "),s("th",[a._v("user_name")]),a._v(" "),s("th",[a._v("order_date")]),a._v(" "),s("th",[a._v("order_amount")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[a._v("1")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("10")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("2")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("15")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("3")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-02-03")]),a._v(" "),s("td",[a._v("23")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("4")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-04")]),a._v(" "),s("td",[a._v("29")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("5")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-05")]),a._v(" "),s("td",[a._v("46")])])])]),a._v(" "),s("h5",{attrs:{id:"_2-建表语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-建表语句"}},[a._v("#")]),a._v(" 2）建表语句")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("create table order_info\n(\n    order_id     string, --订单id\n    user_id      string, -- 用户id\n    user_name    string, -- 用户姓名\n    order_date   string, -- 下单日期\n    order_amount int     -- 订单金额\n);\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("3）装载语句")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("insert overwrite table order_info\nvalues ('1', '1001', '小元', '2022-01-01', '10'),\n       ('2', '1002', '小海', '2022-01-02', '15'),\n       ('3', '1001', '小元', '2022-02-03', '23'),\n       ('4', '1002', '小海', '2022-01-04', '29'),\n       ('5', '1001', '小元', '2022-01-05', '46'),\n       ('6', '1001', '小元', '2022-04-06', '42'),\n       ('7', '1002', '小海', '2022-01-07', '50'),\n       ('8', '1001', '小元', '2022-01-08', '50'),\n       ('9', '1003', '小辉', '2022-04-08', '62'),\n       ('10', '1003', '小辉', '2022-04-09', '62'),\n       ('11', '1004', '小猛', '2022-05-10', '12'),\n       ('12', '1003', '小辉', '2022-04-11', '75'),\n       ('13', '1004', '小猛', '2022-06-12', '80'),\n       ('14', '1003', '小辉', '2022-04-13', '94');\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h4",{attrs:{id:"_2-需求-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-需求-3"}},[a._v("#")]),a._v(" 2. 需求")]),a._v(" "),s("h5",{attrs:{id:"_1-统计每个用户截至每次下单的累积下单总额"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-统计每个用户截至每次下单的累积下单总额"}},[a._v("#")]),a._v(" 1）统计每个用户截至每次下单的累积下单总额")]),a._v(" "),s("p",[a._v("（1）期望结果")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("order_id")]),a._v(" "),s("th",[a._v("user_id")]),a._v(" "),s("th",[a._v("user_name")]),a._v(" "),s("th",[a._v("order_date")]),a._v(" "),s("th",[a._v("order_amount")]),a._v(" "),s("th",[a._v("sum_so_far")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[a._v("1")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("10")]),a._v(" "),s("td",[a._v("10")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("5")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-05")]),a._v(" "),s("td",[a._v("46")]),a._v(" "),s("td",[a._v("56")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("8")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-08")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("106")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("3")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-02-03")]),a._v(" "),s("td",[a._v("23")]),a._v(" "),s("td",[a._v("129")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("6")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-04-06")]),a._v(" "),s("td",[a._v("42")]),a._v(" "),s("td",[a._v("171")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("2")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("15")]),a._v(" "),s("td",[a._v("15")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("4")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-04")]),a._v(" "),s("td",[a._v("29")]),a._v(" "),s("td",[a._v("44")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("7")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-07")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("94")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("9")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("62")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("10")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-09")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("124")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("12")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-11")]),a._v(" "),s("td",[a._v("75")]),a._v(" "),s("td",[a._v("199")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("14")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-13")]),a._v(" "),s("td",[a._v("94")]),a._v(" "),s("td",[a._v("293")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("11")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-05-10")]),a._v(" "),s("td",[a._v("12")]),a._v(" "),s("td",[a._v("12")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("13")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-06-12")]),a._v(" "),s("td",[a._v("80")]),a._v(" "),s("td",[a._v("92")])])])]),a._v(" "),s("p",[a._v("（2）需求实现")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select\n    order_id,\n    user_id,\n    user_name,\n    order_date,\n    order_amount,\n    sum(order_amount) over(partition by user_id order by order_date rows between unbounded preceding and current row) sum_so_far\nfrom order_info;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h4",{attrs:{id:"_2-统计每个用户截至每次下单的当月累积下单总额"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-统计每个用户截至每次下单的当月累积下单总额"}},[a._v("#")]),a._v(" 2）统计每个用户截至每次下单的当月累积下单总额")]),a._v(" "),s("p",[s("strong",[a._v("（1）期望结果")])]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("order_id")]),a._v(" "),s("th",[a._v("user_id")]),a._v(" "),s("th",[a._v("user_name")]),a._v(" "),s("th",[a._v("order_date")]),a._v(" "),s("th",[a._v("order_amount")]),a._v(" "),s("th",[a._v("sum_so_far")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[a._v("1")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("10")]),a._v(" "),s("td",[a._v("10")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("5")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-05")]),a._v(" "),s("td",[a._v("46")]),a._v(" "),s("td",[a._v("56")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("8")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-08")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("106")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("3")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-02-03")]),a._v(" "),s("td",[a._v("23")]),a._v(" "),s("td",[a._v("23")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("6")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-04-06")]),a._v(" "),s("td",[a._v("42")]),a._v(" "),s("td",[a._v("42")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("2")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("15")]),a._v(" "),s("td",[a._v("15")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("4")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-04")]),a._v(" "),s("td",[a._v("29")]),a._v(" "),s("td",[a._v("44")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("7")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-07")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("94")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("9")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("62")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("10")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-09")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("124")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("12")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-11")]),a._v(" "),s("td",[a._v("75")]),a._v(" "),s("td",[a._v("199")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("14")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-13")]),a._v(" "),s("td",[a._v("94")]),a._v(" "),s("td",[a._v("293")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("11")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-05-10")]),a._v(" "),s("td",[a._v("12")]),a._v(" "),s("td",[a._v("12")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("13")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-06-12")]),a._v(" "),s("td",[a._v("80")]),a._v(" "),s("td",[a._v("80")])])])]),a._v(" "),s("p",[s("strong",[a._v("（2）需求实现")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select\n    order_id,\n    user_id,\n    user_name,\n    order_date,\n    order_amount,\n    sum(order_amount) over(partition by user_id,substring(order_date,1,7) order by order_date rows between unbounded preceding and current row) sum_so_far\nfrom order_info;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h4",{attrs:{id:"_3-统计每个用户每次下单距离上次下单相隔的天数-首次下单按0天算"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-统计每个用户每次下单距离上次下单相隔的天数-首次下单按0天算"}},[a._v("#")]),a._v(" 3）统计每个用户每次下单距离上次下单相隔的天数（首次下单按0天算）")]),a._v(" "),s("p",[s("strong",[a._v("（1）期望结果")])]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("order_id")]),a._v(" "),s("th",[a._v("user_id")]),a._v(" "),s("th",[a._v("user_name")]),a._v(" "),s("th",[a._v("order_date")]),a._v(" "),s("th",[a._v("order_amount")]),a._v(" "),s("th",[a._v("diff")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[a._v("1")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("10")]),a._v(" "),s("td",[a._v("0")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("5")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-05")]),a._v(" "),s("td",[a._v("46")]),a._v(" "),s("td",[a._v("4")])]),a._v(" "),s("tr",[s("td",[a._v("------------")]),a._v(" "),s("td",[a._v("----")]),a._v(" "),s("td",[a._v("----")]),a._v(" "),s("td",[a._v("----------")]),a._v(" "),s("td",[a._v("----")]),a._v(" "),s("td",[a._v("----")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("8")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-08")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("3")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("3")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-02-03")]),a._v(" "),s("td",[a._v("23")]),a._v(" "),s("td",[a._v("26")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("6")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-04-06")]),a._v(" "),s("td",[a._v("42")]),a._v(" "),s("td",[a._v("62")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("2")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("15")]),a._v(" "),s("td",[a._v("0")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("4")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-04")]),a._v(" "),s("td",[a._v("29")]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("7")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-07")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("3")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("9")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("0")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("10")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-09")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("12")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-11")]),a._v(" "),s("td",[a._v("75")]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("14")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-13")]),a._v(" "),s("td",[a._v("94")]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("11")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-05-10")]),a._v(" "),s("td",[a._v("12")]),a._v(" "),s("td",[a._v("0")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("13")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-06-12")]),a._v(" "),s("td",[a._v("80")]),a._v(" "),s("td",[a._v("33")])])])]),a._v(" "),s("p",[s("strong",[a._v("（2）需求实现")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select\n    order_id,\n    user_id,\n    user_name,\n    order_date,\n    order_amount,\n    nvl(datediff(order_date,last_order_date),0) diff\nfrom\n(\n    select\n        order_id,\n        user_id,\n        user_name,\n        order_date,\n        order_amount,\n        lag(order_date,1,null) over(partition by user_id order by order_date) last_order_date\n    from order_info\n)t1\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br")])]),s("h4",{attrs:{id:"_4-查询所有下单记录以及每个用户的每个下单记录所在月份的首-末次下单日期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-查询所有下单记录以及每个用户的每个下单记录所在月份的首-末次下单日期"}},[a._v("#")]),a._v(" 4）查询所有下单记录以及每个用户的每个下单记录所在月份的首/末次下单日期")]),a._v(" "),s("p",[s("strong",[a._v("（1）期望结果")])]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("order_id")]),a._v(" "),s("th",[a._v("user_id")]),a._v(" "),s("th",[a._v("user_name")]),a._v(" "),s("th",[a._v("order_date")]),a._v(" "),s("th",[a._v("order_amount")]),a._v(" "),s("th",[a._v("first_date")]),a._v(" "),s("th",[a._v("last_date")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[a._v("1")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("10")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("2022-01-08")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("5")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-05")]),a._v(" "),s("td",[a._v("46")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("2022-01-08")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("8")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-08")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("2022-01-08")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("3")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-02-03")]),a._v(" "),s("td",[a._v("23")]),a._v(" "),s("td",[a._v("2022-02-03")]),a._v(" "),s("td",[a._v("2022-02-03")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("6")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-04-06")]),a._v(" "),s("td",[a._v("42")]),a._v(" "),s("td",[a._v("2022-04-06")]),a._v(" "),s("td",[a._v("2022-04-06")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("2")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("15")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("2022-01-07")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("4")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-04")]),a._v(" "),s("td",[a._v("29")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("2022-01-07")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("7")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-07")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("2022-01-07")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("9")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("2022-04-13")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("10")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-09")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("2022-04-13")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("12")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-11")]),a._v(" "),s("td",[a._v("75")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("2022-04-13")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("14")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-13")]),a._v(" "),s("td",[a._v("94")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("2022-04-13")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("11")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-05-10")]),a._v(" "),s("td",[a._v("12")]),a._v(" "),s("td",[a._v("2022-05-10")]),a._v(" "),s("td",[a._v("2022-05-10")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("13")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-06-12")]),a._v(" "),s("td",[a._v("80")]),a._v(" "),s("td",[a._v("2022-06-12")]),a._v(" "),s("td",[a._v("2022-06-12")])])])]),a._v(" "),s("p",[s("strong",[a._v("（2）需求实现")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select\n    order_id,\n    user_id,\n    user_name,\n    order_date,\n    order_amount,\n    first_value(order_date) over(partition by user_id,substring(order_date,1,7) order by order_date) first_date,\n    last_value(order_date) over(partition by user_id,substring(order_date,1,7) order by order_date rows between unbounded preceding and unbounded following) last_date\nfrom order_info;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h4",{attrs:{id:"_5-为每个用户的所有下单记录按照订单金额进行排名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-为每个用户的所有下单记录按照订单金额进行排名"}},[a._v("#")]),a._v(" 5）为每个用户的所有下单记录按照订单金额进行排名**")]),a._v(" "),s("p",[s("strong",[a._v("（1）期望结果")])]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("order_id")]),a._v(" "),s("th",[a._v("user_id")]),a._v(" "),s("th",[a._v("user_name")]),a._v(" "),s("th",[a._v("order_date")]),a._v(" "),s("th",[a._v("order_amount")]),a._v(" "),s("th",[a._v("rk")]),a._v(" "),s("th",[a._v("drk")]),a._v(" "),s("th",[a._v("rn")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[a._v("8")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-08")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("5")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-05")]),a._v(" "),s("td",[a._v("46")]),a._v(" "),s("td",[a._v("2")]),a._v(" "),s("td",[a._v("2")]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("6")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-04-06")]),a._v(" "),s("td",[a._v("42")]),a._v(" "),s("td",[a._v("3")]),a._v(" "),s("td",[a._v("3")]),a._v(" "),s("td",[a._v("3")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("3")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-02-03")]),a._v(" "),s("td",[a._v("23")]),a._v(" "),s("td",[a._v("4")]),a._v(" "),s("td",[a._v("4")]),a._v(" "),s("td",[a._v("4")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("1")])]),a._v(" "),s("td",[a._v("1001")]),a._v(" "),s("td",[a._v("小元")]),a._v(" "),s("td",[a._v("2022-01-01")]),a._v(" "),s("td",[a._v("10")]),a._v(" "),s("td",[a._v("5")]),a._v(" "),s("td",[a._v("5")]),a._v(" "),s("td",[a._v("5")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("7")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-07")]),a._v(" "),s("td",[a._v("50")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("4")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-04")]),a._v(" "),s("td",[a._v("29")]),a._v(" "),s("td",[a._v("2")]),a._v(" "),s("td",[a._v("2")]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("2")])]),a._v(" "),s("td",[a._v("1002")]),a._v(" "),s("td",[a._v("小海")]),a._v(" "),s("td",[a._v("2022-01-02")]),a._v(" "),s("td",[a._v("15")]),a._v(" "),s("td",[a._v("3")]),a._v(" "),s("td",[a._v("3")]),a._v(" "),s("td",[a._v("3")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("14")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-13")]),a._v(" "),s("td",[a._v("94")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("12")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-11")]),a._v(" "),s("td",[a._v("75")]),a._v(" "),s("td",[a._v("2")]),a._v(" "),s("td",[a._v("2")]),a._v(" "),s("td",[a._v("2")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("9")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-08")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("3")]),a._v(" "),s("td",[a._v("3")]),a._v(" "),s("td",[a._v("3")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("10")])]),a._v(" "),s("td",[a._v("1003")]),a._v(" "),s("td",[a._v("小辉")]),a._v(" "),s("td",[a._v("2022-04-09")]),a._v(" "),s("td",[a._v("62")]),a._v(" "),s("td",[a._v("3")]),a._v(" "),s("td",[a._v("3")]),a._v(" "),s("td",[a._v("4")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("13")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-06-12")]),a._v(" "),s("td",[a._v("80")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")])]),a._v(" "),s("tr",[s("td",[s("strong",[a._v("11")])]),a._v(" "),s("td",[a._v("1004")]),a._v(" "),s("td",[a._v("小猛")]),a._v(" "),s("td",[a._v("2022-05-10")]),a._v(" "),s("td",[a._v("12")]),a._v(" "),s("td",[a._v("2")]),a._v(" "),s("td",[a._v("2")]),a._v(" "),s("td",[a._v("2")])])])]),a._v(" "),s("p",[s("strong",[a._v("（2）需求实现")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("select\n    order_id,\n    user_id,\n    user_name,\n    order_date,\n    order_amount,\n    rank() over(partition by user_id order by order_amount desc) rk,\n    dense_rank() over(partition by user_id order by order_amount desc) drk,\n    row_number() over(partition by user_id order by order_amount desc) rn\nfrom order_info;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h3",{attrs:{id:"_8-6-自定义函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-自定义函数"}},[a._v("#")]),a._v(" 8.6 自定义函数")]),a._v(" "),s("p",[a._v("1）Hive自带了一些函数，比如：max/min等，但是数量有限，自己可以通过自定义UDF来方便的扩展。\n2）当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined function）。\n3）根据用户自定义函数类别分为以下三种：")]),a._v(" "),s("p",[a._v("（1）UDF（User-Defined-Function）\n一进一出。\n（2）UDAF（User-Defined Aggregation Function）\n用户自定义聚合函数，多进一出。\n类似于：count/max/min\n（3）UDTF（User-Defined Table-Generating Functions）\n用户自定义表生成函数，一进多出。\n如lateral view explode()")]),a._v(" "),s("p",[a._v("4）官方文档地址\nhttps://cwiki.apache.org/confluence/display/Hive/HivePlugins")]),a._v(" "),s("p",[a._v("5）编程步骤\n（1）继承Hive提供的类\n"),s("code",[a._v("org.apache.hadoop.hive.ql.udf.generic.GenericUDF")]),a._v(" "),s("code",[a._v("org.apache.hadoop.hive.ql.udf.generic.GenericUDTF;")]),a._v("\n（2）实现类中的抽象方法\n（3）在hive的命令行窗口创建函数")]),a._v(" "),s("p",[a._v("添加jar。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("add jar linux_jar_path\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("创建function。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("create [temporary] function [dbname.]function_name AS class_name;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（4）在hive的命令行窗口删除函数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("drop [temporary] function [if exists] [dbname.]function_name;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_8-7-自定义udf函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-7-自定义udf函数"}},[a._v("#")]),a._v(" 8.7 自定义UDF函数")]),a._v(" "),s("h4",{attrs:{id:"_0-需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-需求"}},[a._v("#")]),a._v(" 0）需求")]),a._v(" "),s("p",[a._v("自定义一个UDF实现计算给定基本数据类型的长度，例如：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive(default)> select my_len("abcd");\n4\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h4",{attrs:{id:"_1-创建一个maven工程hive"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建一个maven工程hive"}},[a._v("#")]),a._v(" 1）创建一个Maven工程Hive")]),a._v(" "),s("h4",{attrs:{id:"_2-导入依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入依赖"}},[a._v("#")]),a._v(" 2）导入依赖")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("<dependencies>\n\t<dependency>\n\t\t<groupId>org.apache.hive</groupId>\n\t\t<artifactId>hive-exec</artifactId>\n\t\t<version>3.1.3</version>\n\t</dependency>\n</dependencies>\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h4",{attrs:{id:"_3-创建一个类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建一个类"}},[a._v("#")]),a._v(" 3）创建一个类")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('import org.apache.hadoop.hive.ql.exec.UDFArgumentException;\nimport org.apache.hadoop.hive.ql.exec.UDFArgumentLengthException;\nimport org.apache.hadoop.hive.ql.exec.UDFArgumentTypeException;\nimport org.apache.hadoop.hive.ql.metadata.HiveException;\nimport org.apache.hadoop.hive.ql.udf.generic.GenericUDF;\nimport org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;\nimport org.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectInspectorFactory;\n\n/**\n * 我们需计算一个要给定基本数据类型的长度\n */\npublic class MyUDF extends GenericUDF {\n    /**\n     * 判断传进来的参数的类型和长度\n     * 约定返回的数据类型\n     */\n    @Override\n    public ObjectInspector initialize(ObjectInspector[] arguments) throws UDFArgumentException {\n\n        if (arguments.length !=1) {\n            throw  new UDFArgumentLengthException("please give me  only one arg");\n        }\n\n        if (!arguments[0].getCategory().equals(ObjectInspector.Category.PRIMITIVE)){\n            throw  new UDFArgumentTypeException(1, "i need primitive type arg");\n        }\n\n        return PrimitiveObjectInspectorFactory.javaIntObjectInspector;\n    }\n\n    /**\n     * 解决具体逻辑的\n     */\n    @Override\n    public Object evaluate(DeferredObject[] arguments) throws HiveException {\n\n        Object o = arguments[0].get();\n        if(o==null){\n            return 0;\n        }\n\n        return o.toString().length();\n    }\n\n    @Override\n    // 用于获取解释的字符串\n    public String getDisplayString(String[] children) {\n        return "";\n    }\n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br")])]),s("h4",{attrs:{id:"_4-创建临时函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建临时函数"}},[a._v("#")]),a._v(" 4）创建临时函数")]),a._v(" "),s("p",[a._v("（1）打成jar包上传到服务器/opt/module/hive/datas/myudf.jar")]),a._v(" "),s("p",[a._v("（2）将jar包添加到hive的classpath，临时生效")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> add jar /opt/module/hive/datas/myudf.jar;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("（3）创建临时函数与开发好的java class关联")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive (default)> \ncreate temporary function my_len \nas "com.atguigu.hive.udf.MyUDF";\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("（4）即可在hql中使用自定义的临时函数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    ename,\n    my_len(ename) ename_len \nfrom emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("（5）删除临时函数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> drop temporary function my_len;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("blockquote",[s("p",[a._v("注意：临时函数只跟会话有关系，跟库没有关系。只要创建临时函数的会话不断，在当前会话下，任意一个库都可以使用，其他会话全都不能使用。")])]),a._v(" "),s("h4",{attrs:{id:"_5-创建永久函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建永久函数"}},[a._v("#")]),a._v(" 5）创建永久函数")]),a._v(" "),s("p",[a._v("（1）创建永久函数")]),a._v(" "),s("blockquote",[s("p",[a._v("注意：因为add jar本身也是临时生效，所以在创建永久函数的时候，需要制定路径（并且因为元数据的原因，这个路径还得是HDFS上的路径）。")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('hive (default)> \ncreate function my_len2 \nas "com.atguigu.hive.udf.MyUDF" \nusing jar "hdfs://hadoop102:8020/udf/myudf.jar";\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("（2）即可在hql中使用自定义的永久函数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> \nselect \n    ename,\n    my_len2(ename) ename_len \nfrom emp;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("（3）删除永久函数")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("hive (default)> drop function my_len2;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("blockquote",[s("p",[a._v("注意：永久函数跟会话没有关系，创建函数的会话断了以后，其他会话也可以使用。")]),a._v(" "),s("p",[a._v("永久函数创建的时候，在函数名之前需要自己加上库名，如果不指定库名的话，会默认把当前库的库名给加上")])]),a._v(" "),s("p",[a._v("永久函数使用的时候，需要在指定的库里面操作，或者在其他库里面使用的话加上**，库名.函数名。**")])])}),[],!1,null,null,null);s.default=n.exports}}]);