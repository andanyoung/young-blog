(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{1092:function(a,e,s){"use strict";s.r(e);var n=s(4),r=Object(n.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"hadoop-ha-高可用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hadoop-ha-高可用"}},[a._v("#")]),a._v(" Hadoop HA 高可用")]),a._v(" "),e("blockquote",[e("p",[a._v("参考["),e("a",{attrs:{href:"https://hadoop.apache.org/docs/r3.3.6/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("NameNode HA With QJM"),e("OutboundLink")],1),a._v("]")]),a._v(" "),e("p",[a._v("NFS 方式 ["),e("a",{attrs:{href:"https://hadoop.apache.org/docs/r3.3.6/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithNFS.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("NFS的命名节点HA"),e("OutboundLink")],1),a._v("]")])]),a._v(" "),e("h2",{attrs:{id:"_1-ha-概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-ha-概述"}},[a._v("#")]),a._v(" 1. HA 概述")]),a._v(" "),e("p",[a._v("（1）所谓 HA（High Availablity），即高可用（7*24 小时不中断服务）。")]),a._v(" "),e("p",[a._v("（2）实现高可用最关键的策略是消除单点故障。HA 严格来说应该分成各个组件的 HA 机制：HDFS 的 HA 和 YARN 的 HA。")]),a._v(" "),e("p",[a._v("（3）NameNode 主要在以下两个方面影响 HDFS 集群")]),a._v(" "),e("p",[a._v("➢ NameNode 机器发生意外，如宕机，集群将无法使用，直到管理员重启")]),a._v(" "),e("p",[a._v("➢ NameNode 机器需要升级，包括软件、硬件升级，此时集群也将无法使用")]),a._v(" "),e("p",[a._v("HDFS HA 功能通过配置多个 NameNodes(Active/Standby)实现在集群中对 NameNode 的热备来解决上述问题。如果出现故障，如机器崩溃或机器需要升级维护，这时可通过此种方式将 NameNode 很快的切换到另外一台机器。")]),a._v(" "),e("h2",{attrs:{id:"_2-hdfs-ha-集群搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-hdfs-ha-集群搭建"}},[a._v("#")]),a._v(" 2.  HDFS-HA 集群搭建")]),a._v(" "),e("p",[a._v("当前 HDFS 集群的规划")]),a._v(" "),e("p",[e("img",{attrs:{src:s(488),alt:"image-20230905153634847"}})]),a._v(" "),e("p",[a._v("HA 的主要目的是消除 namenode 的单点故障,需要将 hdfs 集群规划成以下模样")]),a._v(" "),e("p",[e("img",{attrs:{src:s(489),alt:"image-20230905153657185"}})]),a._v(" "),e("h3",{attrs:{id:"_2-1-hdfs-ha-核心问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-hdfs-ha-核心问题"}},[a._v("#")]),a._v(" 2.1 HDFS-HA 核心问题")]),a._v(" "),e("p",[a._v("1）怎么保证三台 namenode 的数据一致")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("a. Fsimage:让一台 nn 生成数据,让其他机器 nn 同步")])]),a._v(" "),e("li",[e("p",[a._v("b. Edits:需要引进新的模块 JournalNode 来保证 edtis 的文件的数据一致性")])])]),a._v(" "),e("p",[a._v("2）怎么让同时只有一台 nn 是 active，其他所有是 standby 的")]),a._v(" "),e("ul",[e("li",[a._v("a.手动分配")]),a._v(" "),e("li",[a._v("b.自动分配")])]),a._v(" "),e("p",[a._v("3）2nn 在 ha 架构中并不存在，定期合并 fsimage 和 edtis 的活谁来")]),a._v(" "),e("ul",[e("li",[a._v("由 standby 的 nn 来干")])]),a._v(" "),e("p",[a._v("4）如果 nn 真的发生了问题，怎么让其他的 nn 上位干活")]),a._v(" "),e("ul",[e("li",[a._v("a.手动故障转移")]),a._v(" "),e("li",[a._v("b.自动故障转移")])]),a._v(" "),e("h2",{attrs:{id:"_3-hdfs-ha-手动模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-hdfs-ha-手动模式"}},[a._v("#")]),a._v(" 3 HDFS-HA 手动模式")]),a._v(" "),e("h3",{attrs:{id:"_3-1-环境准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-环境准备"}},[a._v("#")]),a._v(" 3.1 环境准备")]),a._v(" "),e("p",[a._v("（1）修改 IP")]),a._v(" "),e("p",[a._v("（2）修改主机名及主机名和 IP 地址的映射")]),a._v(" "),e("p",[a._v("（3）关闭防火墙")]),a._v(" "),e("p",[a._v("（4）ssh 免密登录")]),a._v(" "),e("p",[a._v("（5）安装 JDK，配置环境变量等")]),a._v(" "),e("h3",{attrs:{id:"_3-2-规划集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-规划集群"}},[a._v("#")]),a._v(" 3.2 规划集群")]),a._v(" "),e("p",[e("img",{attrs:{src:s(490),alt:"image-20230905153935080"}})]),a._v(" "),e("h3",{attrs:{id:"_3-3-配置-hdfs-ha-集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-配置-hdfs-ha-集群"}},[a._v("#")]),a._v(" 3.3 配置 HDFS-HA 集群")]),a._v(" "),e("p",[a._v("1）官方地址：http://hadoop.apache.org/")]),a._v(" "),e("p",[a._v("2）在 opt 目录下创建一个 ha 文件夹")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ cd /opt\n[atguigu@hadoop102 opt]$ sudo mkdir ha\n[atguigu@hadoop102 opt]$ sudo chown atguigu:atguigu /opt/ha\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("3）将/opt/module/下的 hadoop-3.1.3 拷贝到/opt/ha 目录下（记得删除 data 和 log 目录）")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 opt]$ cp -r /opt/module/hadoop-3.1.3 /opt/ha/\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("4）配置 core-site.xml")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("<configuration>\n    \x3c!-- 把多个 NameNode 的地址组装成一个集群 mycluster --\x3e\n     <property>\n         <name>fs.defaultFS</name>\n         <value>hdfs://mycluster</value>\n     </property>\n    \x3c!-- 指定 hadoop 运行时产生文件的存储目录 --\x3e\n     <property>\n         <name>hadoop.tmp.dir</name>\n         <value>/opt/ha/hadoop-3.1.3/data</value>\n     </property>\n</configuration>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br")])]),e("p",[a._v("5）配置 hdfs-site.xml")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("<configuration>\n    \x3c!-- NameNode 数据存储目录 --\x3e\n     <property>\n         <name>dfs.namenode.name.dir</name>\n         <value>file://${hadoop.tmp.dir}/name</value>\n     </property>\n    \x3c!-- DataNode 数据存储目录 --\x3e\n     <property>\n         <name>dfs.datanode.data.dir</name>\n         <value>file://${hadoop.tmp.dir}/data</value>\n     </property>\n    \x3c!-- JournalNode 数据存储目录 --\x3e\n     <property>\n         <name>dfs.journalnode.edits.dir</name>\n         <value>${hadoop.tmp.dir}/jn</value>\n     </property>\n    \x3c!-- 完全分布式集群名称 --\x3e\n     <property>\n         <name>dfs.nameservices</name>\n         <value>mycluster</value>\n     </property>\n    \x3c!-- 集群中 NameNode 节点都有哪些 --\x3e\n     <property>\n         <name>dfs.ha.namenodes.mycluster</name>\n         <value>nn1,nn2,nn3</value>\n     </property>\n    \x3c!-- NameNode 的 RPC 通信地址 --\x3e\n     <property>\n         <name>dfs.namenode.rpc-address.mycluster.nn1</name>\n         <value>hadoop102:8020</value>\n     </property>\n     <property>\n         <name>dfs.namenode.rpc-address.mycluster.nn2</name>\n         <value>hadoop103:8020</value>\n     </property>\n     <property>\n         <name>dfs.namenode.rpc-address.mycluster.nn3</name>\n         <value>hadoop104:8020</value>\n     </property>\n    \x3c!-- NameNode 的 http 通信地址 --\x3e\n     <property>\n         <name>dfs.namenode.http-address.mycluster.nn1</name>\n         <value>hadoop102:9870</value>\n     </property>\n     <property>\n         <name>dfs.namenode.http-address.mycluster.nn2</name>\n         <value>hadoop103:9870</value>\n     </property>\n     <property>\n         <name>dfs.namenode.http-address.mycluster.nn3</name>\n         <value>hadoop104:9870</value>\n     </property>\n    \x3c!-- 指定 NameNode 元数据在 JournalNode 上的存放位置 --\x3e\n     <property>\n        <name>dfs.namenode.shared.edits.dir</name>\n        <value>qjournal://hadoop102:8485;hadoop103:8485;hadoop104:8485/myclus\n    \tter</value>\n     </property>\n    \x3c!-- 访问代理类：client 用于确定哪个 NameNode 为 Active --\x3e\n     <property>\n         <name>dfs.client.failover.proxy.provider.mycluster</name>\n         <value>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider</value>\n     </property>\n    \x3c!-- 配置隔离机制，即同一时刻只能有一台服务器对外响应 --\x3e\n     <property>\n         <name>dfs.ha.fencing.methods</name>\n         <value>sshfence</value>\n     </property>\n    \x3c!-- 使用隔离机制时需要 ssh 秘钥登录--\x3e\n     <property>\n         <name>dfs.ha.fencing.ssh.private-key-files</name>\n         <value>/home/atguigu/.ssh/id_rsa</value>\n     </property>\n</configuration>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br"),e("span",{staticClass:"line-number"},[a._v("26")]),e("br"),e("span",{staticClass:"line-number"},[a._v("27")]),e("br"),e("span",{staticClass:"line-number"},[a._v("28")]),e("br"),e("span",{staticClass:"line-number"},[a._v("29")]),e("br"),e("span",{staticClass:"line-number"},[a._v("30")]),e("br"),e("span",{staticClass:"line-number"},[a._v("31")]),e("br"),e("span",{staticClass:"line-number"},[a._v("32")]),e("br"),e("span",{staticClass:"line-number"},[a._v("33")]),e("br"),e("span",{staticClass:"line-number"},[a._v("34")]),e("br"),e("span",{staticClass:"line-number"},[a._v("35")]),e("br"),e("span",{staticClass:"line-number"},[a._v("36")]),e("br"),e("span",{staticClass:"line-number"},[a._v("37")]),e("br"),e("span",{staticClass:"line-number"},[a._v("38")]),e("br"),e("span",{staticClass:"line-number"},[a._v("39")]),e("br"),e("span",{staticClass:"line-number"},[a._v("40")]),e("br"),e("span",{staticClass:"line-number"},[a._v("41")]),e("br"),e("span",{staticClass:"line-number"},[a._v("42")]),e("br"),e("span",{staticClass:"line-number"},[a._v("43")]),e("br"),e("span",{staticClass:"line-number"},[a._v("44")]),e("br"),e("span",{staticClass:"line-number"},[a._v("45")]),e("br"),e("span",{staticClass:"line-number"},[a._v("46")]),e("br"),e("span",{staticClass:"line-number"},[a._v("47")]),e("br"),e("span",{staticClass:"line-number"},[a._v("48")]),e("br"),e("span",{staticClass:"line-number"},[a._v("49")]),e("br"),e("span",{staticClass:"line-number"},[a._v("50")]),e("br"),e("span",{staticClass:"line-number"},[a._v("51")]),e("br"),e("span",{staticClass:"line-number"},[a._v("52")]),e("br"),e("span",{staticClass:"line-number"},[a._v("53")]),e("br"),e("span",{staticClass:"line-number"},[a._v("54")]),e("br"),e("span",{staticClass:"line-number"},[a._v("55")]),e("br"),e("span",{staticClass:"line-number"},[a._v("56")]),e("br"),e("span",{staticClass:"line-number"},[a._v("57")]),e("br"),e("span",{staticClass:"line-number"},[a._v("58")]),e("br"),e("span",{staticClass:"line-number"},[a._v("59")]),e("br"),e("span",{staticClass:"line-number"},[a._v("60")]),e("br"),e("span",{staticClass:"line-number"},[a._v("61")]),e("br"),e("span",{staticClass:"line-number"},[a._v("62")]),e("br"),e("span",{staticClass:"line-number"},[a._v("63")]),e("br"),e("span",{staticClass:"line-number"},[a._v("64")]),e("br"),e("span",{staticClass:"line-number"},[a._v("65")]),e("br"),e("span",{staticClass:"line-number"},[a._v("66")]),e("br"),e("span",{staticClass:"line-number"},[a._v("67")]),e("br"),e("span",{staticClass:"line-number"},[a._v("68")]),e("br"),e("span",{staticClass:"line-number"},[a._v("69")]),e("br"),e("span",{staticClass:"line-number"},[a._v("70")]),e("br"),e("span",{staticClass:"line-number"},[a._v("71")]),e("br"),e("span",{staticClass:"line-number"},[a._v("72")]),e("br"),e("span",{staticClass:"line-number"},[a._v("73")]),e("br"),e("span",{staticClass:"line-number"},[a._v("74")]),e("br")])]),e("p",[a._v("6）分发配置好的 hadoop 环境到其他节点")]),a._v(" "),e("h3",{attrs:{id:"_3-4-启动-hdfs-ha-集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-启动-hdfs-ha-集群"}},[a._v("#")]),a._v(" 3.4 启动 HDFS-HA 集群")]),a._v(" "),e("p",[e("strong",[a._v("1）将 HADOOP_HOME 环境变量更改到 HA 目录(三台机器)")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ sudo vim /etc/profile.d/my_env.sh\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("将 HADOOP_HOME 部分改为如下")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("#HADOOP_HOME\nexport HADOOP_HOME=/opt/ha/hadoop-3.1.3\nexport PATH=$PATH:$HADOOP_HOME/bin\nexport PATH=$PATH:$HADOOP_HOME/sbin\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("去三台机器上 source 环境变量")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("atguigu@hadoop102 ~]$source /etc/profile\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("2）在各个 JournalNode 节点上，输入以下命令启动 journalnode 服务")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ hdfs --daemon start journalnode\n[atguigu@hadoop103 ~]$ hdfs --daemon start journalnode\n[atguigu@hadoop104 ~]$ hdfs --daemon start journalnode\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("3）在[nn1]上，对其进行格式化，并启动")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ hdfs namenode -format\n[atguigu@hadoop102 ~]$ hdfs --daemon start namenode\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("4）在[nn2]和[nn3]上，同步 nn1 的元数据信息")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop103 ~]$ hdfs namenode -bootstrapStandby\n[atguigu@hadoop104 ~]$ hdfs namenode -bootstrapStandby\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("5）启动[nn2]和[nn3]")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop103 ~]$ hdfs --daemon start namenode\n[atguigu@hadoop104 ~]$ hdfs --daemon start namenode\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("6）查看 web 页面显示")]),a._v(" "),e("p",[e("img",{attrs:{src:s(491),alt:"图 hadoop102(standby)"}})]),a._v(" "),e("p",[e("img",{attrs:{src:s(492),alt:"image-20230905154713712"}})]),a._v(" "),e("p",[e("img",{attrs:{src:s(493),alt:"image-20230905154723872"}})]),a._v(" "),e("p",[a._v("7）在所有节点上，启动 datanode")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ hdfs --daemon start datanode\n[atguigu@hadoop103 ~]$ hdfs --daemon start datanode\n[atguigu@hadoop104 ~]$ hdfs --daemon start datanode\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("8）将[nn1]切换为 Active")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ hdfs haadmin -transitionToActive nn1\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("9）查看是否 Active")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ hdfs haadmin -getServiceState nn1\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-hdfs-ha-自动模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-hdfs-ha-自动模式"}},[a._v("#")]),a._v(" 4 HDFS-HA 自动模式")]),a._v(" "),e("h3",{attrs:{id:"_4-1-hdfs-ha-自动故障转移工作机制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-hdfs-ha-自动故障转移工作机制"}},[a._v("#")]),a._v(" 4.1 HDFS-HA 自动故障转移工作机制")]),a._v(" "),e("p",[a._v("自动故障转移为 HDFS 部署增加了两个新组件：ZooKeeper 和 ZKFailoverController （ZKFC）进程，如图所示。ZooKeeper 是维护少量协调数据，通知客户端这些数据的改变 和监视客户端故障的高可用服务。")]),a._v(" "),e("p",[e("img",{attrs:{src:s(494),alt:"image-20230905154926719"}})]),a._v(" "),e("h3",{attrs:{id:"_4-2-hdfs-ha-自动故障转移的集群规划"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-hdfs-ha-自动故障转移的集群规划"}},[a._v("#")]),a._v(" 4.2 HDFS-HA 自动故障转移的集群规划")]),a._v(" "),e("p",[e("img",{attrs:{src:s(495),alt:"image-20230905155156458"}})]),a._v(" "),e("h3",{attrs:{id:"_4-3-配置-hdfs-ha-自动故障转移"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-配置-hdfs-ha-自动故障转移"}},[a._v("#")]),a._v(" 4.3 配置 HDFS-HA 自动故障转移")]),a._v(" "),e("h4",{attrs:{id:"_1-具体配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-具体配置"}},[a._v("#")]),a._v(" 1）具体配置")]),a._v(" "),e("p",[a._v("（1）在 hdfs-site.xml 中增加")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\x3c!-- 启用 nn 故障自动转移 --\x3e\n<property>\n    <name>dfs.ha.automatic-failover.enabled</name>\n    <value>true</value>\n</property>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[a._v("（2）在 core-site.xml 文件中增加")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\x3c!-- 指定 zkfc 要连接的 zkServer 地址 --\x3e\n<property>\n    <name>ha.zookeeper.quorum</name>\n    <value>hadoop102:2181,hadoop103:2181,hadoop104:2181</value>\n</property>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[a._v("（3）修改后分发配置文件")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 etc]$ pwd\n/opt/ha/hadoop-3.1.3/etc\n[atguigu@hadoop102 etc]$ xsync hadoop/\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("h4",{attrs:{id:"_2-启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动"}},[a._v("#")]),a._v(" 2）启动")]),a._v(" "),e("p",[a._v("（1）关闭所有 HDFS 服务：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ stop-dfs.sh\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("（2）启动 Zookeeper 集群：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ zkServer.sh start\n[atguigu@hadoop103 ~]$ zkServer.sh start\n[atguigu@hadoop104 ~]$ zkServer.sh start\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("（3）启动 Zookeeper 以后，然后再初始化 HA 在 Zookeeper 中状态：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ hdfs zkfc -formatZK\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("（4）启动 HDFS 服务：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ start-dfs.sh\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("（5）可以去 zkCli.sh 客户端查看 Namenode 选举锁节点内容：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[zk: localhost:2181(CONNECTED) 7] get -s \n/hadoop-ha/mycluster/ActiveStandbyElectorLock\n\t\n\tmyclusternn2 hadoop103 �>(�>\ncZxid = 0x10000000b\nctime = Tue Jul 14 17:00:13 CST 2020\nmZxid = 0x10000000b\nmtime = Tue Jul 14 17:00:13 CST 2020\npZxid = 0x10000000b\ncversion = 0\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x40000da2eb70000\ndataLength = 33\nnumChildren = 0\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br")])]),e("h4",{attrs:{id:"_3-验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-验证"}},[a._v("#")]),a._v(" 3）验证")]),a._v(" "),e("p",[a._v("4.3 解决 NN 连接不上 JN 的问题")]),a._v(" "),e("p",[a._v("自动故障转移配置好以后，然后使用 start-dfs.sh 群起脚本启动 hdfs 集群，有可能会遇到 NameNode 起来一会后，进程自动关闭的问题。查看 NameNode 日志，报错信息如下：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("2020-08-17 10:11:40,658 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 0 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:40,659 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 0 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:40,659 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 0 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:41,660 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 1 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:41,660 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 1 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:41,665 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 1 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:42,661 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 2 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:42,661 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 2 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:42,667 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 2 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:43,662 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 3 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:43,662 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 3 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:43,668 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 3 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:44,663 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 4 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:44,663 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 4 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:44,670 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 4 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:45,467 INFO \norg.apache.hadoop.hdfs.qjournal.client.QuorumJournalManager: Waited 6001 \nms (timeout=20000 ms) for a response for selectStreamingInputStreams. No \nresponses yet.\n2020-08-17 10:11:45,664 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 5 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:45,664 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 5 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:45,672 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 5 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:46,469 INFO \norg.apache.hadoop.hdfs.qjournal.client.QuorumJournalManager: Waited 7003 \nms (timeout=20000 ms) for a response for selectStreamingInputStreams. No \nresponses yet.\n2020-08-17 10:11:46,665 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 6 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:46,665 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 6 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:46,673 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 6 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:47,470 INFO \norg.apache.hadoop.hdfs.qjournal.client.QuorumJournalManager: Waited 8004 \nms (timeout=20000 ms) for a response for selectStreamingInputStreams. No \nresponses yet.\n2020-08-17 10:11:47,666 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 7 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:47,667 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 7 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:47,674 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 7 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:48,471 INFO \norg.apache.hadoop.hdfs.qjournal.client.QuorumJournalManager: Waited 9005 \nms (timeout=20000 ms) for a response for selectStreamingInputStreams. No \nresponses yet.\n2020-08-17 10:11:48,668 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 8 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:48,668 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 8 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:48,675 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 8 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:49,669 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop102/192.168.6.102:8485. Already tried 9 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:49,673 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop104/192.168.6.104:8485. Already tried 9 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:49,676 INFO org.apache.hadoop.ipc.Client: Retrying connect \nto server: hadoop103/192.168.6.103:8485. Already tried 9 time(s); retry \npolicy is RetryUpToMaximumCountWithFixedSleep(maxRetries=10, \nsleepTime=1000 MILLISECONDS)\n2020-08-17 10:11:49,678 WARN \norg.apache.hadoop.hdfs.server.namenode.FSEditLog: Unable to determine input \nstreams from QJM to [192.168.6.102:8485, 192.168.6.103:8485, \n192.168.6.104:8485]. Skipping.\norg.apache.hadoop.hdfs.qjournal.client.QuorumException: Got too many \nexceptions to achieve quorum size 2/3. 3 exceptions thrown:\n192.168.6.103:8485: Call From hadoop102/192.168.6.102 to hadoop103:8485 \nfailed on connection exception: java.net.ConnectException: 拒绝连接; For more \ndetails see: http://wiki.apache.org/hadoop/ConnectionRefused\n192.168.6.102:8485: Call From hadoop102/192.168.6.102 to hadoop102:8485 \nfailed on connection exception: java.net.ConnectException: 拒绝连接; For more \ndetails see: http://wiki.apache.org/hadoop/ConnectionRefused\n192.168.6.104:8485: Call From hadoop102/192.168.6.102 to hadoop104:8485 \nfailed on connection exception: java.net.ConnectException: 拒绝连接; For more \ndetails see: http://wiki.apache.org/hadoop/ConnectionRefused\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br"),e("span",{staticClass:"line-number"},[a._v("26")]),e("br"),e("span",{staticClass:"line-number"},[a._v("27")]),e("br"),e("span",{staticClass:"line-number"},[a._v("28")]),e("br"),e("span",{staticClass:"line-number"},[a._v("29")]),e("br"),e("span",{staticClass:"line-number"},[a._v("30")]),e("br"),e("span",{staticClass:"line-number"},[a._v("31")]),e("br"),e("span",{staticClass:"line-number"},[a._v("32")]),e("br"),e("span",{staticClass:"line-number"},[a._v("33")]),e("br"),e("span",{staticClass:"line-number"},[a._v("34")]),e("br"),e("span",{staticClass:"line-number"},[a._v("35")]),e("br"),e("span",{staticClass:"line-number"},[a._v("36")]),e("br"),e("span",{staticClass:"line-number"},[a._v("37")]),e("br"),e("span",{staticClass:"line-number"},[a._v("38")]),e("br"),e("span",{staticClass:"line-number"},[a._v("39")]),e("br"),e("span",{staticClass:"line-number"},[a._v("40")]),e("br"),e("span",{staticClass:"line-number"},[a._v("41")]),e("br"),e("span",{staticClass:"line-number"},[a._v("42")]),e("br"),e("span",{staticClass:"line-number"},[a._v("43")]),e("br"),e("span",{staticClass:"line-number"},[a._v("44")]),e("br"),e("span",{staticClass:"line-number"},[a._v("45")]),e("br"),e("span",{staticClass:"line-number"},[a._v("46")]),e("br"),e("span",{staticClass:"line-number"},[a._v("47")]),e("br"),e("span",{staticClass:"line-number"},[a._v("48")]),e("br"),e("span",{staticClass:"line-number"},[a._v("49")]),e("br"),e("span",{staticClass:"line-number"},[a._v("50")]),e("br"),e("span",{staticClass:"line-number"},[a._v("51")]),e("br"),e("span",{staticClass:"line-number"},[a._v("52")]),e("br"),e("span",{staticClass:"line-number"},[a._v("53")]),e("br"),e("span",{staticClass:"line-number"},[a._v("54")]),e("br"),e("span",{staticClass:"line-number"},[a._v("55")]),e("br"),e("span",{staticClass:"line-number"},[a._v("56")]),e("br"),e("span",{staticClass:"line-number"},[a._v("57")]),e("br"),e("span",{staticClass:"line-number"},[a._v("58")]),e("br"),e("span",{staticClass:"line-number"},[a._v("59")]),e("br"),e("span",{staticClass:"line-number"},[a._v("60")]),e("br"),e("span",{staticClass:"line-number"},[a._v("61")]),e("br"),e("span",{staticClass:"line-number"},[a._v("62")]),e("br"),e("span",{staticClass:"line-number"},[a._v("63")]),e("br"),e("span",{staticClass:"line-number"},[a._v("64")]),e("br"),e("span",{staticClass:"line-number"},[a._v("65")]),e("br"),e("span",{staticClass:"line-number"},[a._v("66")]),e("br"),e("span",{staticClass:"line-number"},[a._v("67")]),e("br"),e("span",{staticClass:"line-number"},[a._v("68")]),e("br"),e("span",{staticClass:"line-number"},[a._v("69")]),e("br"),e("span",{staticClass:"line-number"},[a._v("70")]),e("br"),e("span",{staticClass:"line-number"},[a._v("71")]),e("br"),e("span",{staticClass:"line-number"},[a._v("72")]),e("br"),e("span",{staticClass:"line-number"},[a._v("73")]),e("br"),e("span",{staticClass:"line-number"},[a._v("74")]),e("br"),e("span",{staticClass:"line-number"},[a._v("75")]),e("br"),e("span",{staticClass:"line-number"},[a._v("76")]),e("br"),e("span",{staticClass:"line-number"},[a._v("77")]),e("br"),e("span",{staticClass:"line-number"},[a._v("78")]),e("br"),e("span",{staticClass:"line-number"},[a._v("79")]),e("br"),e("span",{staticClass:"line-number"},[a._v("80")]),e("br"),e("span",{staticClass:"line-number"},[a._v("81")]),e("br"),e("span",{staticClass:"line-number"},[a._v("82")]),e("br"),e("span",{staticClass:"line-number"},[a._v("83")]),e("br"),e("span",{staticClass:"line-number"},[a._v("84")]),e("br"),e("span",{staticClass:"line-number"},[a._v("85")]),e("br"),e("span",{staticClass:"line-number"},[a._v("86")]),e("br"),e("span",{staticClass:"line-number"},[a._v("87")]),e("br"),e("span",{staticClass:"line-number"},[a._v("88")]),e("br"),e("span",{staticClass:"line-number"},[a._v("89")]),e("br"),e("span",{staticClass:"line-number"},[a._v("90")]),e("br"),e("span",{staticClass:"line-number"},[a._v("91")]),e("br"),e("span",{staticClass:"line-number"},[a._v("92")]),e("br"),e("span",{staticClass:"line-number"},[a._v("93")]),e("br"),e("span",{staticClass:"line-number"},[a._v("94")]),e("br"),e("span",{staticClass:"line-number"},[a._v("95")]),e("br"),e("span",{staticClass:"line-number"},[a._v("96")]),e("br"),e("span",{staticClass:"line-number"},[a._v("97")]),e("br"),e("span",{staticClass:"line-number"},[a._v("98")]),e("br"),e("span",{staticClass:"line-number"},[a._v("99")]),e("br"),e("span",{staticClass:"line-number"},[a._v("100")]),e("br"),e("span",{staticClass:"line-number"},[a._v("101")]),e("br"),e("span",{staticClass:"line-number"},[a._v("102")]),e("br"),e("span",{staticClass:"line-number"},[a._v("103")]),e("br"),e("span",{staticClass:"line-number"},[a._v("104")]),e("br"),e("span",{staticClass:"line-number"},[a._v("105")]),e("br"),e("span",{staticClass:"line-number"},[a._v("106")]),e("br"),e("span",{staticClass:"line-number"},[a._v("107")]),e("br"),e("span",{staticClass:"line-number"},[a._v("108")]),e("br"),e("span",{staticClass:"line-number"},[a._v("109")]),e("br"),e("span",{staticClass:"line-number"},[a._v("110")]),e("br"),e("span",{staticClass:"line-number"},[a._v("111")]),e("br"),e("span",{staticClass:"line-number"},[a._v("112")]),e("br"),e("span",{staticClass:"line-number"},[a._v("113")]),e("br"),e("span",{staticClass:"line-number"},[a._v("114")]),e("br"),e("span",{staticClass:"line-number"},[a._v("115")]),e("br"),e("span",{staticClass:"line-number"},[a._v("116")]),e("br"),e("span",{staticClass:"line-number"},[a._v("117")]),e("br"),e("span",{staticClass:"line-number"},[a._v("118")]),e("br"),e("span",{staticClass:"line-number"},[a._v("119")]),e("br"),e("span",{staticClass:"line-number"},[a._v("120")]),e("br"),e("span",{staticClass:"line-number"},[a._v("121")]),e("br"),e("span",{staticClass:"line-number"},[a._v("122")]),e("br"),e("span",{staticClass:"line-number"},[a._v("123")]),e("br"),e("span",{staticClass:"line-number"},[a._v("124")]),e("br"),e("span",{staticClass:"line-number"},[a._v("125")]),e("br"),e("span",{staticClass:"line-number"},[a._v("126")]),e("br"),e("span",{staticClass:"line-number"},[a._v("127")]),e("br"),e("span",{staticClass:"line-number"},[a._v("128")]),e("br"),e("span",{staticClass:"line-number"},[a._v("129")]),e("br"),e("span",{staticClass:"line-number"},[a._v("130")]),e("br"),e("span",{staticClass:"line-number"},[a._v("131")]),e("br"),e("span",{staticClass:"line-number"},[a._v("132")]),e("br"),e("span",{staticClass:"line-number"},[a._v("133")]),e("br"),e("span",{staticClass:"line-number"},[a._v("134")]),e("br"),e("span",{staticClass:"line-number"},[a._v("135")]),e("br"),e("span",{staticClass:"line-number"},[a._v("136")]),e("br"),e("span",{staticClass:"line-number"},[a._v("137")]),e("br"),e("span",{staticClass:"line-number"},[a._v("138")]),e("br"),e("span",{staticClass:"line-number"},[a._v("139")]),e("br"),e("span",{staticClass:"line-number"},[a._v("140")]),e("br"),e("span",{staticClass:"line-number"},[a._v("141")]),e("br"),e("span",{staticClass:"line-number"},[a._v("142")]),e("br"),e("span",{staticClass:"line-number"},[a._v("143")]),e("br"),e("span",{staticClass:"line-number"},[a._v("144")]),e("br"),e("span",{staticClass:"line-number"},[a._v("145")]),e("br"),e("span",{staticClass:"line-number"},[a._v("146")]),e("br"),e("span",{staticClass:"line-number"},[a._v("147")]),e("br"),e("span",{staticClass:"line-number"},[a._v("148")]),e("br"),e("span",{staticClass:"line-number"},[a._v("149")]),e("br"),e("span",{staticClass:"line-number"},[a._v("150")]),e("br"),e("span",{staticClass:"line-number"},[a._v("151")]),e("br")])]),e("p",[a._v("查看报错日志，可分析出报错原因是因为 NameNode 连接不上 JournalNode，而利 用 jps 命令查看到三台 JN 都已经正常启动，为什么 NN 还是无法正常连接到 JN 呢？这 是因为 start-dfs.sh 群起脚本默认的启动顺序是先启动 NN，再启动 DN，然后再启动 JN， 并且默认的 rpc 连接参数是重试次数为 10，每次重试的间隔是 1s，也就是说启动完 NN 以后的 10s 中内，JN 还启动不起来，NN 就会报错了。")]),a._v(" "),e("p",[a._v("core-default.xml 里面有两个参数如下：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\x3c!-- NN 连接 JN 重试次数，默认是 10 次 --\x3e\n<property>\n <name>ipc.client.connect.max.retries</name>\n <value>10</value>\n</property>\n\x3c!-- 重试时间间隔，默认 1s --\x3e\n<property>\n <name>ipc.client.connect.retry.interval</name>\n <value>1000</value>\n</property>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("p",[a._v("解决方案：遇到上述问题后，可以稍等片刻，等 JN 成功启动后，手动启动下三台")]),a._v(" "),e("p",[e("strong",[a._v("NN:")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ hdfs --daemon start namenode\n[atguigu@hadoop103 ~]$ hdfs --daemon start namenode\n[atguigu@hadoop104 ~]$ hdfs --daemon start namenode\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("也可以在 core-site.xml 里面适当调大上面的两个参数：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\x3c!-- NN 连接 JN 重试次数，默认是 10 次 --\x3e\n<property>\n <name>ipc.client.connect.max.retries</name>\n <value>20</value>\n</property>\n\x3c!-- 重试时间间隔，默认 1s --\x3e\n<property>\n <name>ipc.client.connect.retry.interval</name>\n <value>5000</value>\n</property>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("h3",{attrs:{id:"_4-4-hdfs-ha-自动故障转移-客户端如何配置-namenode-的ip"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-hdfs-ha-自动故障转移-客户端如何配置-namenode-的ip"}},[a._v("#")]),a._v(" 4.4 HDFS-HA 自动故障转移 客户端如何配置 namenode 的ip")]),a._v(" "),e("p",[a._v("在 HDFS-HA 集群中，客户端需要配置名称节点的 IP 地址，以便连接到 HDFS 集群并进行读写操作。")]),a._v(" "),e("p",[a._v("对于客户端而言，它们需要配置两个名称节点的 IP 地址，一个是主名称节点的 IP 地址，另一个是备用名称节点的 IP 地址。这样，当主名称节点出现故障时，客户端可以通过备用名称节点的 IP 地址连接到 HDFS 集群，保证数据的可用性。")]),a._v(" "),e("p",[a._v("具体的配置方法如下：")]),a._v(" "),e("ul",[e("li",[a._v("1.在客户端的配置文件中，添加如下的配置项：")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("fs.defaultFS: hdfs://<ha-namenode-IP-address>:<port>/\ndfs.ha.namenodes: <ha-namenode-IP-address>:<port>,<ha-standby-namenode-IP-address>:<port>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("其中，"),e("code",[a._v("<ha-namenode-IP-address>")]),a._v("和"),e("code",[a._v("<ha-standby-namenode-IP-address>")]),a._v("分别表示主名称节点和备用名称节点的 IP 地址，"),e("code",[a._v("<port>")]),a._v("表示 HDFS 集群的端口号。")]),a._v(" "),e("ul",[e("li",[a._v("2.对于需要访问 HDFS 集群的应用程序，需要使用上述配置项指定 HDFS 集群的名称节点地址。例如，在 Java 程序中，可以使用如下的代码进行配置：")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("FileSystem.get(URI.create(“hdfs://<ha-namenode-IP-address>:<port>/“)).listFiles(“path”)\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("通过上述配置和代码，客户端可以连接到 HDFS-HA 集群，并在主名称节点和备用名称节点之间进行切换，以保证数据的可用性。当主名称节点出现故障时，客户端可以通过备用名称节点的 IP 地址连接到 HDFS 集群，继续进行读写操作。")]),a._v(" "),e("h3",{attrs:{id:"_4-5-zookeeper-failover-controller-zkfc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-zookeeper-failover-controller-zkfc"}},[a._v("#")]),a._v(" 4.5 ZooKeeper failover controller（ZKFC）")]),a._v(" "),e("p",[a._v("HDFS-HA 使用 ZooKeeper 作为其高可用性（HA）的协调器。然而，为了确保 NameNode 在故障转移期间正确地同步数据，还需要一个名为 ZooKeeper failover controller（ZKFC）的组件。")]),a._v(" "),e("p",[a._v("ZKFC 是一个守护进程，负责监测 NameNode 和 ZooKeeper 的状态，并在 NameNode 故障时触发故障转移。它的主要功能是：")]),a._v(" "),e("ol",[e("li",[a._v("监测 NameNode 和 ZooKeeper 的状态：ZKFC 定期检查 NameNode 和 ZooKeeper 的状态，以确保它们都在正常运行。")]),a._v(" "),e("li",[a._v("检测 NameNode 故障：如果 NameNode 停止响应或无法连接，ZKFC 将检测到故障。")]),a._v(" "),e("li",[a._v("触发故障转移：一旦检测到 NameNode 故障，ZKFC 将触发故障转移，将备用 NameNode 切换为新的主 NameNode。")]),a._v(" "),e("li",[a._v("同步数据：在故障转移期间，ZKFC 将确保备用 NameNode 正确地同步数据，以确保数据的一致性。")])]),a._v(" "),e("p",[a._v("因此，虽然 ZooKeeper 是 HDFS-HA 的协调器，但 ZKFC 仍然是必不可少的，因为它确保了 NameNode 在故障转移期间正确地同步数据，从而确保了 HDFS 的高可用性。")]),a._v(" "),e("h1",{attrs:{id:"yarn-ha-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yarn-ha-配置"}},[a._v("#")]),a._v(" YARN-HA 配置")]),a._v(" "),e("h2",{attrs:{id:"_5-1-yarn-ha-工作机制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-yarn-ha-工作机制"}},[a._v("#")]),a._v(" 5.1 YARN-HA 工作机制")]),a._v(" "),e("p",[a._v("1）官方文档： http://hadoop.apache.org/docs/r3.1.3/hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html")]),a._v(" "),e("p",[a._v("2）YARN-HA 工作机制")]),a._v(" "),e("p",[e("img",{attrs:{src:s(496),alt:"image-20230905155853239"}})]),a._v(" "),e("h2",{attrs:{id:"_5-2-配置-yarn-ha-集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-配置-yarn-ha-集群"}},[a._v("#")]),a._v(" 5.2 配置 YARN-HA 集群")]),a._v(" "),e("h3",{attrs:{id:"_1-环境准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境准备"}},[a._v("#")]),a._v(" 1）环境准备")]),a._v(" "),e("p",[a._v("（1）修改 IP")]),a._v(" "),e("p",[a._v("（2）修改主机名及主机名和 IP 地址的映射")]),a._v(" "),e("p",[a._v("（3）关闭防火墙")]),a._v(" "),e("p",[a._v("（4）ssh 免密登录")]),a._v(" "),e("p",[a._v("（5）安装 JDK，配置环境变量等")]),a._v(" "),e("p",[a._v("（6）配置 Zookeeper 集群")]),a._v(" "),e("h3",{attrs:{id:"_2-规划集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-规划集群"}},[a._v("#")]),a._v(" 2）规划集群")]),a._v(" "),e("p",[e("img",{attrs:{src:s(497),alt:"image-20230905160006808"}})]),a._v(" "),e("h3",{attrs:{id:"_3-核心问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-核心问题"}},[a._v("#")]),a._v(" "),e("strong",[a._v("3）核心问题")])]),a._v(" "),e("ul",[e("li",[a._v("a .如果当前 active rm 挂了，其他 rm 怎么将其他 standby rm 上位")])]),a._v(" "),e("p",[a._v("​    核心原理跟 hdfs 一样，利用了 zk 的临时节点")]),a._v(" "),e("ul",[e("li",[a._v("b. 当前 rm 上有很多的计算程序在等待运行,其他的 rm 怎么将这些程序接手过来接着跑")])]),a._v(" "),e("p",[a._v("​\trm 会将当前的所有计算程序的状态存储在 zk 中,其他 rm 上位后会去读取，然后接着跑")]),a._v(" "),e("h3",{attrs:{id:"_4-具体配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-具体配置"}},[a._v("#")]),a._v(" 4）具体配置")]),a._v(" "),e("p",[a._v("（1）yarn-site.xml")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("<configuration>\n <property>\n     <name>yarn.nodemanager.aux-services</name>\n     <value>mapreduce_shuffle</value>\n </property>\n \x3c!-- 启用 resourcemanager ha --\x3e\n <property>\n     <name>yarn.resourcemanager.ha.enabled</name>\n     <value>true</value>\n </property>\n \x3c!-- 声明两台 resourcemanager 的地址 --\x3e\n <property>\n     <name>yarn.resourcemanager.cluster-id</name>\n     <value>cluster-yarn1</value>\n </property>\n \x3c!--指定 resourcemanager 的逻辑列表--\x3e\n <property>\n     <name>yarn.resourcemanager.ha.rm-ids</name>\n     <value>rm1,rm2,rm3</value>\n</property>\n\x3c!-- ========== rm1 的配置 ========== --\x3e\n\x3c!-- 指定 rm1 的主机名 --\x3e\n <property>\n     <name>yarn.resourcemanager.hostname.rm1</name>\n     <value>hadoop102</value>\n</property>\n\x3c!-- 指定 rm1 的 web 端地址 --\x3e\n<property>\n     <name>yarn.resourcemanager.webapp.address.rm1</name>\n     <value>hadoop102:8088</value>\n</property>\n\x3c!-- 指定 rm1 的内部通信地址 --\x3e\n<property>\n     <name>yarn.resourcemanager.address.rm1</name>\n     <value>hadoop102:8032</value>\n</property>\n\x3c!-- 指定 AM 向 rm1 申请资源的地址 --\x3e\n<property>\n     <name>yarn.resourcemanager.scheduler.address.rm1</name> \n     <value>hadoop102:8030</value>\n</property>\n\x3c!-- 指定供 NM 连接的地址 --\x3e \n<property>\n     <name>yarn.resourcemanager.resource-tracker.address.rm1</name>\n     <value>hadoop102:8031</value>\n</property>\n\x3c!-- ========== rm2 的配置 ========== --\x3e\n \x3c!-- 指定 rm2 的主机名 --\x3e\n <property>\n     <name>yarn.resourcemanager.hostname.rm2</name>\n     <value>hadoop103</value>\n</property>\n<property>\n     <name>yarn.resourcemanager.webapp.address.rm2</name>\n     <value>hadoop103:8088</value>\n</property>\n<property>\n     <name>yarn.resourcemanager.address.rm2</name>\n     <value>hadoop103:8032</value>\n</property>\n<property>\n     <name>yarn.resourcemanager.scheduler.address.rm2</name>\n     <value>hadoop103:8030</value>\n</property>\n<property>\n     <name>yarn.resourcemanager.resource-tracker.address.rm2</name>\n     <value>hadoop103:8031</value>\n</property>\n\x3c!-- ========== rm3 的配置 ========== --\x3e\n\x3c!-- 指定 rm1 的主机名 --\x3e\n <property>\n     <name>yarn.resourcemanager.hostname.rm3</name>\n     <value>hadoop104</value>\n</property>\n\x3c!-- 指定 rm1 的 web 端地址 --\x3e\n<property>\n     <name>yarn.resourcemanager.webapp.address.rm3</name>\n     <value>hadoop104:8088</value>\n</property>\n\x3c!-- 指定 rm1 的内部通信地址 --\x3e\n<property>\n     <name>yarn.resourcemanager.address.rm3</name>\n     <value>hadoop104:8032</value>\n</property>\n\x3c!-- 指定 AM 向 rm1 申请资源的地址 --\x3e\n<property>\n     <name>yarn.resourcemanager.scheduler.address.rm3</name> \n     <value>hadoop104:8030</value>\n</property>\n\x3c!-- 指定供 NM 连接的地址 --\x3e \n<property>\n     <name>yarn.resourcemanager.resource-tracker.address.rm3</name>\n     <value>hadoop104:8031</value>\n</property>\n \x3c!-- 指定 zookeeper 集群的地址 --\x3e \n <property>\n     <name>yarn.resourcemanager.zk-address</name>\n     <value>hadoop102:2181,hadoop103:2181,hadoop104:2181</value>\n </property>\n \x3c!-- 启用自动恢复 --\x3e \n <property>\n     <name>yarn.resourcemanager.recovery.enabled</name>\n     <value>true</value>\n </property>\n \x3c!-- 指定 resourcemanager 的状态信息存储在 zookeeper 集群 --\x3e \n <property>\n     <name>yarn.resourcemanager.store.class</name> \n    <value>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateSt\n    ore</value>\n</property>\n\x3c!-- 环境变量的继承 --\x3e\n<property>\n <name>yarn.nodemanager.env-whitelist</name>\n \n<value>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLAS\nSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME</value>\n </property>\n</configuration>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br"),e("span",{staticClass:"line-number"},[a._v("26")]),e("br"),e("span",{staticClass:"line-number"},[a._v("27")]),e("br"),e("span",{staticClass:"line-number"},[a._v("28")]),e("br"),e("span",{staticClass:"line-number"},[a._v("29")]),e("br"),e("span",{staticClass:"line-number"},[a._v("30")]),e("br"),e("span",{staticClass:"line-number"},[a._v("31")]),e("br"),e("span",{staticClass:"line-number"},[a._v("32")]),e("br"),e("span",{staticClass:"line-number"},[a._v("33")]),e("br"),e("span",{staticClass:"line-number"},[a._v("34")]),e("br"),e("span",{staticClass:"line-number"},[a._v("35")]),e("br"),e("span",{staticClass:"line-number"},[a._v("36")]),e("br"),e("span",{staticClass:"line-number"},[a._v("37")]),e("br"),e("span",{staticClass:"line-number"},[a._v("38")]),e("br"),e("span",{staticClass:"line-number"},[a._v("39")]),e("br"),e("span",{staticClass:"line-number"},[a._v("40")]),e("br"),e("span",{staticClass:"line-number"},[a._v("41")]),e("br"),e("span",{staticClass:"line-number"},[a._v("42")]),e("br"),e("span",{staticClass:"line-number"},[a._v("43")]),e("br"),e("span",{staticClass:"line-number"},[a._v("44")]),e("br"),e("span",{staticClass:"line-number"},[a._v("45")]),e("br"),e("span",{staticClass:"line-number"},[a._v("46")]),e("br"),e("span",{staticClass:"line-number"},[a._v("47")]),e("br"),e("span",{staticClass:"line-number"},[a._v("48")]),e("br"),e("span",{staticClass:"line-number"},[a._v("49")]),e("br"),e("span",{staticClass:"line-number"},[a._v("50")]),e("br"),e("span",{staticClass:"line-number"},[a._v("51")]),e("br"),e("span",{staticClass:"line-number"},[a._v("52")]),e("br"),e("span",{staticClass:"line-number"},[a._v("53")]),e("br"),e("span",{staticClass:"line-number"},[a._v("54")]),e("br"),e("span",{staticClass:"line-number"},[a._v("55")]),e("br"),e("span",{staticClass:"line-number"},[a._v("56")]),e("br"),e("span",{staticClass:"line-number"},[a._v("57")]),e("br"),e("span",{staticClass:"line-number"},[a._v("58")]),e("br"),e("span",{staticClass:"line-number"},[a._v("59")]),e("br"),e("span",{staticClass:"line-number"},[a._v("60")]),e("br"),e("span",{staticClass:"line-number"},[a._v("61")]),e("br"),e("span",{staticClass:"line-number"},[a._v("62")]),e("br"),e("span",{staticClass:"line-number"},[a._v("63")]),e("br"),e("span",{staticClass:"line-number"},[a._v("64")]),e("br"),e("span",{staticClass:"line-number"},[a._v("65")]),e("br"),e("span",{staticClass:"line-number"},[a._v("66")]),e("br"),e("span",{staticClass:"line-number"},[a._v("67")]),e("br"),e("span",{staticClass:"line-number"},[a._v("68")]),e("br"),e("span",{staticClass:"line-number"},[a._v("69")]),e("br"),e("span",{staticClass:"line-number"},[a._v("70")]),e("br"),e("span",{staticClass:"line-number"},[a._v("71")]),e("br"),e("span",{staticClass:"line-number"},[a._v("72")]),e("br"),e("span",{staticClass:"line-number"},[a._v("73")]),e("br"),e("span",{staticClass:"line-number"},[a._v("74")]),e("br"),e("span",{staticClass:"line-number"},[a._v("75")]),e("br"),e("span",{staticClass:"line-number"},[a._v("76")]),e("br"),e("span",{staticClass:"line-number"},[a._v("77")]),e("br"),e("span",{staticClass:"line-number"},[a._v("78")]),e("br"),e("span",{staticClass:"line-number"},[a._v("79")]),e("br"),e("span",{staticClass:"line-number"},[a._v("80")]),e("br"),e("span",{staticClass:"line-number"},[a._v("81")]),e("br"),e("span",{staticClass:"line-number"},[a._v("82")]),e("br"),e("span",{staticClass:"line-number"},[a._v("83")]),e("br"),e("span",{staticClass:"line-number"},[a._v("84")]),e("br"),e("span",{staticClass:"line-number"},[a._v("85")]),e("br"),e("span",{staticClass:"line-number"},[a._v("86")]),e("br"),e("span",{staticClass:"line-number"},[a._v("87")]),e("br"),e("span",{staticClass:"line-number"},[a._v("88")]),e("br"),e("span",{staticClass:"line-number"},[a._v("89")]),e("br"),e("span",{staticClass:"line-number"},[a._v("90")]),e("br"),e("span",{staticClass:"line-number"},[a._v("91")]),e("br"),e("span",{staticClass:"line-number"},[a._v("92")]),e("br"),e("span",{staticClass:"line-number"},[a._v("93")]),e("br"),e("span",{staticClass:"line-number"},[a._v("94")]),e("br"),e("span",{staticClass:"line-number"},[a._v("95")]),e("br"),e("span",{staticClass:"line-number"},[a._v("96")]),e("br"),e("span",{staticClass:"line-number"},[a._v("97")]),e("br"),e("span",{staticClass:"line-number"},[a._v("98")]),e("br"),e("span",{staticClass:"line-number"},[a._v("99")]),e("br"),e("span",{staticClass:"line-number"},[a._v("100")]),e("br"),e("span",{staticClass:"line-number"},[a._v("101")]),e("br"),e("span",{staticClass:"line-number"},[a._v("102")]),e("br"),e("span",{staticClass:"line-number"},[a._v("103")]),e("br"),e("span",{staticClass:"line-number"},[a._v("104")]),e("br"),e("span",{staticClass:"line-number"},[a._v("105")]),e("br"),e("span",{staticClass:"line-number"},[a._v("106")]),e("br"),e("span",{staticClass:"line-number"},[a._v("107")]),e("br"),e("span",{staticClass:"line-number"},[a._v("108")]),e("br"),e("span",{staticClass:"line-number"},[a._v("109")]),e("br"),e("span",{staticClass:"line-number"},[a._v("110")]),e("br"),e("span",{staticClass:"line-number"},[a._v("111")]),e("br"),e("span",{staticClass:"line-number"},[a._v("112")]),e("br"),e("span",{staticClass:"line-number"},[a._v("113")]),e("br"),e("span",{staticClass:"line-number"},[a._v("114")]),e("br"),e("span",{staticClass:"line-number"},[a._v("115")]),e("br"),e("span",{staticClass:"line-number"},[a._v("116")]),e("br"),e("span",{staticClass:"line-number"},[a._v("117")]),e("br"),e("span",{staticClass:"line-number"},[a._v("118")]),e("br")])]),e("p",[a._v("（2）同步更新其他节点的配置信息，分发配置文件")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 etc]$ xsync hadoop/\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"_5-启动-yarn"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动-yarn"}},[a._v("#")]),a._v(" 5）启动 YARN")]),a._v(" "),e("p",[a._v("（1）在 hadoop102 或者 hadoop103 中执行：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ start-yarn.sh\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("（2）查看服务状态")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ yarn rmadmin -getServiceState rm1\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("（3）可以去 zkCli.sh 客户端查看 ResourceManager 选举锁节点内容：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[atguigu@hadoop102 ~]$ zkCli.sh\n[zk: localhost:2181(CONNECTED) 16] get -s \n/yarn-leader-election/cluster-yarn1/ActiveStandbyElectorLock\ncluster-yarn1rm1\ncZxid = 0x100000022\nctime = Tue Jul 14 17:06:44 CST 2020\nmZxid = 0x100000022\nmtime = Tue Jul 14 17:06:44 CST 2020\npZxid = 0x100000022\ncversion = 0\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x30000da33080005\ndataLength = 20\nnumChildren = \n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br")])]),e("p",[a._v("（4）web 端查看 hadoop102:8088 和 hadoop103:8088 的 YARN 的状态")]),a._v(" "),e("p",[e("img",{attrs:{src:s(498),alt:"image-20230905160615298"}})])])}),[],!1,null,null,null);e.default=r.exports},488:function(a,e,s){a.exports=s.p+"assets/img/image-20230905153634847.669a5db0.png"},489:function(a,e,s){a.exports=s.p+"assets/img/image-20230905153657185.63d660a8.png"},490:function(a,e,s){a.exports=s.p+"assets/img/image-20230905153935080.d4f61e3d.png"},491:function(a,e,s){a.exports=s.p+"assets/img/image-20230905154655698.1f0441cb.png"},492:function(a,e,s){a.exports=s.p+"assets/img/image-20230905154713712.9e170336.png"},493:function(a,e,s){a.exports=s.p+"assets/img/image-20230905154723872.1941dfb5.png"},494:function(a,e,s){a.exports=s.p+"assets/img/image-20230905154926719.605ea6dc.png"},495:function(a,e,s){a.exports=s.p+"assets/img/image-20230905155156458.407e747e.png"},496:function(a,e,s){a.exports=s.p+"assets/img/image-20230905155853239.2768bd3a.png"},497:function(a,e,s){a.exports=s.p+"assets/img/image-20230905160006808.c9f7064d.png"},498:function(a,e,s){a.exports=s.p+"assets/img/image-20230905160615298.1b6e4d77.png"}}]);