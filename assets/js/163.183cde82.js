(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{1432:function(s,n,a){"use strict";a.r(n);var t=a(4),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"su-切换用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#su-切换用户"}},[s._v("#")]),s._v(" "),n("strong",[s._v("su 切换用户")])]),s._v(" "),n("p",[s._v("用法：su [选项] [-] [用户 [参数]... ]")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- ：以 login-shell 方式进行登录\n不加 - :以 no-login-shell 方式进行登录\n-c：只进行一次在该用户下使用命令\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"login-shell-与-no-login-shell-的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#login-shell-与-no-login-shell-的区别"}},[s._v("#")]),s._v(" "),n("strong",[s._v("login-shell 与 no-login-shell 的区别")])]),s._v(" "),n("p",[n("code",[s._v("login-shell")]),s._v(" 登录时先去读取 "),n("code",[s._v("/etc/profile")]),s._v("， 然后按照顺序读取 "),n("code",[s._v("~/.bash_profile")]),s._v(" 或者 "),n("code",[s._v("~/.bash_login")]),s._v(" 或者 "),n("code",[s._v("~/.profile")]),s._v(" ，这三个个人配置文件只要按照顺序读取到一个就不会读取后面的配置文件。")]),s._v(" "),n("p",[n("code",[s._v("no-login-shell")]),s._v(" 的方式登录时不会去读取"),n("code",[s._v("/etc/profile")]),s._v(" 和 "),n("code",[s._v("~/.bash_profile(or ~/.bash_login or ~/.profile)")]),s._v(" 内容。")]),s._v(" "),n("p",[s._v("以 "),n("code",[s._v("no-login-shell")]),s._v(" 的方式登录，从 tom 切换到 root 为例，可以看出，以 no-login-shell 的方式，切换登录时不会去加载 root 的环境变量，依然保持着 tom 的环境变量，而以 login-shell 的方式，则会去加载 root 的环境变量。")]),s._v(" "),n("p",[s._v("no-login-shell 的方式切换：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[tom@localhost ~]$ su\n密码：\n[root@localhost tom]# env | grep 'tom'\nUSER=tom\nPATH=/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/tom/bin\nMAIL=/var/spool/mail/tom\nPWD=/home/tom\nLOGNAME=tom\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("login-shell 的方式切换（一般采用）：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[tom@localhost ~]$ su - root\n密码：\n[root@localhost ~]# env | grep 'tom'\n无结果\n[root@localhost ~]# env | grep 'root'\nUSER=root\nMAIL=/var/spool/mail/root\nPATH=/usr/lib64/qt-3.3/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin:/linux.i386\nPWD=/root\nHOME=/root\nLOGNAME=root\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("-c 只进行一次在该用户下使用命令，例如")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[root@localhost ~]# su - tom -c "touch su-test"\n[root@localhost ~]# su - tom\n[tom@localhost ~]$ ll\n-rw-r--r-- 1 tom  home    0 2月  18 14:24 su-test\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"sudo-切换用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sudo-切换用户"}},[s._v("#")]),s._v(" "),n("strong",[s._v("sudo 切换用户")])]),s._v(" "),n("p",[s._v("su 需要被切换用户的密码，sudo 不需要被切换用户的密码，只有 /etc/sudoers 文件内有的用户才可以执行此命令")]),s._v(" "),n("ol",[n("li",[s._v("将 tom 用户加入 /etc/sudoers 文件中")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#编辑 /etc/sudoers 文件\n[root@localhost ~]# visudo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("找到如下内容，并且将 tom 加入，保存退出")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("## Allow root to run any commands anywhere\nroot    ALL=(ALL)       ALL\ntom     ALL=(ALL)       ALL\n#如果想要切换执行的时候不需要输入自己的密码，则配置成如下\ntom     ALL=(ALL)       NOPASSWD:ALL\n或者让一个用户组的用户都可以使用 sudo，则配置如下\n## Same thing without a password\n%用户组名  ALL=(ALL)       NOPASSWD: ALL\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("使用 root 身份进行操作，sudo -u 用户 命令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[tom@localhost ~]$ head -n 3 /etc/sudoers\nhead: 无法打开"/etc/sudoers" 读取数据: 权限不够\n[tom@localhost ~]$ sudo -u root head -n 3 /etc/sudoers\n## Sudoers allows particular users to run various commands as\n## the root user, without needing the root password.\n##\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("将 su 和 sudo 结合，使用 sudo 切换到 root 并且使用自己的密码")]),s._v(" "),n("ol",[n("li",[s._v("更改配置文件 /etc/sudoers 如下")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("tom     ALL=(ALL)       /bin/su -\n备注：如果想要 tom 切换到 root 而禁止使用某些命令，可以在前面加一个 ! ,如禁止 tom 使用 sudo 执行更改密码操作：\ntom     ALL=(ALL)       !/user/bin/passwd\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("使用自己的密码切换到 root 用户下")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[tom@localhost ~]$ sudo su -\n[sudo] password for tom:\n[root@localhost ~]#\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("设置用户不可登陆")]),s._v(" "),n("ol",[n("li",[s._v("对于已有的用户，可以在 /etc/passwd 文件中可以直接加入 /sbin/nologin 使得该用户不可登录")])]),s._v(" "),n("p",[s._v("tom❌505:505:tom,088-88888888,18899990000,088-666666:/home/tom:"),n("strong",[s._v("/sbin/nologin")])]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("对于新建的用户，直接设置不可登录")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@localhost etc]# useradd jun -s /sbin/nologin\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("登录时，不能登录的用户给予提示，在 etc 目录下增加 nologin.txt")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@localhost etc]# cat nologin.txt\n不能登陆，因为我不能让 tom 登录\n[root@localhost etc]# su - tom\n不能登陆，因为我不能让 tom 登录\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);