(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{1016:function(a,s,e){a.exports=e.p+"assets/img/image-20230926231711221.e2a25197.png"},1509:function(a,s,e){"use strict";e.r(s);var n=e(4),r=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"第-7-章-kafka-kraft-模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第-7-章-kafka-kraft-模式"}},[a._v("#")]),a._v(" 第 7 章 Kafka-Kraft 模式")]),a._v(" "),s("h2",{attrs:{id:"_7-1-kafka-kraft-架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-kafka-kraft-架构"}},[a._v("#")]),a._v(" 7.1 Kafka-Kraft 架构")]),a._v(" "),s("p",[s("img",{attrs:{src:e(1016),alt:"image-20230926231711221"}})]),a._v(" "),s("p",[a._v("左图为 Kafka 现有架构，元数据在 zookeeper 中，运行时动态选举 controller，由 controller 进行 Kafka 集群管理。右图为 kraft 模式架构（实验性），不再依赖 zookeeper 集群， 而是用三台 controller 节点代替 zookeeper，元数据保存在 controller 中，由 controller 直接进行 Kafka 集群管理。")]),a._v(" "),s("p",[a._v("这样做的好处有以下几个：")]),a._v(" "),s("ul",[s("li",[a._v("Kafka 不再依赖外部框架，而是能够独立运行；")]),a._v(" "),s("li",[a._v("controller 管理集群时，不再需要从 zookeeper 中先读取数据，集群性能上升；")]),a._v(" "),s("li",[a._v("由于不依赖 zookeeper，集群扩展时不再受到 zookeeper 读写能力限制；")]),a._v(" "),s("li",[a._v("controller 不再动态选举，而是由配置文件规定。这样我们可以有针对性的加强 controller 节点的配置，而不是像以前一样对随机 controller 节点的高负载束手无策。")])]),a._v(" "),s("h2",{attrs:{id:"_7-2-kafka-kraft-集群部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-kafka-kraft-集群部署"}},[a._v("#")]),a._v(" 7.2 Kafka-Kraft 集群部署")]),a._v(" "),s("h4",{attrs:{id:"_1-再次解压一份-kafka-安装包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-再次解压一份-kafka-安装包"}},[a._v("#")]),a._v(" 1）再次解压一份 kafka 安装包")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 software]$ tar -zxvf kafka_2.12-3.0.0.tgz -C /opt/module/\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_2-重命名为-kafka2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-重命名为-kafka2"}},[a._v("#")]),a._v(" 2）重命名为 kafka2")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 module]$ mv kafka_2.12-3.0.0/ kafka2\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-在-hadoop102-上修改-opt-module-kafka2-config-kraft-server-properties-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-在-hadoop102-上修改-opt-module-kafka2-config-kraft-server-properties-配置文件"}},[a._v("#")]),a._v(" 3）在 hadoop102 上修改/opt/module/kafka2/config/kraft/server.properties 配置文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 kraft]$ vim server.properties\n\n#kafka 的角色（controller 相当于主机、broker 节点相当于从机，主机类似 zk 功\n能）\nprocess.roles=broker, controller\n#节点 ID\nnode.id=2\n#controller 服务协议别名\ncontroller.listener.names=CONTROLLER\n#全 Controller 列表\ncontroller.quorum.voters=2@hadoop102:9093,3@hadoop103:9093,4@hadoop104:9093\n#不同服务器绑定的端口\nlisteners=PLAINTEXT://:9092,CONTROLLER://:9093\n#broker 服务协议别名\ninter.broker.listener.name=PLAINTEXT\n#broker 对外暴露的地址\nadvertised.Listeners=PLAINTEXT://hadoop102:9092\n#协议别名到安全协议的映射\nlistener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL\n#kafka 数据存储目录\nlog.dirs=/opt/module/kafka2/data\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br")])]),s("h4",{attrs:{id:"_4-分发-kafka2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-分发-kafka2"}},[a._v("#")]),a._v(" 4）分发 kafka2")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 module]$ xsync kafka2/\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("在 hadoop103 和 hadoop104 上 需 要 对 node.id 相应改变 ， 值需要和 controller.quorum.voters 对应。")]),a._v(" "),s("li",[a._v("在 hadoop103 和 hadoop104 上需要 根据各自的主机名称，修改相应的 advertised.Listeners 地址。")])]),a._v(" "),s("h4",{attrs:{id:"_5-初始化集群数据目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-初始化集群数据目录"}},[a._v("#")]),a._v(" 5）初始化集群数据目录")]),a._v(" "),s("p",[a._v("（1）首先生成存储目录唯一 ID。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 kafka2]$ bin/kafka-storage.sh random-uuid\nJ7s9e8PPTKOO47PxzI39VA\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("（2）用该 ID 格式化 kafka 存储目录（三台节点）。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 kafka2]$ bin/kafka-storage.sh format -t J7s9e8PPTKOO47PxzI39VA -c /opt/module/kafka2/config/kraft/server.properties\n\n[andanyoung@hadoop103 kafka2]$ bin/kafka-storage.sh format -t J7s9e8PPTKOO47PxzI39VA -c /opt/module/kafka2/config/kraft/server.properties\n\n[andanyoung@hadoop104 kafka2]$ bin/kafka-storage.sh format -t J7s9e8PPTKOO47PxzI39VA -c /opt/module/kafka2/config/kraft/server.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h4",{attrs:{id:"_6-启动-kafka-集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-启动-kafka-集群"}},[a._v("#")]),a._v(" 6）启动 kafka 集群")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 kafka2]$ bin/kafka-server-start.sh -daemon config/kraft/server.properties\n\n[andanyoung@hadoop103 kafka2]$ bin/kafka-server-start.sh -daemon config/kraft/server.properties\n\n[andanyoung@hadoop104 kafka2]$ bin/kafka-server-start.sh -daemon config/kraft/server.properties\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h4",{attrs:{id:"_7-停止-kafka-集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-停止-kafka-集群"}},[a._v("#")]),a._v(" 7）停止 kafka 集群")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 kafka2]$ bin/kafka-server-stop.sh\n[andanyoung@hadoop103 kafka2]$ bin/kafka-server-stop.sh\n[andanyoung@hadoop104 kafka2]$ bin/kafka-server-stop.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h2",{attrs:{id:"_7-3-kafka-kraft-集群启动停止脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-kafka-kraft-集群启动停止脚本"}},[a._v("#")]),a._v(" 7.3 Kafka-Kraft 集群启动停止脚本")]),a._v(" "),s("h4",{attrs:{id:"_1-在-home-andanyoung-bin-目录下创建文件-kf2-sh-脚本文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-在-home-andanyoung-bin-目录下创建文件-kf2-sh-脚本文件"}},[a._v("#")]),a._v(" 1）在/home/andanyoung/bin 目录下创建文件 kf2.sh 脚本文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 bin]$ vim kf2.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("脚本如下：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('#! /bin/bash\ncase $1 in\n"start"){\n\tfor i in hadoop102 hadoop103 hadoop104\n\tdo\n\t\techo " --------启动 $i Kafka2-------"\n\t\tssh $i "/opt/module/kafka2/bin/kafka-server-start.sh -daemon /opt/module/kafka2/config/kraft/server.properties"\n    done\n};;\n"stop"){\n     for i in hadoop102 hadoop103 hadoop104\n     do\n     \techo " --------停止 $i Kafka2-------"\n     \tssh $i "/opt/module/kafka2/bin/kafka-server-stop.sh "\n     done\n};;\nesac\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br")])]),s("h4",{attrs:{id:"_2-添加执行权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加执行权限"}},[a._v("#")]),a._v(" 2）添加执行权限")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 bin]$ chmod +x kf2.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_3-启动集群命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动集群命令"}},[a._v("#")]),a._v(" 3）启动集群命令")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 ~]$ kf2.sh start\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_4-停止集群命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-停止集群命令"}},[a._v("#")]),a._v(" 4）停止集群命令")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("[andanyoung@hadoop102 ~]$ kf2.sh stop\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);