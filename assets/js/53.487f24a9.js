(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{378:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("blockquote",[n("p",[s._v("本文介绍如何为 "),n("code",[s._v("Nginx")]),s._v(" 配置端口转发。经常在 "),n("code",[s._v("CentOS")]),s._v(" 系统中搭建各种网站，为了满足各种不同的网站共用 "),n("code",[s._v("80/443")]),s._v(" 端口，我们可以采用 "),n("code",[s._v("Nginx")]),s._v(" 的端口转发功能，将 "),n("code",[s._v("80/443")]),s._v(" 端口通过域名映射到后端的多个端口。")])]),s._v(" "),n("h2",{attrs:{id:"配置端口转发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置端口转发"}},[s._v("#")]),s._v(" 配置端口转发")]),s._v(" "),n("p",[s._v("进入/etc/nginx/conf.d 目录下，默认文件如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@ady_cn ~]# cd /etc/nginx/conf.d\n[root@ady_cn conf.d]# ll\ntotal 12\n-rw-r--r-- 1 root root 1290 Jun 17 05:34 default.conf\n-rw-r--r-- 1 root root  466 Jun 17 05:34 ssl.conf\n-rw-r--r-- 1 root root  283 Jun 17 05:34 virtual.conf\n[root@ady_cn conf.d]#\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("在/etc/nginx/conf.d 目录下创建 proxy.conf 文件，文件内容如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("proxy_redirect          off;\nproxy_set_header        Host $host;\nproxy_set_header        X-Real-IP $remote_addr;\nproxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\nclient_max_body_size    10m;\nclient_body_buffer_size 128k;\nproxy_connect_timeout   90;\nproxy_send_timeout      90;\nproxy_read_timeout      90;\nproxy_buffer_size       4k;\nproxy_buffers           4 32k;\nproxy_busy_buffers_size 64k;\nproxy_temp_file_write_size 64k;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("在/etc/nginx/conf.d 中，创建 nginx.conf 文件，配置信息如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#user nobody;\nworker_processes 1;\nerror_log logs/error.log;\n#error_log logs/error.log notice;\n#error_log logs/error.log info;\npid        logs/nginx.pid;\nevents {\n    worker_connections 64;\n}\nhttp {\n    include       mime.types;\n    default_type application/octet-stream;\n    log_format main \'$remote_addr - $remote_user [$time_local] $request \'\n    #                  \'"$status" $body_bytes_sent "$http_referer" \'\n    #                  \'"$http_user_agent" "$http_x_forwarded_for"\';\n    access_log logs/access.log main;\n    sendfile        on;\n    #tcp_nopush     on;\n    #keepalive_timeout 0;\n    keepalive_timeout 100;\n    # set request cache\n    client_header_buffer_size    2k;\n    large_client_header_buffers 4 4k;\n    # open gzip model\n    gzip on;\n    gzip_min_length 1100;\n    gzip_buffers     4 8k;\n    gzip_types       text/plain;\n    output_buffers   1 32k;\n    postpone_output 1460;\n\n    upstream www.qikemi.com {\n        server 127.0.0.1:8085;\n    }\n\n    upstream www.ady.cn {\n        server 127.0.0.1:8086;\n    }\n\n    upstream www.xiaohua.asia {\n        server 127.0.0.1:8087;\n    }\n\n   server {\n        listen       80;\n        server_name www.qikemi.com;\n        #charset koi8-r;\n        access_log logs/hostqikemi.access.log main;\n        location / {\n            #root   html;\n            #index index.html index.htm;\n            proxy_pass http://www.qikemi.com;\n            include proxy.conf;\n        }\n    }\n\n    server {\n        listen       80;\n        server_name www.ady.cn;\n        #charset koi8-r;\n        access_log logs/host166801.access.log main;\n        location / {\n            #root   html;\n            #index index.html index.htm;\n            proxy_pass http://www.ady.cn;\n            include proxy.conf;\n            expires 30d;\n        }\n    }\n\n   server {\n        listen       80;\n        server_name www.xiaohua.asia;\n        #charset koi8-r;\n        access_log logs/hostxiaohua.access.log main;\n        location / {\n            #root   html;\n            #index index.html index.htm;\n            proxy_pass http://www.xiaohua.asia;\n            include proxy.conf;\n            expires 30d;\n        }\n   }\n\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br")])]),n("p",[s._v("或者在/etc/nginx/conf.d 中直接添加自己需要配置，如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@ady_cn conf.d]# cat cas.qikemi.com.conf\nupstream cas.qikemi.com {\n    server 127.0.0.1:8084;\n}\n\nserver {\n    listen       80;\n    server_name  cas.qikemi.com;\n    #ssl          on;\n    #charset koi8-r;\n    access_log logs/cas.qikemi.com.access.log main;\n\n    ### SSL cert files ###\n    #ssl_certificate      /var/local/github/ssl/qikemi.com/1_www.qikemi.com_bundle.crt;\n    #ssl_certificate_key  /var/local/github/ssl/qikemi.com/2_www.qikemi.com.key;\n    ### Add SSL specific settings here ###\n    #keepalive_timeout    60;\n\n    location / {\n        #root   html;\n        #index index.html index.htm;\n        proxy_pass http://cas.qikemi.com;\n        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;\n        include /etc/nginx/conf.d/proxy.conf;\n        proxy_set_header X-Forwarded-Proto https;\n    }\n}\n\n[root@ady_cn conf.d]# cat shop.qikemi.com.conf\nupstream shop.qikemi.com {\n    server 127.0.0.1:8082;\n    #server ady.github.io;\n}\n\nserver {\n    listen       80;\n    server_name  shop.qikemi.com;\n    #ssl          on;\n    #charset koi8-r;\n    access_log logs/shop.qikemi.com.access.log main;\n\n    ### SSL cert files ###\n    #ssl_certificate      /var/local/github/ssl/qikemi.com/1_shop.qikemi.com_bundle.crt;\n    #ssl_certificate_key  /var/local/github/ssl/qikemi.com/2_shop.qikemi.com.key;\n    ### Add SSL specific settings here ###\n    #keepalive_timeout    60;\n\n\n    location / {\n        #root   html;\n        #index index.html index.htm;\n        proxy_pass http://shop.qikemi.com;\n        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;\n        include /etc/nginx/conf.d/proxy.conf;\n        proxy_set_header X-Forwarded-Proto https;\n    }\n}\n\n[root@ady_cn conf.d]# cat ady_cn.conf.bak\nupstream www.ady.cn {\n    server 127.0.0.1:8081;\n    #server ady.github.io;\n}\n\nserver {\n    listen 80;\n    server_name www.ady.cn;\n    rewrite ^(.*) https://$server_name$1 permanent;\n}\n\nserver {\n    listen 80;\n    server_name ady.cn;\n    rewrite ^(.*) https://www.ady.cn permanent;\n}\n\nserver {\n    listen       443;\n    server_name  www.ady.cn;\n    ssl          on;\n    #charset koi8-r;\n    access_log logs/www.ady.cn.access.log main;\n\n    ### SSL cert files ###\n    ssl_certificate      /var/local/github/ssl/ady_cn/1_www.ady.cn_bundle.crt;\n    ssl_certificate_key  /var/local/github/ssl/ady_cn/2_www.ady.cn.key;\n    ### Add SSL specific settings here ###\n    keepalive_timeout    60;\n\n\n    location / {\n        #root   html;\n        #index index.html index.htm;\n        proxy_pass http://www.ady.cn;\n        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;\n        include /etc/nginx/conf.d/proxy.conf;\n        proxy_set_header X-Forwarded-Proto https;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);