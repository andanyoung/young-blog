(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{1471:function(a,e,n){"use strict";n.r(e);var s=n(4),t=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v('tomcat 和大多数服务程序的管理不一样，tomcat 更适合使用图形管理界面进行管理，例如在不停止 tomcat 的情况下动态部署新的 webapp 或重新加载 webapp。如果不使用图形管理工具，tomcat 虽然也可以配置自动部署(autoDeploy="true")，但我们却无法掌握它重新部署的时刻。')]),a._v(" "),e("p",[a._v("图形管理工具的官方手册："),e("a",{attrs:{href:"http://tomcat.apache.org/tomcat-8.5-doc/manager-howto.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Manager App HOW-TO"),e("OutboundLink")],1),a._v("。")]),a._v(" "),e("p",[a._v("直接在浏览器中输入 tomcat 所在机器的 ip 地址及其 connector 监听端口，即可进入 tomcat 的图形管理界面，也是欢迎界面。这个欢迎页面是 tomcat engine 中的默认 Host 组件 localhost 提供的页面，该资源的路径为$catalina_home/webapps/ROOT/index.jsp。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('<Host name="localhost"  appBase="webapps"\n            unpackWARs="true" autoDeploy="true">\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[e("img",{attrs:{src:"http://md7.admin4j.com/blog/202303281417133.png",alt:""}})]),a._v(" "),e("p",[a._v("这 3 个按钮对应的是 tomcat 默认就安装好的 3 个管理工具：状态查看工具、webapp 管理工具(非常重要)和虚拟主机管理工具。其中前 2 个工具都由名为 manager 的 webapp 提供，第三个工具由名为 host-manager 的 webapp 提供，因此后文将认为只提供了两个管理程序:manager 和 host-manager。它们的路径都在 webapps 目录下。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@xuexi tomcat]# ls webapps/\ndocs  examples  host-manager  manager  ROOT\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v('点击这 3 个按钮，分别可以进入对应的管理界面。但第一次点击，会出现"403 Access denied"错误，并提示要去配置 conf/tomcat-users.xml，添加相应权限的角色。')]),a._v(" "),e("p",[e("img",{attrs:{src:"http://md7.admin4j.com/blog/202303281417204.png",alt:""}})]),a._v(" "),e("p",[a._v('对于这两个管理程序而言，总共有以下几种预定义角色：其中后两项角色是上一图中"Host Manager"需要的角色。')]),a._v(" "),e("ul",[e("li",[a._v("manager-gui - allows access to the HTML GUI and the status pages")]),a._v(" "),e("li",[a._v("manager-script - allows access to the text interface and the status pages")]),a._v(" "),e("li",[a._v("manager-jmx - allows access to the JMX proxy and the status pages")]),a._v(" "),e("li",[a._v("manager-status - allows access to the status pages only")]),a._v(" "),e("li",[a._v("admin-gui - allows access to the HTML GUI")]),a._v(" "),e("li",[a._v("admin-script - allows access to the text interface")])]),a._v(" "),e("p",[a._v("对于使用 manager-gui 角色的用户，强烈建议不要再为其赋予 manager-script 和 manager-jmx 角色。")]),a._v(" "),e("p",[a._v("这些角色名称 rolename 已经预定义在各管理程序内的 web.xml 中：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@xuexi tomcat]# grep 'role-name' webapps/manager/WEB-INF/web.xml\n       <role-name>manager-gui</role-name>\n       <role-name>manager-script</role-name>\n       <role-name>manager-jmx</role-name>\n       <role-name>manager-gui</role-name>\n       <role-name>manager-script</role-name>\n       <role-name>manager-jmx</role-name>\n       <role-name>manager-status</role-name>\n    <role-name>manager-gui</role-name>\n    <role-name>manager-script</role-name>\n    <role-name>manager-jmx</role-name>\n    <role-name>manager-status</role-name>\n\n[root@xuexi tomcat]# grep 'role-name' webapps/host-manager/WEB-INF/web.xml\n       <role-name>admin-script</role-name>\n       <role-name>admin-gui</role-name>\n    <role-name>admin-gui</role-name>\n    <role-name>admin-script</role-name>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br")])]),e("p",[a._v("因此，在各管理程序的身份验证文件中可以直接引用这几个名称。那么如何配置身份验证，使得只有通过验证的用户才能使用这些管理工具？根据前面的错误页面提示，只需在$catalina_home/conf/tomcat-user.xml 中配置即可。")]),a._v(" "),e("p",[a._v("例如，使用预定义好的角色进行配置。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('<user username="malongshuai" password="123456" roles="manager-gui,admin-gui"/>\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("再重启 tomcat 即可。但是，这样的配置在 tomcat 7 版本能成功，在 tomcat8 上不会成功。查看 catalina.home 下的.RUNING 文件，提示如下内容：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('For example, the standard manager web application can be kept in\nCATALINA_HOME/webapps/manager and loaded into CATALINA_BASE by using\nthe following trick:\n\n * Copy the CATALINA_HOME/webapps/manager/META-INF/context.xml\n   file as CATALINA_BASE/conf/Catalina/localhost/manager.xml\n\n * Add docBase attribute as shown below.\n\nThe file will look like the following:\n\n  <?xml version="1.0" encoding="UTF-8"?>\n  <Context docBase="${catalina.home}/webapps/manager"\n    antiResourceLocking="false" privileged="true" >\n    <Valve className="org.apache.catalina.valves.RemoteAddrValve"\n         allow="127\\.0\\.0\\.1" />\n  </Context>\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br")])]),e("p",[a._v("它要求我们将 CATALINA_HOME/webapps/manager/META-INF/context.xml 复制到 CATALINA_BASE/conf/Catalina/localhost/manager.xml，并修改其内容。既然知道了操作过程，所以在 tomcat 8 中也就不用去复制了，这里直接创建文件并向里面写入内容即可，注意文件名一定不能错误。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('[root@xuexi tomcat]# mkdir -p conf/Catalina/localhost\n[root@xuexi tomcat]# cat conf/Catalina/localhost/manager.xml\n<?xml version="1.0" encoding="UTF-8"?>\n<Context docBase="${catalina.home}/webapps/manager"\n        antiResourceLocking="false" privileged="true" >\n  <Valve className="org.apache.catalina.valves.RemoteAddrValve"\n         allow="^.*$" />\n</Context>\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br")])]),e("p",[a._v("此处 allow 定义的是允许所有主机访问此管理状态页面。还可以使用"),e("code",[a._v('allow="127\\.0\\.0\\.1"')]),a._v("定义只有本机才能访问，"),e("code",[a._v('allow="192\\.168\\.100.*"')]),a._v("定义只有 192.168.100 网段的主机才能访问。")]),a._v(" "),e("p",[a._v("定义了 manager.xml 文件后，也仅能访问前两个页面，因为前两个页面是 manager 程序提供的，访问时需要在 uri 中使用/manager，或直接点击上面的按钮。以下是管理 webapp 的图形管理工具页面，从图中可以看出，可以轻松管理某个 webapp 的启动、停止、部署、重新部署、部署本地项目等。")]),a._v(" "),e("p",[e("img",{attrs:{src:"http://md7.admin4j.com/blog/202303281417066.png",alt:""}})]),a._v(" "),e("p",[e("img",{attrs:{src:"http://md7.admin4j.com/blog/202303281417996.png",alt:""}})]),a._v(" "),e("p",[a._v("第三个页面是管理虚拟主机的图形页面，访问时的 uri 部分是/host-manager。但要使用它，也需要将 context.xml 复制到特定路径下，并修改一点内容。如下：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@xuexi tomcat]# cp conf/Catalina/localhost/manager.xml conf/Catalina/localhost/host-manager.xml\n[root@xuexi tomcat]# sed -i s/manager/host-manager/ conf/Catalina/localhost/host-manager.xml\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("下图是虚拟主机的管理页面。")]),a._v(" "),e("p",[e("img",{attrs:{src:"http://md7.admin4j.com/blog/202303281417169.png",alt:""}})]),a._v(" "),e("p",[a._v("以上是将文件 manager.xml 或 host-manager.xml 复制到 CATALINA_BASE/conf/Catalina/localhost/下，这是管理所有虚拟主机，如果想要单独管理某虚拟主机，则可以将文件按照"),e("code",[a._v("$CATALINA_BASE/conf/[enginename]/[hostname]")]),a._v("路径进行复制。")])])}),[],!1,null,null,null);e.default=t.exports}}]);