(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{925:function(a,s,e){"use strict";e.r(s);var r=e(4),t=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[a._v("Nginx proxy_pass uri 的 "),s("code",[a._v("/")]),a._v(" 路径详细介绍。")])]),a._v(" "),s("h2",{attrs:{id:"nginx-配置-proxy-pass-转发的-路径问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置-proxy-pass-转发的-路径问题"}},[a._v("#")]),a._v(" Nginx 配置 proxy_pass 转发的 / 路径问题")]),a._v(" "),s("p",[a._v("在 nginx 中配置 proxy_pass 时，如果是按照^~匹配路径时，要注意 "),s("code",[a._v("proxy_pass")]),a._v(" 后的 "),s("code",[a._v("url")]),a._v(" 最后的 "),s("code",[a._v("/")]),a._v(" :")]),a._v(" "),s("ul",[s("li",[a._v("当加上了 "),s("code",[a._v("/")]),a._v("，相当于绝对根路径，则 nginx 不会把 location 中匹配的路径部分代理走")]),a._v(" "),s("li",[a._v("如果没有 "),s("code",[a._v("/")]),a._v("，相当于相对路径，则会把匹配的路径部分也给代理走")])]),a._v(" "),s("h2",{attrs:{id:"示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[a._v("#")]),a._v(" 示例")]),a._v(" "),s("h3",{attrs:{id:"有"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有"}},[a._v("#")]),a._v(" 有 /")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("location ^~ /proxy_api/\n{\n    proxy_cache api_cache;\n    proxy_set_header Host api.ady.cn;\n    proxy_pass http://api.ady.cn/;\n}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("如上面的配置，如果请求的 "),s("code",[a._v("url")]),a._v(" 是 "),s("code",[a._v("http://your_domain/proxy_api/load.php")]),a._v("，会被代理成 "),s("code",[a._v("http://api.ady.cn/load.php")])]),a._v(" "),s("h3",{attrs:{id:"无"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#无"}},[a._v("#")]),a._v(" 无 /")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("location ^~ /proxy_api/\n{\n    proxy_cache api_cache;\n    proxy_set_header Host api.ady.cn;\n    proxy_pass http://api.ady.cn;\n}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("如上面的配置，则会被代理到"),s("code",[a._v("http://api.ady.cn/proxy_api/load.php")])]),a._v(" "),s("h3",{attrs:{id:"其他实现方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他实现方式"}},[a._v("#")]),a._v(" 其他实现方式")]),a._v(" "),s("p",[a._v("当然，我们可以用如下的 rewrite 来实现 / 的功能：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("location ^~ /proxy_api/\n{\n    proxy_cache api_cache;\n    proxy_set_header Host api.ady.cn;\n    rewrite /proxy_api/(.+)$ /$1 break;\n    proxy_pass http://api.ady.cn;\n}\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h2",{attrs:{id:"其他问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他问题"}},[a._v("#")]),a._v(" 其他问题")]),a._v(" "),s("h3",{attrs:{id:"跨域问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题"}},[a._v("#")]),a._v(" 跨域问题")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("    location /abc/ {\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Headers' 'X-Requested-With';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;\n        add_header 'Access-Control-Allow-Headers' 'Accept,Authorization,Cache-Control,Content-Type,DNT,If-Modified-Since,Keep-Alive,Origin,User-Agent,X-Requested-With' always;\n        proxy_pass http://<ip>:<port>/;\n    }\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h3",{attrs:{id:"forwarded-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#forwarded-配置"}},[a._v("#")]),a._v(" Forwarded 配置")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("    location /abc/ {\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Forwarded-Host $http_host;\n        proxy_pass http://<ip>:<port>/;\n    }\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h3",{attrs:{id:"referer-policy-问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#referer-policy-问题"}},[a._v("#")]),a._v(" Referer policy 问题")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("    location /abc/ {\n        # add_header 'Referrer-Policy' 'no-referrer-when-downgrade';\n        # add_header 'Referrer-Policy' 'unsafe-url';\n        # add_header 'Referrer-Policy' 'strict-origin';\n        # proxy_set_header Referer $http_referer;\n        proxy_set_header Referer http://<ip>:<port>$request_uri;\n        proxy_redirect off;\n        proxy_pass http://<ip>:<port>/;\n    }\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);