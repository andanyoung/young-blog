(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{1083:function(t,a,n){"use strict";n.r(a);var s=n(4),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("a",{attrs:{href:"https://blog.csdn.net/m0_53157173/article/details/125052623?ops_request_misc=%7B%22request%5Fid%22%3A%22166624625716782248575826%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&request_id=166624625716782248575826&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-9-125052623-null-null.article_score_rank_blog&utm_term=%E4%BA%8B%E5%8A%A1&spm=1018.2226.3001.4450",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring 事务王国概览"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://cjdhy.blog.csdn.net/article/details/125130078",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring 事务管理—上"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://cjdhy.blog.csdn.net/article/details/125196276",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring 事务管理—中"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://cjdhy.blog.csdn.net/article/details/125223905",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring 事务管理—下"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://cjdhy.blog.csdn.net/article/details/125232126",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring 事务扩展篇"),a("OutboundLink")],1)]),t._v(" "),a("h1",{attrs:{id:"事务创建涉及到一些属性的配置-如"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务创建涉及到一些属性的配置-如"}},[t._v("#")]),t._v(" 事务创建涉及到一些属性的配置,如:")]),t._v(" "),a("p",[a("img",{attrs:{src:n(637),alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("事务的隔离级别")]),t._v(" "),a("li",[t._v("事务的传播行为")]),t._v(" "),a("li",[t._v("事务的超时时间")]),t._v(" "),a("li",[t._v("是否为只读事务")])]),t._v(" "),a("h1",{attrs:{id:"事务家族"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务家族"}},[t._v("#")]),t._v(" 事务家族")]),t._v(" "),a("p",[t._v("事务的大家族中常会出现下面几个重要的家庭成员:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Resource Manager")]),t._v(": 简称 RM，可以将其看做是数据的管理员，例如,数据库服务器(mysql),消息服务器等")]),t._v(" "),a("li",[a("strong",[t._v("Transaction Processing Monitor")]),t._v(": 简称 TPM 或者 TP Monitor,他负责在分布式场景下协调多个 RM 的事务处理。")]),t._v(" "),a("li",[a("strong",[t._v("Transaction Manager")]),t._v(": 简称 TM，它可以认为是 TP Monitor 的核心模块,直接负责多 RM 之间事务处理的协调工作,并提供事务界定，事务上下文传播等功能接口。")])]),t._v(" "),a("h1",{attrs:{id:"三大主要类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三大主要类"}},[t._v("#")]),t._v(" 三大主要类")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("PlatformTransactionManager")]),t._v("： 负责界定事务边界")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("public interface PlatformTransactionManager extends TransactionManager {\n\tTransactionStatus getTransaction(@Nullable TransactionDefinition definition)\n\t\t\tthrows TransactionException;\n\tvoid commit(TransactionStatus status) throws TransactionException;\n\tvoid rollback(TransactionStatus status) throws TransactionException;\n}\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("TransactionStatus")]),t._v(" ： 记录整个事务处理过程中的事务状态")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("SavepointManager:")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("mysql 中 savepoint 的用法吧:")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ET autocommit=0;\nSTART TRANSACTION;\nDELETE FROM test1 WHERE  NAME='大忽悠';\nSAVEPOINT a;#设置保存点\nDELETE FROM test1 WHERE  NAME='小朋友';\nROLLBACK TO a;#回滚到保存点\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("blockquote",[a("p",[a("strong",[a("code",[t._v("SAVEPOINT的好处在于可以选择回滚一部分事务")])])])])])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("TransactionDefinition")]),t._v(" ：主要定义了事务属性相关配置:")]),t._v(" "),a("ul",[a("li",[t._v("事务的隔离级别")]),t._v(" "),a("li",[t._v("事务的传播行为")]),t._v(" "),a("li",[t._v("事务的超时时间")]),t._v(" "),a("li",[t._v("是否为只读事务")])]),t._v(" "),a("blockquote",[a("h5",{attrs:{id:"transactiontemplate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#transactiontemplate"}},[t._v("#")]),t._v(" TransactionTemplate:")]),t._v(" "),a("p",[t._v("是 Spring 提供的进行编程式事务管理的模板方法类,他直接继承了 DefaultTransactionDefinition。")]),t._v(" "),a("p",[a("strong",[t._v("TransactionTemplate 的设计思想和 JDBCTemplate 一致,是通过模板方法加回调接口的方式，将通用的事务处理代码，和资源管理封装为模板方法，而将需要变化的，并且需要被事务包裹的代码，以回调接口的形式传递出去。")])])])])]),t._v(" "),a("h2",{attrs:{id:"示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('public class TransactionMain {\n    public static void main(String[] args) throws ClassNotFoundException, SQLException {\n        test();\n    }\n\n    private static void test() {\n        DataSource dataSource = getDS();\n        JdbcTransactionManager jtm = new JdbcTransactionManager(dataSource);\n        //JdbcTransactionManager根据TransactionDefinition信息来进行一些连接属性的设置\n        //包括隔离级别和传播行为等\n        DefaultTransactionDefinition transactionDef = new DefaultTransactionDefinition();\n        //开启一个新事务---此时autocommit已经被设置为了false,并且当前没有事务,这里创建的是一个新事务\n        TransactionStatus ts = jtm.getTransaction(transactionDef);\n        //进行业务逻辑操作\n        try {\n            update(dataSource);\n            jtm.commit(ts);\n        }catch (Exception e){\n            jtm.rollback(ts);\n            System.out.println("发生异常,我已回滚");\n        }\n    }\n\n    private static void update(DataSource dataSource) throws Exception {\n        JdbcTemplate jt = new JdbcTemplate();\n        jt.setDataSource(dataSource);\n        jt.update("UPDATE Department SET Dname=\\"大忽悠\\" WHERE id=6");\n        throw new Exception("我是来捣乱的");\n    }\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports},637:function(t,a,n){t.exports=n.p+"assets/img/3062258fdfd647e5a5d844183ffffa82.22fc3966.png"}}]);