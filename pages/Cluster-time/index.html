<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>集群时钟同步问题 | Young&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="Young丶java后端技术博客,专注后端学习与总结。擅长spring boot,JAVA基础总结,等方面的知识,关注spring,架构,elasticsearch,mysql领域.">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.d9c8cf8c.css" as="style"><link rel="preload" href="/assets/js/app.4cd86b41.js" as="script"><link rel="preload" href="/assets/js/2.d1119784.js" as="script"><link rel="preload" href="/assets/js/70.581f4a90.js" as="script"><link rel="prefetch" href="/assets/js/10.730cc33a.js"><link rel="prefetch" href="/assets/js/11.d1f87d63.js"><link rel="prefetch" href="/assets/js/12.4aca44c1.js"><link rel="prefetch" href="/assets/js/13.6b78182a.js"><link rel="prefetch" href="/assets/js/14.367745cf.js"><link rel="prefetch" href="/assets/js/15.c20fcdee.js"><link rel="prefetch" href="/assets/js/16.2b737092.js"><link rel="prefetch" href="/assets/js/17.89bb9f70.js"><link rel="prefetch" href="/assets/js/18.06851bba.js"><link rel="prefetch" href="/assets/js/19.12bc1800.js"><link rel="prefetch" href="/assets/js/20.40ed6860.js"><link rel="prefetch" href="/assets/js/21.5c8e29ac.js"><link rel="prefetch" href="/assets/js/22.3f1ac88e.js"><link rel="prefetch" href="/assets/js/23.0f6c4fc2.js"><link rel="prefetch" href="/assets/js/24.c10a49a3.js"><link rel="prefetch" href="/assets/js/25.004ee4c5.js"><link rel="prefetch" href="/assets/js/26.b8c3e290.js"><link rel="prefetch" href="/assets/js/27.22147769.js"><link rel="prefetch" href="/assets/js/28.e36e589d.js"><link rel="prefetch" href="/assets/js/29.17cebbd7.js"><link rel="prefetch" href="/assets/js/3.867c813a.js"><link rel="prefetch" href="/assets/js/30.a3c72481.js"><link rel="prefetch" href="/assets/js/31.511b3f69.js"><link rel="prefetch" href="/assets/js/32.7f0fc1b1.js"><link rel="prefetch" href="/assets/js/33.6cdaa214.js"><link rel="prefetch" href="/assets/js/34.1780e7f3.js"><link rel="prefetch" href="/assets/js/35.29229406.js"><link rel="prefetch" href="/assets/js/36.6ce4ae19.js"><link rel="prefetch" href="/assets/js/37.a44bdb9a.js"><link rel="prefetch" href="/assets/js/38.76a3215c.js"><link rel="prefetch" href="/assets/js/39.f05d0806.js"><link rel="prefetch" href="/assets/js/4.0eade8ff.js"><link rel="prefetch" href="/assets/js/40.b7d743f6.js"><link rel="prefetch" href="/assets/js/41.da4f472e.js"><link rel="prefetch" href="/assets/js/42.94aa9e35.js"><link rel="prefetch" href="/assets/js/43.2fbe0510.js"><link rel="prefetch" href="/assets/js/44.43b4ddc2.js"><link rel="prefetch" href="/assets/js/45.74c6ae67.js"><link rel="prefetch" href="/assets/js/46.57718ecf.js"><link rel="prefetch" href="/assets/js/47.569e5254.js"><link rel="prefetch" href="/assets/js/48.f6aae826.js"><link rel="prefetch" href="/assets/js/49.d691584a.js"><link rel="prefetch" href="/assets/js/5.b37386e0.js"><link rel="prefetch" href="/assets/js/50.fccff498.js"><link rel="prefetch" href="/assets/js/51.b62d5d60.js"><link rel="prefetch" href="/assets/js/52.db74baec.js"><link rel="prefetch" href="/assets/js/53.3076b5fc.js"><link rel="prefetch" href="/assets/js/54.fd279287.js"><link rel="prefetch" href="/assets/js/55.8415e55b.js"><link rel="prefetch" href="/assets/js/56.427e2c13.js"><link rel="prefetch" href="/assets/js/57.c386aa37.js"><link rel="prefetch" href="/assets/js/58.34a09a47.js"><link rel="prefetch" href="/assets/js/59.850e7488.js"><link rel="prefetch" href="/assets/js/6.253cb709.js"><link rel="prefetch" href="/assets/js/60.37471fae.js"><link rel="prefetch" href="/assets/js/61.96747036.js"><link rel="prefetch" href="/assets/js/62.0cce6d03.js"><link rel="prefetch" href="/assets/js/63.73b028ad.js"><link rel="prefetch" href="/assets/js/64.28f562ad.js"><link rel="prefetch" href="/assets/js/65.7f37c3e9.js"><link rel="prefetch" href="/assets/js/66.e2566bbd.js"><link rel="prefetch" href="/assets/js/67.e093e3ce.js"><link rel="prefetch" href="/assets/js/68.209e2c32.js"><link rel="prefetch" href="/assets/js/69.01ad0d61.js"><link rel="prefetch" href="/assets/js/7.baba38db.js"><link rel="prefetch" href="/assets/js/71.397058b1.js"><link rel="prefetch" href="/assets/js/72.1e8455fe.js"><link rel="prefetch" href="/assets/js/73.f63bbc3f.js"><link rel="prefetch" href="/assets/js/74.917d3065.js"><link rel="prefetch" href="/assets/js/75.8349ed04.js"><link rel="prefetch" href="/assets/js/76.897d2627.js"><link rel="prefetch" href="/assets/js/77.7f092513.js"><link rel="prefetch" href="/assets/js/78.08ecfec4.js"><link rel="prefetch" href="/assets/js/8.29973322.js"><link rel="prefetch" href="/assets/js/9.8b5d754c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9c8cf8c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Young's blog" class="logo"> <span class="site-name can-hide">Young's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Spring/" class="nav-link">Spring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章1</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/andanyang/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>Young</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Spring/" class="nav-link">Spring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章1</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/andanyang/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/Consistent-Hash-algorithm/" class="sidebar-link">⼀致性Hash算法</a></li><li><a href="/pages/Cluster-time/" aria-current="page" class="active sidebar-link">集群时钟同步问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/Cluster-time/#_3-1-与-ntpd-对比" class="sidebar-link">3.1 与 ntpd 对比</a></li><li class="sidebar-sub-header level2"><a href="/pages/Cluster-time/#_3-2-服务器端安装" class="sidebar-link">3.2 服务器端安装</a></li><li class="sidebar-sub-header level2"><a href="/pages/Cluster-time/#_3-3-客户端配置" class="sidebar-link">3.3 客户端配置</a></li></ul></li><li><a href="/pages/distributed-id/" class="sidebar-link">分布式ID解决方案</a></li><li><a href="/pages/Raft/" class="sidebar-link">Raft 算法 详细版介绍</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E5%88%86%E5%B8%83%E5%BC%8F" title="分类" data-v-06225672>分布式</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/andanyoung" target="_blank" title="作者" class="beLink" data-v-06225672>andanyang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-03-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">集群时钟同步问题<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_1、linux-集群时钟不同步导致的问题"><a href="#_1、linux-集群时钟不同步导致的问题" class="header-anchor">#</a> 1、Linux 集群时钟不同步导致的问题</h1> <p>时钟此处指服务器时间，如果集群中各个服务器时钟不⼀致势必导致⼀系列问题，试想 “集群是各个服务器⼀起团队化作战，⼤家工作都不在⼀个点上，岂不乱了套！”</p> <p>举⼀个例⼦，电商网站业务中，新增⼀条订单，那么势必会在订单表中增加了⼀条记录，该条记录中应该会有“下单时间”这样的字段，往往我们会在程序中获取当前系统时间插⼊到数据库或者直接从数据库服务器获取时间。那我们的订单⼦系统是集群化部署，或者我们的数据库也是分库分表的集群化部署，然⽽他们的系统时钟缺不⼀致，⽐如有⼀台服务器的时间是昨天，那么这个时候下单时间就成了昨天，那我们的数据将会混乱！如下</p> <p><img src="http://md7.admin4j.com/blog/image-20230328163202071.png" alt="image-20230328163202071"></p> <h1 id="_2、集群时钟同步配置"><a href="#_2、集群时钟同步配置" class="header-anchor">#</a> 2、集群时钟同步配置</h1> <ul><li><p>集群时钟同步思路</p> <ul><li><p>分布式集群中各个服务器节点都可以连接互联网</p> <p>场景一：各个节点都可以访问互联网，各自同步国家授时中心/时间服务器</p></li></ul> <p><img src="http://md7.admin4j.com/blog/image-20230328163313106.png" alt="image-20230328163313106"></p> <p>操作⽅式：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>#使⽤ ntpdate 网络时间同步命令
ntpdate <span class="token operator">-</span>u ntp<span class="token punctuation">.</span>api<span class="token punctuation">.</span>bz #从⼀个时间服务器同步时间
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>windows 有计划任务</p> <p>Linux 也有定时任务，crond，可以使⽤ linux 的定时任务，每隔 10 分钟执⾏⼀次 ntpdate 命令</p> <ul><li><p>分布式集群中某⼀个服务器节点可以访问互联网或者所有节点都不能够访问互联网</p> <p>场景二和场景三：把 node1 作为局域网内的时间服务器，其他服务器从 node1 上同步时间</p> <p><img src="http://md7.admin4j.com/blog/image-20230328163354748.png" alt="image-20230328163354748"></p></li></ul> <p>操作⽅式：</p> <p>1）选取集群中的⼀个服务器节点 A(172.17.0.17)作为时间服务器（整个集群时间从这台服务器同步，如果这台服务器能够访问互联网，可以让这台服务器和网络时间保持同步，如果不能就⼿动设置⼀个时间）</p> <ul><li>⾸先设置好 A 的时间</li> <li>把 A 配置为时间服务器（修改/etc/ntp.conf ⽂件）</li></ul></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1</span>、如果有 restrict <span class="token keyword">default</span> ignore，注释掉它
<span class="token number">2</span>、添加如下⼏⾏内容
 restrict <span class="token number">172.17</span><span class="token number">.0</span><span class="token number">.0</span> mask <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span> nomodify notrap # 放开局域网同步功能<span class="token punctuation">,</span><span class="token number">172.17</span><span class="token number">.0</span><span class="token number">.0</span>是你的局域网网段
 server <span class="token number">127.127</span><span class="token number">.1</span><span class="token number">.0</span> # local clock
 fudge <span class="token number">127.127</span><span class="token number">.1</span><span class="token number">.0</span> stratum <span class="token number">10</span>
<span class="token number">3</span>、重启⽣效并配置ntpd服务开机⾃启动
service ntpd restart
 chkconfig ntpd on
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p>集群中其他节点就可以从 A 服务器同步时间了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ntpdate 172.17.0.17
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h1 id="_3-使用-chronyd-同步时间"><a href="#_3-使用-chronyd-同步时间" class="header-anchor">#</a> 3. 使用 Chronyd 同步时间</h1> <p>Chrony 是网络时间协议（NTP）的一种实现，是一个类 Unix 系统上 NTP 客户端和服务器的替代品。Chrony 客户端可以与 NTP servers 同步系统时间，也可以与参考时钟（例如：GPS 接受设备）进行同步，还与手动输入的时间进行同步。同样 Chrony 也可以作为一个 NTPv4（RFC 5905） server 为其他计算机提供时间同步服务。
Chrony 可以更快的同步系统时钟，具有更好的时钟准确度，并且它对于那些不是一直在线的系统很有帮助。Chrony 在 Internet 上同步的两台机器之间的典型精度在几毫秒内，而在 LAN 上的机器之间的精度在几十微秒内。chronyd 更小、更节能，它占用更少的内存且仅当需要时它才唤醒 CPU。即使网络拥塞较长时间，它也能很好地运行。它支持 Linux 上的硬件时间戳，允许在本地网络进行极其准确的同步。Chrony 是自由开源的，并且支持 GNU/Linux 和 BSD 衍生版（比如 FreeBSD、NetBSD）、macOS 和 Solaris 等。</p> <h2 id="_3-1-与-ntpd-对比"><a href="#_3-1-与-ntpd-对比" class="header-anchor">#</a> 3.1 与 ntpd 对比</h2> <p>（1）chronyd 做的比 ntpd 好的
chronyd 可以在时断时续访问参考时间源的环境下工作，而 ntpd 需要定期轮询参考时间源才能正常工作。
即使网络拥塞时间更长，chronyd 也可以运行良好。
chronyd 通常可以更快、更准确地同步时钟。
chronyd 能够快速适应晶体振荡器温度变化引起的时钟频率的突然变化，而 ntpd 可能需要很长时间才能稳定下来。
在默认配置下，为了不影响其他正在运行的程序，chronyd 从不在系统启动同步时钟之后执行时间步进。ntpd 也可以配置为从不步进时间，但它必须使用不同的方法来调整时钟，这有一些缺点，包括对时钟精度的负面影响。
chronyd 可以在更大的范围内调整 Linux 系统上的时钟频率，这使得它甚至可以在时钟损坏或不稳定的机器上运行。例如，在一些虚拟机上。
chronyd 体积更小，占用的内存更少，而且只有在必要的时候才会唤醒 CPU，这对于节能来说是更好的选择。
（2）chronyd 能做的但 ntpd 做不到的
chronyd 提供了对孤立网络的支持，在孤立网络中，时间校正的唯一方法就是手动输入。例如，由管理员查看时钟。chronyd 可以检查在不同的更新中修正的错误，从而估算出计算机增加或减少时间的速度，并在随后使用这个估算来调整计算机时钟。
chronyd 可以计算 RTC 时钟（在计算机关闭时保持时间的时钟）的增益和损耗率。它可以在系统启动时使用这些计算的数据，以及从 RTC 时钟获取的时间调整值来设置系统时间。RTC 时钟设备目前仅在 Linux 系统上可用。
支持 Linux 上的硬件时间戳，允许在本地网络上进行非常精确的同步。
（3）ntpd 做得到但 chronyd 做不到的
ntpd 支持 NTP v4（RFC 5905）的所有同步模式，包括 broadcast、multicast 和 manycast clients and servers 模式。请注意，broadcast 和 multicast 模式（即使有身份验证）与普通 servers and clients 模式相比，更不精确、更不安全，通常应避免使用。
ntpd 支持使用公钥加密的 Autokey 协议（RFC 5906）对服务器进行身份验证。注意，该协议已被证明是不安全的，可能会被 Network Time Security（NTS）取代。
ntpd 包含很多参考时间源的驱动程序，而 chronyd 依赖于其他程序（例如 gpsd），以使用共享内存（SHM）或 Unix domain socket（SOCK）访问参考时间源的数据。
（4）chronyd 与 ntpd，该怎么选
除了由不支持 Chrony 的工具管理或监视的系统，或者具有不能与 Chrony 一起使用的硬件参考时钟的系统之外，其他系统都应该首选 Chrony。
需要使用 Autokey 协议对数据包进行身份验证的系统只能使用 ntpd，因为 chronyd 不支持这个协议。Autokey 协议存在严重的安全问题，应避免使用该协议。使用对称密钥进行身份验证，而不是使用 Autokey，这是 chronyd 和 ntpd 都支持的。Chrony 支持更强的哈希函数，如 SHA256 和 SHA512，而 ntpd 只能使用 MD5 和 SHA1。</p> <h2 id="_3-2-服务器端安装"><a href="#_3-2-服务器端安装" class="header-anchor">#</a> 3.2 服务器端安装</h2> <p>Centos Linux 8.1 默认安装了 chronyd 服务。我们只需要配置即可。</p> <p><strong>配置文件配置</strong></p> <p>红色部分是需要服务器配置的，这是基本配置，主要在于实现基本功能。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi /etc/chrony.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># Use public servers from the pool.ntp.org project.
# Please consider joining the pool (http://www.pool.ntp.org/join.html).
# pool 2.centos.pool.ntp.org iburst
# 同步外部服务器上的时间
server ntp.api.bz iburst
# Record the rate at which the system clock gains/losses time.
driftfile /var/lib/chrony/drift

# Allow the system clock to be stepped in the first three updates
# if its offset is larger than 1 second.
makestep 1.0 3

# Enable kernel synchronization of the real-time clock (RTC).
rtcsync

# Allow NTP client access from local network.
# allow 192.168.0.0/16
# 允许哪个网段的客户端同步时间，133这台是服务器。
allow 192.168.94.0/24

# Serve time even if not synchronized to a time source.
# 字面翻译，提供时间即使没有同步一个时间源。
local stratum 10
# Specify file containing keys for NTP authentication.
keyfile /etc/chrony.keys

# Get TAI-UTC offset and leap seconds from the system tz database.
leapsectz right/UTC
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>启动 chronyd，并设置开机自启</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@node1 ~]# systemctl start chronyd
[root@node1 ~]# systemctl enable chronyd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查看时间同步情况，本地能够同步才能够让其他节点进行同步</p> <p>timedatectl 是一个时间配置工具，用于设定时间、与时间相关的配置等。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@node1 ~]# timedatectl
               Local time: 五 2020-05-29 11:17:46 EDT
           Universal time: 五 2020-05-29 15:17:46 UTC
                 RTC time: 五 2020-05-29 15:17:46
                Time zone: America/New_York (EDT, -0400)
# 当此值为yes代表同步成功，如果为no就代表未同步，或同步失败。
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
[root@filesystem ~]#
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>查看当前时间是从哪里同步过来的，这里显示的是主机名。不影响。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@node1 ~]# chronyc sources
210 Number of sources = 1
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^* node1                   10   7   377   537    +11us[  +25us] +/-   30us
[root@filesystem ~]#
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>防火墙配置</strong></p> <blockquote><p>防火墙要能放行此服务，关闭防火墙或是放行相应的端口及服务。</p></blockquote> <h2 id="_3-3-客户端配置"><a href="#_3-3-客户端配置" class="header-anchor">#</a> 3.3 客户端配置</h2> <p><strong>配置文件配置</strong></p> <blockquote><p>vi /etc/chrony.conf</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code># Use public servers from the pool.ntp.org project.
# Please consider joining the pool (http://www.pool.ntp.org/join.html).
# pool 2.centos.pool.ntp.org iburst
server 192.168.94.133 iburst
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>配置开机自启</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@node2 ~]# systemctl restart chronyd
[root@node2 ~]# systemctl enable chronyd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查看同步状态及信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@node2 ~]# timedatectl
               Local time: 五 2020-05-29 11:28:12 EDT
           Universal time: 五 2020-05-29 15:28:12 UTC
                 RTC time: 五 2020-05-29 15:28:12
                Time zone: America/New_York (EDT, -0400)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
[root@node1 ~]# chronyc sources
210 Number of sources = 1
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^* node1                   11   6    17    34   -520ns[+7955ns] +/-   15ms
[root@node2 ~]#
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>我们看到是 yes，但是如何判断它是原来的时间还是同步好了。毕竟很多系统不同步时间也是近似的。</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/andanyang/vuepress-theme-vdoing/edit/master/docs/分布式/0002. 集群时钟同步问题.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/05/29, 03:30:39</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/Consistent-Hash-algorithm/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">⼀致性Hash算法</div></a> <a href="/pages/distributed-id/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">分布式ID解决方案</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/Consistent-Hash-algorithm/" class="prev">⼀致性Hash算法</a></span> <span class="next"><a href="/pages/distributed-id/">分布式ID解决方案</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/977ce6/"><div>
            多线程环境下，HashMap为什么会出现死循环
            <!----></div></a> <span class="date">05-29</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/java-lru/"><div>
            java 实现LRU 算法
            <!----></div></a> <span class="date">05-10</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/d6064c/"><div>
            讲一讲什么是 MMAP
            <!----></div></a> <span class="date">05-09</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1218853253@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/andanyang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>Young | <a href="https://github.com/andanyoung/young-blog/blob/master/LICENSE" target="_blank">MIT License</a> <br/> <a  href="https://beian.miit.gov.cn/" target="_blank">浙ICP备20002744号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.4cd86b41.js" defer></script><script src="/assets/js/2.d1119784.js" defer></script><script src="/assets/js/70.581f4a90.js" defer></script>
  </body>
</html>
